<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@person.xml"/>
    <template path="@workorder.xml"/>
    <template path="@location.xml"/>
    <template path="@servicerequest.xml"/>
    <template path="@asset.xml"/>
  </templates>

  <entities>
    <entity name="SR" idAttribute="ticketuid" useridAttribute="ticketid">
      <attributes>
        <attribute name="pending" query="status" type="varchar"/>
      </attributes>
      
      <relationships>
        <relationship to="synonymdomain" qualifier="pescosynstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="SRSTATUS" quoteLiteral="true" />
          <relationshipAttribute query="(description IN ('New', 'Pending', 'In Progress', 'Closed', 'Resolved'))"/>
        </relationship>
      </relationships>
    </entity>
  <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum" whereclause="!@woclass like 'WORKORDER'">
      <relationships>
        <relationship to="synonymdomain" qualifier="pescosynstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="WOSTATUS" quoteLiteral="true" />
          <relationshipAttribute query="(value IN ('APPR', 'INPRG', 'WMATL', 'WSCH', 'COMP', 'CAN'))"/>
        </relationship>
      </relationships>
    </entity>
    <entity name="location" idAttribute="locationsid">
      <attributes>
        <attribute name="pluspcustomer" type="varchar"/>
      </attributes>
    </entity>
    <entity name="asset" idAttribute="assetid" useridAttribute="assetnum">
      <attributes>
        <attribute name="pluspcustomer" type="varchar"/>
      </attributes>
    </entity>
  </entities>

  <applications>
    <application entity="SR" name="servicerequest" title="Service Request" role="sr">
      <schemas>
        <list redeclaring="false" >
          <customization position="#statusicons">
            <field attribute="#statusicons" label="Status Icons">
              <renderer type="statusicons" params="width=9%;iconcolumns=communicationcounter,attachmentcounter,relatedcounter"/>
            </field>
            <field attribute="pending"  tooltip="Change Status to Pending">
              <renderer type="iconbutton" params="width=3%;expression={'#default':'','NEW':'fa-hourglass-half'};hideValueOnTooltip=true"/>
            </field>
          </customization>
          
          
          <properties>
            <property key="list.click.service" value="pescoStatusService.changeStatusToPending"/>
          </properties>
        </list>
        <schema id="editdetail" abstract="true" stereotype="detail" platform="web" redeclaring="false">
          <customization position="location"></customization>
          <customization position="assetnum"></customization>

          <customization position="+siteid">
            <association label="Location" target="location" labelfield="location_.description" dependantfields="siteid" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
              <renderer type="lookup"/>
              <event type="beforechange" service="srService" method="beforeChangeLocation"/>
            </association>
            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="srService" method="afterChangeAsset"/>
            </association>
          </customization>
          
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description" requiredexpression="true">
              <renderer type="lookup" />
            </association>
          </customization>
          <commandbars>
            <commandgroup position="actions">
              <command id="Pending" icon="fa-hourglass-2" label="Pending" position="left"
                        tooltip="Change Status to Pending"
                        service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,PENDING"
                        showexpression="@status == 'NEW'"
                       />
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>

    <application entity="SR" name="quickservicerequest" title="Quick Requests" role="ssr">
      <schemas>
        <schema id="quickeditdetail" abstract="true" stereotype="detail" platform="web" redeclaring="false">
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description" requiredexpression="true" enableexpression="false">
              <renderer type="lookup"/>
            </association>
          </customization>
          <commandbars>
            <commandgroup position="actions">
              <command id="Pending" icon="fa-hourglass-2" label="Pending" position="left"
                        tooltip="Change Status to Pending"
                        service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,PENDING"
                        showexpression="@status == 'NEW'"
                       />
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>


    <application name="location" title="Location" entity="location" >
      <schemas>
        <schema id="list" redeclaring="false">
          <customization position="status"/>
          <customization position="type"/>
          <customization position="+orgid">
            <field attribute="pluspcustomer" label="Customer"/>
          </customization>
          <commandbars>
            
          </commandbars>
        </schema>
        <schema id="locationdetail" title="Location Detail" stereotype="detail" redeclaring="false">
          <customization position="+intlabrec">
            <field attribute="pluspcustomer" label="Customer" readonly="true"/>
          </customization>
        </schema>
      </schemas>
    </application>
    
    <application name="asset" title="Asset" entity="asset">
      <schemas>
         <schema id="list" platform="web" redeclaring="false">
          <customization position="+siteid">
            <field attribute="pluspcustomer" label="Customer"/>
          </customization>
        </schema>
        <schema id="detail" title="Asset Detail" stereotype="detail" platform="web" redeclaring="false">
          <customization position="+item_.description">
            <field attribute="pluspcustomer" label="Customer" readonly="true"/>
          </customization>
        </schema>
      </schemas>
    </application>
    
    <application name="workorder" title="Work Order" entity="workorder" role="workorders">
      <schemas>
        <schema id="adetail" title="Work Order Details" abstract="true" stereotype="detail" platform="web" redeclaring="false">
        </schema>
        <schema id="editdetail" parentschema="adetail"  title="Work Order Details" platform="web" redeclaring="false">
          <customization position="location"></customization>
          <customization position="assetnum"></customization>

          <customization position="+siteid">
            <association label="Location" target="location" labelfield="location_.description"  dependantfields="siteid" enableexpression="!@siteid != null" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
              <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
              <renderer type="lookup" />
            </association>
            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="genericTicketService" method="afterChangeAsset"/>
            </association>
          </customization>
          
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description">
              <dataprovider prefilterfunction="FilterStatusCodes"/>
              <renderer type="lookup" params="avoidautofocus=true"/>
            </association>
          </customization>

          <customization position="multiassetlocci_"></customization>

          <customization position="+bottomhiddenfield">
            <composition inline="true" relationship="multiassetlocci" label="Multi Asset Locations:" detailschema="detail" showexpression="true">
              <collectionproperties listschema="newlist" autocommit="false" allowcreation="true"/>
              <renderer type="TABLE" params="mode=batch;inputsize=xlarge"/>
            </composition>
          </customization>
          
        </schema>
      </schemas>
    </application>


  </applications>
  

</metadata>