<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata"  xmlns:f="http://www.controltechnologysolutions.com/filters">

  <templates>
    <template path="@person.xml"/>
    <template path="@workorder.xml"/>
    <template path="@location.xml"/>
    <template path="@servicerequest.xml"/>
    <template path="@asset.xml"/>
  </templates>

  <entities>
    <entity name="SR" idAttribute="ticketuid" useridAttribute="ticketid">
      <attributes>
        <attribute name="lostenergy3" type="smallint" required="true" />
        <attribute name="pending" query="status" type="varchar"/>
      </attributes>
      
      <relationships>
        <relationship to="synonymdomain" qualifier="pescosynstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="SRSTATUS" quoteLiteral="true" />
          <relationshipAttribute query="(description IN ('New', 'Pending', 'In Progress', 'Closed', 'Resolved'))"/>
        </relationship>
      </relationships>
    </entity>
  <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum" whereclause="!@woclass like 'WORKORDER'">
    <attributes>
      <attribute name="lostenergy" type="smallint" required="true" />
    </attributes>

      <relationships>
        <relationship to="synonymdomain" qualifier="pescosynstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="WOSTATUS" quoteLiteral="true" />
          <relationshipAttribute query="(value IN ('APPR', 'INPRG', 'WMATL', 'WSCH', 'COMP', 'CAN'))"/>
        </relationship>
      </relationships>
    </entity>
    <entity name="location" idAttribute="locationsid">
      <attributes>
        <attribute name="isproject" type="smallint" required="true" />
        <attribute name="pluspcustomer" type="varchar"/>
      </attributes>
    </entity>
    <entity name="asset" idAttribute="assetid" useridAttribute="assetnum">
      <attributes>
        <attribute name="pluspcustomer" type="varchar"/>
      </attributes>
    </entity>
  </entities>

  <applications>
    <application entity="SR" name="servicerequest" title="Service Request" role="sr">
      <filters>
        <optionfilter attribute="lostenergy3" allowblank="false" style="width:300px" eager="true">
          <f:option label="Yes" value="1" />
          <f:option label="No" value="0" />
        </optionfilter>
        <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px">
          <option xmlns="http://www.controltechnologysolutions.com/filters" label="Open" value="INPROG,QUEUED,PENDING,NEW,HISTEDIT" preselected="true" displaycode="false"
                  tooltip="The status of open service requests. Matches any service request of &quot;INPROG&quot;, &quot;PENDING&quot;, &quot;QUEUED&quot;, &quot;NEW&quot; or &quot;HISTEDIT&quot; status."/>
        </optionfilter>
      </filters>
      <schemas>
        
        <list redeclaring="false" stereotype="list.selection">
          <customization position="siteid">
            <field attribute="siteid" label="Site Id"/>
          </customization>
          <customization position="+owner">
            <field attribute="lostenergy3" label="Lost Energy" readonly="true" enableexpression="false">
              <renderer type="checkbox" params="formatter=numberToBoolean"/>
            </field>
          </customization>
          <customization position="#statusicons">
            <field attribute="#statusicons" label="Status Icons">
              <renderer type="statusicons" params="width=9%;iconcolumns=communicationcounter,attachmentcounter,relatedcounter"/>
            </field>
            <field attribute="pending"  tooltip="Change Status to Pending">
              <renderer type="iconbutton" params="width=3%;expression={'#default':'','NEW':'fa-hourglass-half'};hideValueOnTooltip=true"/>
            </field>
          </customization>
          <properties>
            <property key="list.click.service" value="pescoStatusService.changeStatusToPending"/>
          </properties>

          <commandbars>
            <commandgroup position="actions">
              <command id="Create" icon="fa-pencil" label="Change Status" 
                       showexpression="service:pescoStatusService.hasSelectedItemsForBatchStatus"
                       service="pescoStatusService" method="initBatchStatusChange"
                       parameters="schema,datamap" />
            </commandgroup>
          </commandbars>

        </list>

        <schema id="batchStatusChangeModal" stereotype="detail.modal" title="Change Status">
          <association label="Status" target="status" labelfield="synstatus.description" requiredexpression="true">
            <renderer type="lookup"/>
          </association>
        </schema>

        <schema id="adetail" title="Request Details" abstract="true" stereotype="detail" redeclaring="false">
          <customization position="description"></customization>

          <customization position="+tophiddenfield">
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100" />
            </field>
          </customization>
          
          <customization position="location"></customization>
          <customization position="assetnum"></customization>

          <customization position="+locationhiddenfield">
            <association label="Location" target="location" labelfield="location_.description" dependantfields="siteid" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
              <renderer type="lookup" params="application=location;schemaId=locationLookupList;"/>
              <event type="beforechange" service="srService" method="beforeChangeLocation"/>
            </association>
              
            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="srService" method="afterChangeAsset"/>
            </association>
              <field attribute="lostenergy3" label="Lost Energy">
                <renderer type="checkbox" params="formatter=numberToBoolean"/>
              </field>
          </customization>
        </schema>
            
        <schema id="newdetail" parentschema="adetail" stereotype="detailnew" title="New Service Request" redeclaring="false">
        </schema>
          
        <schema id="editdetail" parentschema="adetail" title="Service Request Details" redeclaring="false">
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description" requiredexpression="true">
              <renderer type="lookup" />
            </association>
          </customization>
          <commandbars>
            <commandgroup position="actions">
              <command id="Pending" icon="fa-hourglass-2" label="Pending" position="left"
                        tooltip="Change Status to Pending"
                        service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,PENDING"
                        showexpression="@status == 'NEW'"
                       />
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>

    <application entity="SR" name="quickservicerequest" title="Quick Requests" role="ssr">
      <schemas>

        <schema id="quicksrgrid" redeclaring="false">
          <customization position="-status">
            <field attribute="siteid" label="Site Id"/>
          </customization>

        </schema>


        <schema id="quickeditdetail" abstract="true" stereotype="detail" platform="web" redeclaring="false">
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description" requiredexpression="true" enableexpression="false">
              <renderer type="lookup"/>
            </association>
          </customization>
          <commandbars>
            <commandgroup position="actions">
              <command id="Pending" icon="fa-hourglass-2" label="Pending" position="left"
                        tooltip="Change Status to Pending"
                        service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,PENDING"
                        showexpression="@status == 'NEW'"
                       />
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>


    <application name="location" title="Location" entity="location" >
      <filters>
        <optionfilter attribute="isproject" allowblank="false" style="width:300px" eager="true">
          <f:option label="Yes" value="1" />
          <f:option label="No" value="0" />
        </optionfilter>
      </filters>
      <schemas>
        <schema id="list" redeclaring="false">
          <customization position="status"/>
          <customization position="type"/>
          <customization position="+orgid">
            <field attribute="isproject" label="Is Project" readonly="true" enableexpression="false">
              <renderer type="checkbox" />
            </field>
            <field attribute="pluspcustomer" label="Customer"/>
          </customization>
          <commandbars>
            
          </commandbars>
        </schema>
        
        <schema id="locationLookupList" stereotype="list.singleselection.modal" platform="web" title="Location List">
          <field attribute="location" label="Location" qualifier="title"/>
          <field attribute="description" label="Description" qualifier="excerpt"/>
          <optionfield attribute="isproject" label="Is Project">
            <renderer type="checkbox"  params="filteronly=true;formatter=numberToBoolean"/>
            <option label="No" value="FALSE"/>
            <option label="Yes" value="TRUE"/>  
          </optionfield>
        </schema>
        
        <schema id="locationdetail" title="Location Detail" stereotype="detail" redeclaring="false">
          <customization position="+intlabrec">
            <field attribute="pluspcustomer" label="Customer" readonly="true"/>
            <field attribute="isproject" label="Is Project" readonly="true" enableexpression="false">
              <renderer type="checkbox"/>
            </field>
          </customization>
        </schema>
      </schemas>
    </application>
    
    <application name="asset" title="Asset" entity="asset">
      <schemas>
         <schema id="list" platform="web" redeclaring="false">
          <customization position="+siteid">
            <field attribute="pluspcustomer" label="Customer"/>
          </customization>
        </schema>
        <schema id="detail" title="Asset Detail" stereotype="detail" platform="web" redeclaring="false">
          <customization position="+item_.description">
            <field attribute="pluspcustomer" label="Customer" readonly="true"/>
          </customization>
        </schema>
      </schemas>
    </application>
    
    <application name="workorder" title="Work Order" entity="workorder" role="workorders">
      <filters>
        <optionfilter attribute="lostenergy" allowblank="false" style="width:300px" eager="true">
          <f:option label="Yes" value="1" />
          <f:option label="No" value="0" />
        </optionfilter>
        <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px">
          <option xmlns="http://www.controltechnologysolutions.com/filters" label="Open" value="APPR,HISTEDIT,INPRG,WAPPR,WMATL,WPCOND,WSCH" preselected="true" displaycode="false"
                  tooltip="The status of open work orders. Matches any work orders of &quot;APPR&quot;, &quot;HISTEDIT&quot;, &quot;INPRG&quot;, &quot;WAPPR&quot; , &quot;WMATL&quot;, &quot;WPCOND&quot; or &quot;WSCH&quot; status."/>
        </optionfilter>
      </filters>

      <schemas>
       
         <list title="Work Order Grid" platform="web" redeclaring="false" stereotype="list.selection">
          <customization position="siteid">
             <field attribute="siteid" label="Site Id"/>
           </customization>
          
          <customization position="+asset_.description">
            <field attribute="lostenergy" label="Lost Energy" readonly="true" enableexpression="false">
              <renderer type="checkbox" />
            </field>
          </customization>

           <commandbars>
             <commandgroup position="actions">
               <command id="Create" icon="fa-pencil" label="Change Status"
                        showexpression="service:pescoStatusService.hasSelectedItemsForBatchStatus"
                        service="pescoStatusService" method="initBatchStatusChange"
                        parameters="schema,datamap" />
             </commandgroup>
           </commandbars>

         </list>

        <schema id="batchStatusChangeModal" stereotype="detail.modal" title="Change Status">
          <association label="Status" target="status" labelfield="synstatus.description">
            <dataprovider prefilterfunction="FilterStatusCodes"/>
            <renderer type="lookup" params="avoidautofocus=true"/>
          </association>
        </schema>
          
        <schema id="adetail" title="Work Order Details" abstract="true" stereotype="detail" platform="web" redeclaring="false">

          <customization position="description"></customization>
          
          <customization position="+tophiddenfield">
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100" />
            </field>
          </customization>
          
          <customization position="location"></customization>
          <customization position="assetnum"></customization>

          <customization position="+locationhiddenfield">
            <!--<section orientation="horizontal">-->
            <association label="Location" target="location" labelfield="location_.description"  dependantfields="siteid" enableexpression="!@siteid != null" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
              <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
              <renderer type="lookup" params="application=location;schemaId=locationLookupList;"/>
            </association>
         
           <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="genericTicketService" method="afterChangeAsset"/>
            </association>
            <field attribute="lostenergy" label="Lost Energy">
              <renderer type="checkbox" params="formatter=numberToBoolean"/>
            </field>
               <!--</section>-->
          </customization>
        </schema>
      
        <schema id="newdetail" parentschema="adetail" title="New Work Order"  platform="web" stereotype="detailnew" redeclaring="false">
         </schema> 
        
        <schema id="editdetail" parentschema="adetail"  title="Work Order Details" platform="web" redeclaring="false">
          
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description">
              <dataprovider prefilterfunction="FilterStatusCodes"/>
              <renderer type="lookup" params="avoidautofocus=true"/>
            </association>
          </customization>

          <customization position="multiassetlocci_"></customization>

          <customization position="+bottomhiddenfield">
            <composition inline="true" relationship="multiassetlocci" label="Multi Asset Locations:" detailschema="detail" showexpression="true">
              <collectionproperties listschema="newlist" autocommit="false" allowcreation="true"/>
              <renderer type="TABLE" params="mode=batch;inputsize=xlarge"/>
            </composition>
          </customization>
          
        </schema>
      </schemas>
    </application>


  </applications>
  

</metadata>