<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata"  xmlns:f="http://www.controltechnologysolutions.com/filters">

  <templates>
    <template path="@person.xml"/>
    <template path="@workorder.xml"/>
    <template path="@location.xml"/>
    <template path="@servicerequest.xml"/>

    <template path="@quickservicerequest.xml"/>

    <template path="@asset.xml"/>
    <template path="@globalsearch.xml"/>
  </templates>

  <entities>
    <entity name="SR" idAttribute="ticketuid" useridAttribute="ticketid">
      <attributes>
        <attribute name="lostenergy3" type="smallint" required="true" />
        <attribute name="lostenergyamount" type="varchar" required="true" />
        <attribute name="pending" query="status" type="varchar"/>
      </attributes>

      <relationships>
        <relationship to="synonymdomain" qualifier="pescosynstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="SRSTATUS" quoteLiteral="true" />
          <relationshipAttribute query="(value IN ('CLOSED','HISTEDIT','INPROG','NEW','PENDING','QUEUED','RESOLVED'))"/>
        </relationship>
      </relationships>

      <connectorParameters>
        <connectorParameter key="dispatchwo_customconnector" value="softwrench.sw4.pesco.classes.com.cts.pesco.action.PescoDispatchOperationHandler" />
      </connectorParameters>
    </entity>
    <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum" whereclause="!@woclass like 'WORKORDER'">
      <attributes>
        <attribute name="lostenergy" type="smallint" required="true" />
        <attribute name="lostenergyamount" type="varchar" required="true" />
      </attributes>

      <relationships>
        <relationship to="synonymdomain" qualifier="pescosynstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="WOSTATUS" quoteLiteral="true" />
          <relationshipAttribute query="(value IN ('APPR', 'INPRG', 'WMATL', 'WSCH', 'COMP', 'CAN', 'WAPPR'))"/>
        </relationship>
      </relationships>
    </entity>
    <entity name="location" idAttribute="locationsid">
      <attributes>
        <attribute name="isproject" type="smallint" required="true" />
        <attribute name="pluspcustomer" type="varchar"/>
      </attributes>
    </entity>
    <entity name="asset" idAttribute="assetid" useridAttribute="assetnum">
      <attributes>
        <attribute name="pluspcustomer" type="varchar"/>
      </attributes>
    </entity>


  </entities>

  <applications>
    <application entity="SR" name="servicerequest" title="Service Request" role="sr">
      <filters>
        <booleanfilter attribute="lostenergy3"/>
        <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px">
          <option xmlns="http://www.controltechnologysolutions.com/filters" label="Open" value="INPROG,QUEUED,PENDING,NEW,HISTEDIT" preselected="true" displaycode="false"
                  tooltip="The status of open service requests. Matches any service request of &quot;INPROG&quot;, &quot;PENDING&quot;, &quot;QUEUED&quot;, &quot;NEW&quot; or &quot;HISTEDIT&quot; status."/>
        </optionfilter>
      </filters>
      <schemas>

        <list redeclaring="false" stereotype="list.selection">
          <customization position="ticketid">
            <field attribute="ticketid" label="SR#">
              <renderer type="default" params="width=8%" />
            </field>
          </customization>
          <customization position="reportedby">
            <field attribute="reportedby" label="Reported By">
              <renderer type="default" params="width=12%" />
            </field>
          </customization>
          <customization position="owner">
            <field attribute="owner" label="Owner">
              <renderer type="default" params="width=12%" />
            </field>
            <field attribute="lostenergy3" label="Lost Energy" readonly="true" enableexpression="false">
              <renderer type="checkbox" params="width=5%;formatter=numberToBoolean"/>
            </field>
            <field attribute="lostenergyamount" label="Lost Energy Amount" readonly="true" enableexpression="false" tooltip="Lost Energy Amount">
              <renderer type="default" params="width=8%"/>
            </field>
          </customization>        
          <customization position="siteid">
            <field attribute="siteid" label="Site Id">
              <renderer type="default" params="width=12%"/>
            </field>
          </customization>
          <customization position="status">
            <field attribute="status" label="Status">
              <renderer type="statuscolor" params="width=10%" />
            </field>
          </customization>
          <customization position="statusicons">
            <field attribute="statusicons" tooltip="Status Icons">
              <renderer type="statusicons" params="width=9%;iconcolumns=communicationcounter,attachmentcounter,relatedcounter;icon=fa-tachometer;headericon=true;showsort=false"/>
            </field>
            <field attribute="pending"  tooltip="Change Status to Pending">
              <renderer type="iconbutton" params="width=3%;expression={'#default':'','NEW':'fa-hourglass-half'};hideValueOnTooltip=true"/>
            </field>
          </customization>
          <properties>
            <property key="list.click.service" value="pescoStatusService.changeStatusToPending"/>
            <property key="list.width.min" value="1280px"/>
          </properties>
        </list>

        <schema id="adetail" title="Request Details" abstract="true" stereotype="detail" redeclaring="false">
          <customization position="description"></customization>

          <customization position="+tophiddenfield">
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100" />
            </field>
          </customization>

          <customization position="location"></customization>
          <customization position="assetnum"></customization>

          <customization position="+locationhiddenfield">
            <association label="Location" target="location" labelfield="location_.description" dependantfields="siteid" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
              <renderer type="lookup" params="application=location;schemaId=locationLookupList;"/>
              <event type="beforechange" service="srService" method="beforeChangeLocation"/>
            </association>

            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="srService" method="afterChangeAsset"/>
            </association>
            <section orientation="horizontal">
            <field attribute="lostenergy3" label="Lost Energy">
              <renderer type="checkbox" params="formatter=numberToBoolean"/>
            </field>
            <field attribute="lostenergyamount" label="Lost Energy Amount" enableexpression="@lostenergy3 === true" showexpression="@lostenergy3 === true"/>
            </section>
          </customization>
        </schema>

        <schema id="newdetail" parentschema="adetail" stereotype="detailnew" title="New Service Request" redeclaring="false">
        </schema>

        <schema id="editdetail" parentschema="adetail" title="Service Request Details" redeclaring="false">
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description" requiredexpression="true">
              <renderer type="lookup" />
            </association>
          </customization>
          <commandbars>
            <commandgroup position="actions">
              <command id="Pending" icon="fa-hourglass-2" label="Pending" position="left"
                        tooltip="Change Status to Pending"
                        service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,PENDING"
                        showexpression="@status == 'NEW'"
                       />
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>

    <application entity="SR" name="quickservicerequest" title="Quick Requests" role="ssr">
      <schemas>

        <schema id="quicksrgrid" redeclaring="false">
          <customization position="-status">
            <field attribute="siteid" label="Site Id"/>
          </customization>

        </schema>


        <schema id="quickeditdetail" abstract="true" stereotype="detail" platform="web" redeclaring="false">
          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description" requiredexpression="true" enableexpression="false">
              <renderer type="lookup"/>
            </association>
          </customization>
          <commandbars>
            <commandgroup position="actions">
              <command id="Pending" icon="fa-hourglass-2" label="Pending" position="left"
                        tooltip="Change Status to Pending"
                        service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,PENDING"
                        showexpression="@status == 'NEW'"
                       />
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>


    <application name="location" title="Location" entity="location" >
      <filters>
        <booleanfilter attribute="isproject" preselected="true"/>
      </filters>
      <schemas>
        <schema id="list" redeclaring="false">
          <customization position="status"/>
          <customization position="type"/>
          <customization position="+orgid">
            <field attribute="isproject" label="Is Project" readonly="true" enableexpression="false">
              <renderer type="checkbox" />
            </field>
            <field attribute="pluspcustomer" label="Customer"/>
          </customization>
          <commandbars>

          </commandbars>
        </schema>

        <schema id="locationLookupList" stereotype="list.singleselection.modal" platform="web" title="Location List">
          <field attribute="location" label="Location" qualifier="title"/>
          <field attribute="description" label="Description" qualifier="excerpt"/>
          <optionfield attribute="isproject" label="Is Project">
            <renderer type="checkbox"  params="filteronly=true;formatter=numberToBoolean"/>
            <option label="No" value="FALSE"/>
            <option label="Yes" value="TRUE"/>
          </optionfield>
        </schema>

        <schema id="locationdetail" title="Location Detail" stereotype="detail" redeclaring="false">
          <customization position="+intlabrec">
            <field attribute="pluspcustomer" label="Customer" readonly="true"/>
            <field attribute="isproject" label="Is Project" readonly="true" enableexpression="false">
              <renderer type="checkbox"/>
            </field>
          </customization>
        </schema>
      </schemas>
    </application>

    <application name="asset" title="Asset" entity="asset">
      <schemas>
        <schema id="list" platform="web" redeclaring="false">
          <customization position="status">
            <field attribute="status" label="Status">
              <renderer type="default" params="width=10%" />
            </field>
          </customization>
          <customization position="+siteid">
            <field attribute="pluspcustomer" label="Customer">
              <renderer type="default" params="width=12%" />
            </field>
          </customization>
          <properties>
            <property key="list.width.min" value="1280px"/>
          </properties>
        </schema>
        <schema id="detail" title="Asset Detail" stereotype="detail" platform="web" redeclaring="false">
          <customization position="+item_.description">
            <field attribute="pluspcustomer" label="Customer" readonly="true"/>
          </customization>
        </schema>
      </schemas>
    </application>

    <application name="workorder" title="Work Order" entity="workorder" role="workorders">
      <filters>
        <booleanfilter attribute="lostenergy"/>
        <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px">
          <option xmlns="http://www.controltechnologysolutions.com/filters" label="Open" value="APPR,HISTEDIT,INPRG,WAPPR,WMATL,WPCOND,WSCH" preselected="true" displaycode="false"
                  tooltip="The status of open work orders. Matches any work orders of &quot;APPR&quot;, &quot;HISTEDIT&quot;, &quot;INPRG&quot;, &quot;WAPPR&quot; , &quot;WMATL&quot;, &quot;WPCOND&quot; or &quot;WSCH&quot; status."/>
        </optionfilter>
      </filters>

      <schemas>

        <list title="Work Order Grid" platform="web" redeclaring="false" stereotype="list.selection">
          <customization position="wonum">
            <field attribute="wonum" label="WO#" >
              <renderer type="default" params="width=8%" />
            </field>
          </customization>
          <customization position="siteid">
            <field attribute="siteid" label="Site Id">
              <renderer type="default" params="width=12%"/>
            </field>
          </customization>
          <customization position="status">
            <field attribute="status" label="Status">
              <renderer type="statuscolor" params="width=10%" />
            </field>
          </customization>
          <customization position="location">
            <field attribute="location" label="Location">
              <renderer type="default" params="width=12%" />
            </field>
          </customization>
          <customization position="asset_.description">
            <field attribute="asset_.description" label="Asset Description">
              <renderer type="default" params="width=12%" />
            </field>
            <field attribute="lostenergy" label="Lost Energy" readonly="true" enableexpression="false">
              <renderer type="checkbox" params="width=5%;formatter=numberToBoolean"/>
            </field>
            <field attribute="lostenergyamount" label="Lost Energy Amount">
              <renderer type="default" params="width=8%"/>
            </field>
          </customization>
          <properties>
            <property key="list.width.min" value="1280px"/>
          </properties>
        </list>

        <schema id="adetail" title="Work Order Details" abstract="true" stereotype="detail" platform="web" redeclaring="false">

          <customization position="description"></customization>

          <customization position="+tophiddenfield">
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100" />
            </field>
          </customization>

          <customization position="location"></customization>
          <customization position="assetnum"></customization>

          <customization position="+locationhiddenfield">
            <!--<section orientation="horizontal">-->
            <association label="Location" target="location" labelfield="location_.description"  dependantfields="siteid" enableexpression="!@siteid != null" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
              <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
              <renderer type="lookup" params="application=location;schemaId=locationLookupList;"/>
            </association>

            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="genericTicketService" method="afterChangeAsset"/>
            </association>
            <section orientation="horizontal">
              <field attribute="lostenergy" label="Lost Energy">
                <renderer type="checkbox" params="formatter=numberToBoolean"/>
              </field>
              <field attribute="lostenergyamount" label="Lost Energy Amount"  enableexpression="@lostenergy === true" showexpression="@lostenergy === true"/>
            </section>
            <!--</section>-->
          </customization>
        </schema>

        <schema id="newdetail" parentschema="adetail" title="New Work Order"  platform="web" stereotype="detailnew" redeclaring="false">
        </schema>

        <schema id="editdetail" parentschema="adetail"  title="Work Order Details" platform="web" redeclaring="false">

          <customization position="status">
            <association label="Status" target="status" labelfield="pescosynstatus.description">
              <dataprovider prefilterfunction="FilterStatusCodes"/>
              <renderer type="lookup" params="avoidautofocus=true"/>
            </association>
          </customization>
          <customization position="worktype">
            <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc">
              <renderer type="lookup" params="inputsize=large"/>
            </association>
          </customization>
          <customization position="wopriority">
            <optionfield attribute="wopriority" label="Priority" providerattribute="_SWPriorityType">
              <renderer type="lookup" params="inputsize=large"/>
            </optionfield>
          </customization>

          <customization position="multiassetlocci_"></customization>

          <customization position="+bottomhiddenfield">
            <composition inline="true" relationship="multiassetlocci" label="Multi Asset Locations:" detailschema="detail" showexpression="true">
              <collectionproperties listschema="newlist" autocommit="false" allowcreation="true"/>
              <renderer type="TABLE" params="mode=batch;inputsize=xlarge"/>
            </composition>
          </customization>

        </schema>
      </schemas>
    </application>

    <application entity="commlog" name="commlog" title="Communications Tab">
      <schemas>
        <schema id="detail" stereotype="compositiondetail" redeclaring="false">
          <customization position="subject">
            <field attribute="subject" label="Subject:" requiredexpression="true" defaultexpression="service:pescoCommunicationService.getSubjectDefaultExpression"/>
          </customization>
        </schema>
      </schemas>
    </application>

  </applications>


</metadata>