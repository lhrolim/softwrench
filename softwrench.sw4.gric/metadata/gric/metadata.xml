<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">
  <templates>
    <!--WorkOrder-->
    <template path="@workorder.xml"/>
    <!--<template path="workorderbatch.xml"/>-->

    <!--ServiceRequest-->
    <template path="@servicerequest.xml"/>

    <template path="@quickservicerequest.xml"/>

    <!--Incident-->
    <template path="@incident.xml"/>

    <!--Inventory-->
    <template path="@inventory.xml"/>

    <!--Changes-->
    <template path="@wochange.xml"/>

    <!--Purchasing-->
    <template path="@receiving.xml"/>
    <template path="@purchasing.xml"/>

    <!--Solution-->
    <template path="@solution.xml"/>

    <!--Person-->
    <template path="@person.xml"/>

    <!--Workflow-->
    <template path="@workflow.xml"/>

    <!-- Bulletinboard -->
    <template path="@bulletinboard"/>
  </templates>

  <entities>
    <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum" whereclause="!@woclass like 'WORKORDER' and !@siteid = 'DRSSITE'">
    </entity>
    <entity name="asset" idAttribute="assetuid" useridAttribute="assetnum" whereclause="!@siteid = 'DRSSITE'">
    </entity>
    <entity name="location" idAttribute="locationsid" whereclause="!@siteid = 'DRSSITE'">
    </entity>
    <entity name="person" idAttribute="personuid" useridAttribute="personid" whereclause="!@locationsite = 'DRSSITE'">
    </entity>
  </entities>

  <applications>
    <application name="workorder" title="Work Order" entity="workorder" role="workorders">
      <schemas>
        <schema id="newdetail" platform="mobile" stereotype="detailnew">
          <field attribute="reportdate" label="Reported On" default="@now" hidden="true"/>
          <field attribute="wopriority" label="Priority">
            <renderer type="numericinput" params="min=1;max=5;decimals=0"/>
            <number decimals="0" min="0" max="999" />
          </field>

          <field attribute="assetnum" label="Asset" requiredexpression="true">
            <renderer type="custom" params="resourcepath=Content/Customers/firstsolar_offline/templates/fslocationdrilldownbutton.html"/>
          </field>
          <field attribute="location" label="Location" requiredexpression="true" hidden="true"/>

          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description"  />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>
        </schema>

        <detail platform="mobile" title="Work Order">
          <reference id="detailhiddensoffline"/>

          <field attribute="owner" label="Owner"  readonly="true"/>

          <reference id="statuslookup"/>
          <field attribute="wopriority" label="Priority">
            <renderer type="numericinput" params="min=1;max=5;decimals=0"/>
            <number decimals="0" min="0" max="999" />
          </field>

          <field attribute="assetnum" label="Asset" requiredexpression="true">
            <renderer type="custom" params="resourcepath=Content/Customers/firstsolar_offline/templates/fslocationdrilldownbutton.html"/>
          </field>
          <association label="Location" target="location" labelfield="location.description" showexpression="false"/>

          <!-- do not remove - added to force the sync of assets -->
          <association label="Asset" target="assetnum" labelfield="asset.description" showexpression="false"/>

          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description" />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>

          <composition relationship="labtrans" label="Labor">
            <event type="beforedelete" service="laborService" method="confirmPossibleTimer"/>
            <event type="afterdelete" service="laborService" method="cancelPossibleTimer"/>
            <collectionproperties allowupdate="false" allowcreation="@originalstatus!='CLOSED'" />
          </composition>
          <composition relationship="attachment" label="Attachments">
            <collectionproperties prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
          </composition>

          <commandbars>
            <commandgroup platform="mobile" position="mobile.fab" removeundeclared="false">
              <container id="detail.container" icon="fa-bolt">
                <!-- TODO: currently no support for merging command containers so repeating base commands -->
                <command id="quicksync"
                         service="itemActionService" method="quickSyncCurrentItem"
                         showexpression="service:itemActionService.shouldAllowQuickSyncForCurrentItem"
                         icon="ion-loop" label="Quick Sync"/>
                <command id="restoreitem"
                         service="itemActionService" method="deleteOrRestoreCurrentItem"
                         showexpression="service:itemActionService.shouldAllowDeleteOrRestoreForCurrentItem"
                         icon="ion-trash-a" label="Delete/Restore" cssclasses="red" />

                <command id="startlabtrans" service="laborService" method="startLaborTransaction"
                         showexpression="service:laborService.shouldAllowLaborStart"
                         icon="ion-play" label="Start Labor Report" cssclasses="green"/>
                <command id="finishlabtrans" service="laborService" method="finishLaborTransaction"
                         showexpression="service:laborService.shouldAllowLaborFinish"
                         icon="ion-stop" label="Finish Labor Report" cssclasses="red" />
              </container>
            </commandgroup>
          </commandbars>

        </detail>
      </schemas>
    </application>
  </applications>
</metadata>