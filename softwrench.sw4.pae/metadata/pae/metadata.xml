<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">
  <templates>
    <!--WorkOrder-->
    <template path="@workorder.xml"/>
    <!--<template path="workorderbatch.xml"/>-->

    <!--ServiceRequest-->
    <template path="@servicerequest.xml"/>

    <template path="@quickservicerequest.xml"/>

    <!--Incident-->
    <template path="@incident.xml"/>

    <!--Inventory-->
    <template path="@inventory.xml"/>

    <!--Changes-->
    <template path="@wochange.xml"/>

    <!--Purchasing-->
    <template path="@receiving.xml"/>
    <template path="@purchasing.xml"/>

    <!--Solution-->
    <template path="@solution.xml"/>

    <!--Person-->
    <template path="@person.xml"/>
  
  </templates>

  <entities>
    <entity name="paeasset" parententity="asset" idAttribute="assetuid" useridAttribute="assetnum">
      <attributes>
        <attribute name="assetid" type="bigint" required="true"/>
        <attribute name="assetnum" type="varchar" required="true" />
        <attribute name="locinfo" type="varchar" required="false" />
        <attribute name="plustmodel" type="varchar" required="false" />
        <attribute name="prophr" type="varchar" required="false" />
        <attribute name="partnum" type="varchar" required="false" />
        <attribute name="proptype" type="varchar" required="false" />
        <attribute name="proplinenum" type="bigint" required="false" />
        <attribute name="propmanuf" type="varchar" required="false" />
        <attribute name="description" type="varchar" required="true"/>
        <attribute name="invdate" type="datetime" required="true"/>
        <attribute name="invpostdate" type="datetime" required="true"/>
        <attribute name="invpostdateby" type="varchar" required="true"/>
        <attribute name="invposttype" type="varchar" required="true"/>
        <attribute name="status" type="varchar" required="false"/>
        <attribute name="vehorg" type="varchar" required="false"/>
        <attribute name="bcn" type="varchar" required="false"/>
        <attribute name="scanremarks" type="varchar" required="false"/>
      </attributes>
      <relationships>
        <relationship to="alndomain" qualifier="assettype">
          <relationshipAttribute from="proptype" to="value" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" allowsnull="true"/>
          <relationshipAttribute from="orgid" to="orgid" allowsnull="true"/>
          <relationshipAttribute to="domainid" literal="PROPTYPE" quoteLiteral="true"/>
        </relationship>
        <relationship to="alndomain" qualifier="assetstatus">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" allowsnull="true"/>
          <relationshipAttribute from="orgid" to="orgid" allowsnull="true"/>
          <relationshipAttribute to="domainid" literal="RSSASSETSTATUS" quoteLiteral="true"/>
        </relationship>
        <relationship to="alndomain" qualifier="assetvehorg">
          <relationshipAttribute from="vehorg" to="value" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" allowsnull="true"/>
          <relationshipAttribute from="orgid" to="orgid" allowsnull="true"/>
          <relationshipAttribute to="domainid" literal="VEHORG" quoteLiteral="true"/>
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWASSET" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Commons.PaeAssetCrudConnector"/>
      </connectorParameters>
    </entity>

    <entity name="prline" idAttribute="prlinenum">
      <relationships>
        <relationship to="longdescription" qualifier="ld">
          <relationshipAttribute from="prlineid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="PRLINE" quoteLiteral="true" />
        </relationship>
      </relationships>
    </entity>

    <entity name="pr" idAttribute="prnum" whereclause="pr.supervisor = @username">
      <attributes>
        <attribute name="swchangeby" type="varchar" required="true" />
      </attributes>
      <relationships>
        <relationship to="synonymdomain" qualifier="prstatus">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="PRSTATUS" quoteLiteral="true"/>
        </relationship>
        <relationship to="longdescription" qualifier="ld">
          <relationshipAttribute from="prid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="PR" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="DESCRIPTION" quoteLiteral="true" />
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="customconnector" value="softwrench.sw4.pae.classes.com.cts.pae.connector.PaePrCrudConnector" />
      </connectorParameters>
    </entity>
  </entities>

  <applications>
    <application entity="pr" name ="pr" title="Purchase Requests">
      <filters>
        <optionfilter attribute="status" eager="true" provider="prstatus_.description" displaycode="false" preselected="WAAA"/>
      </filters>

      <properties>
        <property key="application.maindetailschema" value="detail"/>
      </properties>

      <schemas>
        <schema id="list" redeclaring="false">
          <customization position="description"/>
          <customization position="vendor"/>
          <customization position="totalcost"/>
          <customization position="siteid"/>
          <customization position="status"/>

          <customization position="+prnum">
            <field attribute="prlineid" hidden="true"/>
            <field attribute="description" label="Description">
              <renderer type="default" params="excelwidth=50" />
            </field>
            <field attribute="status" label="Status">
              <renderer type="statuscolor" params="width=12%;grid=pr;column=status" />
            </field>
            <field attribute="requestedby" label="Requested By"/>
            <field attribute="totalcost" label="Total Cost">
              <renderer type="default" params="width=15%" />
            </field>
            <field attribute="supervisor" label="Appr. Authority"/>
          </customization>
          
          <commandbars>
            <commandgroup position="gridtop">
              <removecommand id="new"/>
            </commandgroup>
          </commandbars>

          <properties>
            <property key="list.preventnoresultsnew" value="true"/>
          </properties>
        </schema>

        <schema id="detail" stereotype="detail" mode="input">
          <section orientation="horizontal">
            <renderer type="default" params="childinputsize=small"/>
            <field attribute="prnum" label="PR#"/>
            <field attribute="description" label="Description"/>
            <association target="status" label="Status" labelfield="prstatus_.description" hideDescription="true"/>
            <field attribute="requestedby" label="Requested By"/>
            <optionfield attribute="priority" label="Priority" providerattribute="_SWPriorityType">
              <renderer type="lookup"/>
            </optionfield>
            <field attribute="requireddate" label="Required Date">
              <renderer type="datetime" params="format=MM/dd/yyyy HH:mm:ss"/>
            </field>
            <field attribute="totalcost" label="Total Cost" default="0"/>
            <field attribute="supervisor" label="Supervisor"/>
            <field label="PR Long Description" attribute="ld_.ldtext">
              <renderer type="richtext" params="inputsize=xlarge"/>
            </field>
          </section>

          <section id="compositions">
            <composition relationship="prline" label="PR Lines">
              <collectionproperties allowcreation="false" allowremoval="false" allowupdate="false"/>
            </composition>
          </section>

          <properties>
            <property key="detail.enabledfields" value=""/>
          </properties>

          <commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="save"/>
              <command id="approve" icon="fa-thumbs-up" label="Approve" service="paePrService" cssclasses="large-button" method="approve" parameters="datamap" position="+save" enableexpression="paePrService.areButtonsEnabled"/>
              <command id="reject" icon="fa-thumbs-down" label="Reject" service="paePrService" cssclasses="large-button" method="reject" parameters="datamap" position="+save" enableexpression="paePrService.areButtonsEnabled"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="memomodalapprove" stereotype="detail" mode="input" title="PR Approval">
          <field attribute="memo" label="Memo" requiredexpression="true"/>
          <commandbars>
            <commandgroup position="modal.detail.primary" platform="web">
              <removecommand id="save"/>
              <command id="approve" icon="fa-thumbs-up" label="Approve" service="paePrService" method="modalapprove" parameters="datamap" position="+save"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="memomodalreject" stereotype="detail" mode="input" title="PR Rejection">
          <field attribute="memo" label="Memo" requiredexpression="true"/>
          <commandbars>
            <commandgroup position="modal.detail.primary" platform="web">
              <removecommand id="save"/>
              <command id="approve" icon="fa-thumbs-down" label="Reject" service="paePrService" method="modalreject" parameters="datamap" position="+save"/>
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>

    <application entity="prline" name="prline" title="Purchase Request Line">
      <schemas>
        <schema id="list" stereotype="compositionlist" redeclaring="false">
          <customization position="prnum"/>
          <customization position="+prlineid">
            <field attribute="linetype" hidden="true"/>
          </customization>
          <customization position="+orderqty">
            <field attribute="orderunit" label="Order Unit"/>
          </customization>
          <customization position="+unitcost">
            <field attribute="linecost" label="Line Cost"/>
          </customization>
        </schema>
        
        <detail stereotype="compositiondetail" title="PR Line Details">
          <field attribute="storeloc" label="Storeroom"/>
          <field label="GL Debit Account" attribute="gldebitacct"/>
          <optionfield attribute="linetype" label="Line Type" >
            <renderer type="radio"/>
            <option label="Item" value="item"/>
            <option label="Material" value="material"/>
          </optionfield>
          <field label="Commodity Group" attribute="commoditygroup"/>
          <field label="RefWo " attribute="refwo"/>
          <field attribute="location" label="Location"/>
          <field attribute="loadedcost" label="Loaded Cost"/>
          <field attribute="assetnum" label="Asset"/>
          <field label="PR Line Long Description" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>
        </detail>
      </schemas>
    </application>

    <application name="companies" entity="companies" title="Companies">
      <schemas>
        <schema id="companiesLookupList" stereotype="list">
          <field attribute="company" label="Company"/>
          <field attribute="name" label="Name">
            <renderer type="default" params="minwidth=300px" />
          </field>
          <field attribute="type" label="Type"/>
          <field attribute="orgid"  label="Organization"/>
        </schema>
      </schemas>
    </application>

    <application name="transportation" title="Transportation" entity="paeasset" audit="true">
      <properties>
        <property key="mobile.presyncservice" value="paeAssetService.preSync"/>
        <property key="mobile.fetchlimit" value="100000"/>
      </properties>

      <components>
        <componentdisplayable id="transportation_hiddenfields">
          <field attribute="assetid" hidden="true"/>
          <field attribute="siteid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
          <field attribute="replacecost" hidden="true"/>
          <field attribute="totalcost" hidden="true"/>
          <field attribute="ytdcost" hidden="true"/>
          <field attribute="budgetcost" hidden="true"/>
          <field attribute="unchargedcost" hidden="true"/>
          <field attribute="totunchargedcost" hidden="true"/>
          <field attribute="totdowntime" hidden="true"/>
          <field attribute="priority" hidden="true"/>
          <field attribute="invcost" hidden="true"/>
        </componentdisplayable>
      </components>

      <schemas>
        <!-- #region web -->
        <list platform="web">
          <field attribute="assetnum" label="Asset" />
          <field attribute="description" label="Description"/>
          <field attribute="serialnum" label="VIN / SN" />
          <field attribute="location" label="Location" />
          <field attribute="vehorg" label="Vehicle Org" />
          <field attribute="bcn" label="BCN" />
          <field attribute="status" label="Status" />
        </list>
        
        <detail platform="web">
          <event type="onload" expression="$e.datamap['#originallocation'] = $e.datamap.location"/>

          <section orientation="horizontal">
            <field attribute="assetnum" label="Asset Number" readonly="true"/>
            <field attribute="description" label="Description" readonly="true"/>
            <field attribute="serialnum" label="VIN / SN"/>
            <association target="location" label="Location" labelfield="location_.description">
              <renderer type="lookup" />
              <dataprovider whereClause="location not in ('CAFB-VM-DRMO', 'CAFB-VM-VRC')"/>
            </association>
          </section>
          <section orientation="horizontal">
            <association target="vehorg" labelfield="assetvehorg.description" label="Vehicle Org">
              <renderer type="lookup"/>
            </association>
            <association target="status" labelfield="assetstatus.description" label="Status">
              <renderer type="lookup"/>
            </association>
            <field attribute="bcn" label="BCN"/>
          </section>
          <section orientation="horizontal">
            <field attribute="invdate" label="Inventory Date" readonly="true" />
            <field attribute="invpostdate" label="Inventory Post Date" readonly="true" />
            <field attribute="invpostdateby" label="Inventory Posted By" readonly="true"/>
            <field attribute="invposttype" label="Posted Type" readonly="true" />
          </section>
          <section orientation="horizontal">
            <field attribute="scanremarks" label="Scan Remark" />
            <field attribute="changeby" label="Changed By" readonly="true" />
            <field attribute="changedate" label="Changed Date" readonly="true">
              <date format="MM/dd/yyyy hh:mm"/>
            </field>
          </section>

          <reference id="transportation_hiddenfields"/>
          
        </detail>
        
        <!-- #endregion -->
        
        <!-- #region mobile -->
        <list platform="mobile">
          <event type="onload" service="paeAssetService" method="initTransportationGridListener"/>
          
          <field attribute="assetnum" label="Asset #" qualifier="title"/>
          <field attribute="description" label="Description" qualifier="subtitle"/>
          <field attribute="serialnum" label="VIN / SN" qualifier="excerpt"/>
        </list>
        
        <detail platform="mobile">
          <event type="onload" service="paeAssetService" method="initTransportationDetailListener"/>
          <event type="offline.presave" service="paeAssetService" method="transportationAssetChanged"/>
          
          <field attribute="assetnum" label="Asset #" readonly="true" qualifier="title"/>
          <field attribute="description" label="Description" readonly="true" qualifier="subtitle"/>
          <field attribute="serialnum" label="VIN / SN" qualifier="summary"/>
          <field attribute="location_.description" label="Location" readonly="true"/>
          <field attribute="vehorg" label="Vehicle Org" readonly="true"/>
          <field attribute="status" label="Status" readonly="true"/>
          <field attribute="bcn" label="BCN" />
          <field attribute="invdate" label="Inventory Date" readonly="true" />
          <field attribute="invpostdate" label="Inventory Post Date" readonly="true" />
          <field attribute="invpostdateby" label="Inventory Posted By" readonly="true"/>
          <field attribute="invposttype" label="Posted Type" readonly="true" />
          <field attribute="scanremarks" label="Scan Remark" />
          <field attribute="changeby" label="Changed By" readonly="true" />
          <field attribute="changedate" label="Changed Date" readonly="true" />

          <reference id="transportation_hiddenfields"/>
        </detail>
        <!-- #endregion -->
      </schemas>
    </application>

    <application name="asset" title="Asset" entity="paeasset" audit="true">
      <properties>
        <property key="mobile.presyncservice" value="paeAssetService.preSync"/>
        <property key="mobile.fetchlimit" value="100000"/>
      </properties>

      <schemas>
        <!-- #region mobile -->
        <list platform="mobile">
           <properties>
            <property key="list.width.min" value="768px"/>
          </properties>
          <event type="onload" service="paeAssetService" method="initAssetGridListener"/>
          
          <field attribute="assetid" hidden="true"/>
          <field attribute="assetnum" label="Asset" qualifier="title"/>
          <field attribute="location" label="Location" qualifier="subtitle"/>
          <field attribute="status" label="Status" qualifier="featured"/>
          <field attribute="propmanuf" label="Manufacturer" qualifier="excerpt"/>
        </list>
        
        <detail platform="mobile">
          <event type="onload" service="paeAssetService" method="initAssetDetailListener"/>
          
          <field attribute="plustsoldamt" hidden="true"/>
          <field attribute="plusttotalmprevenue" hidden="true"/>
          <field attribute="taxpercent" hidden="true"/>

          <field attribute="priority" hidden="true"/>
          <field attribute="totdowntime" hidden="true"/>
          <field attribute="purchaseprice" hidden="true"/>
          <field attribute="replacecost" hidden="true"/>
          <field attribute="totalcost" hidden="true"/>
          <field attribute="ytdcost" hidden="true"/>
          <field attribute="budgetcost" hidden="true"/>
          <field attribute="unchargedcost" hidden="true"/>
          <field attribute="totunchargedcost" hidden="true"/>
          <field attribute="invcost" hidden="true"/>
          <field attribute="location_.locationsid" hidden="true"/>
          <field attribute="assetid" hidden="true" />

          <field attribute="assetnum" label="Barcode Number"  readonly="true" />
          
          <association label="Status:" target="status" labelfield="assetstatus.description">
            <renderer type="lookup" params="avoidautofocus=true"/>
          </association>
          
          
          <association target="proptype" label="Property Type" labelfield="assettype_.description">
            <renderer type="lookup" />
          </association>
          <field attribute="description" label="Description" readonly="true"  />
          <field attribute="locinfo" label="Location Info" />
          <field attribute="plustmodel" label="Model" requiredexpression="true"/>
          <field attribute="partnum" label="Part Number" requiredexpression="true"/>
          <field attribute="propmanuf" label="Manufacturer"/>
          <field attribute="serialnum" label="Serial Number" requiredexpression="true"/>
          <association target="location" label="Location" labelfield="location_.description">
            <renderer type="lookup" />
          </association>
          <field attribute="prophr" label="Hand Receipt#" hidden="true"/>
          <field attribute="siteid"  label="Site" hidden="true"/>
          <field attribute="orgid"  label="Site" hidden="true"/>
        </detail>
        <!-- #endregion -->
          
        <list platform="web">
          <field attribute="assetid" hidden="true"/>
          <field attribute="assetnum" label="Asset" qualifier="title"/>
          <field attribute="location" label="Location" qualifier="subtitle"/>
          <field attribute="status" label="Status" qualifier="featured"/>
          <!--<field attribute="siteid" label="Site" qualifier="siteid" />-->
          <field attribute="propmanuf" label="Manufacturer"  qualifier="excerpt"/>
          <event type="onload" service="paeAssetService" method="initAssetGridListener"/>
          <properties>
            <property key="list.width.min" value="768px"/>
          </properties>
        </list>
        <detail platform="web">
          <field attribute="plustsoldamt" hidden="true"/>
          <field attribute="plusttotalmprevenue" hidden="true"/>
          <field attribute="taxpercent" hidden="true"/>

          <field attribute="priority" hidden="true"/>
          <field attribute="totdowntime" hidden="true"/>
          <field attribute="purchaseprice" hidden="true"/>
          <field attribute="replacecost" hidden="true"/>
          <field attribute="totalcost" hidden="true"/>
          <field attribute="ytdcost" hidden="true"/>
          <field attribute="budgetcost" hidden="true"/>
          <field attribute="unchargedcost" hidden="true"/>
          <field attribute="totunchargedcost" hidden="true"/>
          <field attribute="invcost" hidden="true"/>
          <field attribute="location_.locationsid" hidden="true"/>
          <field attribute="assetid" hidden="true" />

          <field attribute="assetnum" label="Barcode Number"  readonly="true" />

          <association label="Status:" target="status" labelfield="assetstatus.description">
            <renderer type="lookup" params="avoidautofocus=true"/>
          </association>


          <association target="proptype" label="Property Type" labelfield="assettype_.description">
            <renderer type="lookup" />
          </association>
          <field attribute="description" label="Description" readonly="true"  />
          <field attribute="locinfo" label="Location Info" />
          <field attribute="plustmodel" label="Model" requiredexpression="true"/>
          <field attribute="partnum" label="Part Number" requiredexpression="true"/>
          <field attribute="propmanuf" label="Manufacturer"/>
          <field attribute="serialnum" label="Serial Number" requiredexpression="true"/>
          <association target="location" label="Location" labelfield="location_.description">
            <renderer type="lookup" />
          </association>
          <field attribute="prophr" label="Hand Receipt#" hidden="true"/>
          <field attribute="siteid"  label="Site" hidden="true"/>
          <field attribute="orgid"  label="Site" hidden="true"/>
          <event type="beforesubmit.postvalidation" service="submitService" method="submitConfirmation"/>
          <event type="onload" service="paeAssetService" method="initAssetDetailListener"/>
        </detail>

        <schema id="assetLookupList" stereotype="list" platform="web">
          <field attribute="assetnum" label="Asset"/>
          <field attribute="description" label="Description">
            <renderer type="default" params="minwidth=300px" />
          </field>
          <field attribute="location" label="Location"/>
          <field attribute="siteid"  label="Site"/>
          <field attribute="status" label="Status"/>
        </schema>

      </schemas>
    </application>

    <application name="alndomain" entity="alndomain" title="AlnDomain">
      <schemas>
        <schema id="list">
          <field attribute="description" label="Description"></field>
          <field attribute="value" label="Value"></field>
          <field attribute="siteid" label="Siteid" hidden="true"></field>
          <field attribute="orgid" label="OrgId" hidden="true"></field>
          <field attribute="domainid" label="DomainId" hidden="true"></field>
        </schema>
      </schemas>
    </application>

  </applications>
</metadata>
