<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@woactivity.xml"/>
    <template path="@worklogs.xml"/>
    <template path="@person.xml"/>
    <template path="@workorder.xml"/>
    <template path="@location.xml"/>
    <template path="@servicerequest.xml"/>
    <template path="@quickservicerequest.xml"/>
    <template path="@failurecode.xml"/>

    <template path="@inventory.xml"/>
    
  </templates>

  <entities>
    <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum" whereclause="!@woclass like 'WORKORDER'">
      <attributes>
        <attribute name="lead2" type="varchar"/>
        <attribute name="wonum_sum" type="varchar" query="wonum + ': ' + coalesce(!@description,'')"/>
      </attributes>
      <relationships>
        <relationship to="alndomain" qualifier="crew">
          <relationshipAttribute from="crewid" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="CREWID" quoteLiteral="true"/>
        </relationship>
        <relationship to="failurelistonly" qualifier="failurelist" >
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>

        <relationship to="causelist">
          <relationshipAttribute from="fr1code" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>

        <relationship to="remedylist">
          <relationshipAttribute from="fr2code" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>

        <relationship to="problemlist" qualifier="problemlist">
          <relationshipAttribute from="problemcode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>

        <relationship to="person" qualifier="employee">
          <relationshipAttribute from="lead2" to="personid" primary="true"/>
        </relationship>

      </relationships>
    </entity>
    <entity name ="problemlist" parententity="failurelist" idAttribute="failurelist" whereclause="((problemlist.TYPE like 'PROBLEM')) " >
      <attributes>
        <attribute name="description" query="(select description from failurecode where failurecode = !@failurecode and orgid = !@orgid)" type="varchar"/>
      </attributes>
    </entity>
    <entity name="pm" idAttribute="pmuid" useridAttribute="pmnum">
      <attributes>
        <attribute name="notes" type="vachar"/>
      </attributes>
      
      <relationships>
        <relationship to="longdescription" qualifier="ld" lazy="true">
          <relationshipAttribute from="pmuid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="PM" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="DESCRIPTION" quoteLiteral="true" />
        </relationship>
        <relationship to="jobplan" qualifier="jp" lazy="true">
          <relationshipAttribute from="jpnum" to="jpnum" primary="true"/>
          <relationshipAttribute to="status" literal="ACTIVE" quoteLiteral="true" />
        </relationship>
        <relationship to="asset" >
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWPM"/>
      </connectorParameters>
    </entity>
    <entity name="jobplan" idAttribute="jobplanid" useridAttribute="jpnum">
      <attributes>
        <attribute name="jobplanid" type="bigint" required="true" />
        <attribute name="jpnum" type="varchar" required="true" />
        <attribute name="description" type="varchar" required="false" />
        <attribute name="status" type="varchar" required="true" />
      </attributes>
    </entity>

    <entity name="matusetrans" idAttribute="matusetransid" >
      <relationships>
        <relationship to="inventory">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="status" literal="ACTIVE"/>
        </relationship>
        <relationship to="item">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
          <relationshipAttribute to="itemtype" literal="ITEM" quoteLiteral="true"/>
          <relationshipAttribute to="status" literal="ACTIVE" quoteLiteral="true"/>
        </relationship>
        <relationship to="location" qualifier="storeroom">
          <relationshipAttribute from="siteid" to="siteid" primary="true" />
          <relationshipAttribute to="type" literal="STOREROOM" quoteLiteral="true" />
        </relationship>
        <relationship to="invbalances" qualifier="invbal" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="location" to="location" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="glcomponents">
          <relationshipAttribute from="gldebitacct" to="compvalue" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
          <relationshipAttribute to="glorder" literal="0" quoteLiteral="true"/>
        </relationship>
        <relationship to="inventory" qualifier="offlineinventory">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute to="status" literal="ACTIVE"/>
        </relationship>
        <relationship to="item" qualifier="offlineitem">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
          <relationshipAttribute to="itemtype" literal="ITEM" quoteLiteral="true"/>
          <relationshipAttribute to="status" literal="ACTIVE" quoteLiteral="true"/>
          <relationshipAttribute to="rotating" literal="0" quoteLiteral="true"/>
        </relationship>
        <relationship to="location" qualifier="offlinelocation">
          <relationshipAttribute from ="storeloc" to="location" primary="true" />
          <relationshipAttribute to="type" literal="STOREROOM" quoteLiteral="true" />
          <relationshipAttribute to="status" literal="OPERATING" quoteLiteral="true" />
        </relationship>
      </relationships>
    </entity>


  </entities>

  <applications>
    <application entity="SR" name="servicerequest" title="Service Request" role="sr">
      <schemas>
        <list title="Service Request Grid" stereotype="list.selection" redeclaring="true">
          <field attribute="ticketid" label="SR#">
            <renderer type="default" params="width=5%" />
          </field>
          <field attribute="description" label="Work Request">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field attribute="reportedby" label="Reported By">
            <renderer type="default" params="width=12%" />
          </field>
          <field attribute="reportedemail" label="Reported By Email">
            <renderer type="default" params="width=15%" />
          </field>
          <field label="Reported Date" attribute="reportdate">
            <renderer type="datetime" params="width=10%" />
          </field>
          <field attribute="owner" label="Owner">
            <renderer type="default" params="width=12%" />
          </field>
          <field attribute="siteid" hidden="true"/>
          <field attribute="status" label="Status">
            <renderer type="statuscolor" params="width=8%;grid=servicerequest;column=status" />
          </field>
          <field attribute="internalpriority" tooltip="Priority">
            <renderer type="priorityicon" params="width=5%;icon=fa-flag;headericon=true;changevalue=true;onclick=priorityService.setPriority"/>
          </field>
          <field attribute="communicationcounter" tooltip="Communications" hidden="true">
            <renderer type="icon" params="icon=fa-envelope-o;autoloadcomposition=commlog_"/>
          </field>
          <field attribute="attachmentcounter" tooltip="Attachments" hidden="true">
            <renderer type="icon" params="hideValueOnTooltip=true;icon=fa-paperclip;autoloadcomposition=attachment_"/>
          </field>
          <field attribute="relatedcounter" tooltip="Related Records" hidden="true">
            <renderer type="icon" params="icon=fa-tags;autoloadcomposition=relatedrecord_"/>
          </field>
          <field attribute="statusicons" tooltip="Status Icons">
            <renderer type="statusicons" params="width=9%;iconcolumns=communicationcounter,attachmentcounter,relatedcounter;icon=fa-tachometer;headericon=true;showsort=false"/>
          </field>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
            <property key="list.defaultorderby" value="sr.ticketuid desc"/>
            <property key="list.search.compositionstoexclude" value="attachment,relatedrecord"/>
          </properties>

          <commandbars>
            <commandgroup position="actions">
              <command id="Create" icon="fa-pencil" label="Change Status"
                       showexpression="service:genericTicketService.hasSelectedItemsForBatchStatus"
                       service="genericTicketService" method="initBatchStatusChange"
                       parameters="schema,datamap" cssclasses="large-button"/>
            </commandgroup>
          </commandbars>
        </list>
        <schema id="adetail" title="Request Details" abstract="true" stereotype="detail" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=200;inputsize=xlarge" />
              <renderer type="default" params="maxlength=200;inputsize=xlarge" />
            </field>
          </customization>
          <customization position="ld_.ldtext">
            <field label="Details/Location" attribute="ld_.ldtext">
              <renderer type="richtext"/>
            </field>
          </customization>
        </schema>

        <schema id="editdetail" parentschema="adetail" title="Service Request Details" redeclaring="false">
          <customization position="siteid"/>
        </schema>

        <schema id="nologinnewdetail" stereotype="detailnew" title="Service Request Details">
          <reference id="srhiddens"/>
          <field attribute="name" label="Full Name" requiredexpression="true"/>
          <field attribute="email" label="Email Address" requiredexpression="true">
            <renderer type="default" params="valtype=custom;valmessage=An '@umcsn.com' email is required.;valflags=i">
              <parameter key="valpattern" value="^(([^&lt;&gt;()\[\]\.,;:\s@\&quot;]+(\.[^&lt;&gt;()\[\]\.,;:\s@\&quot;]+)*)|(\&quot;.+\&quot;))@umcsn\.com$"/>
            </renderer>
          </field>
          <field attribute="phoneext" label="Phone Extension" requiredexpression="true">
            <renderer type="default" params="inputmaxlength=4;valtype=custom;valmessage=Phone extension is a sequence of four numbers.;valpattern=^\d{4}$"/>
          </field>
          <field attribute="customlocation" label="Location" requiredexpression="true"/>
          <field attribute="description" label="Request Summary" requiredexpression="true">
            <renderer type="richtext"/>
          </field>

          <commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="cancel"/>
              <removecommand id="save"/>
              <removecommand id="print"/>
              <command id="submit" icon="fa-check" service="umcNoLoginSubmitService" method="submit" label="Submit" cssclasses="large-button" tooltip="Submit Request" enableexpression="$scope:enableSave"/>
            </commandgroup>
          </commandbars>

          <properties>
            <property key="detail.show.toolbar.anonymous" value="true"/>
          </properties>
        </schema>

        <schema id="newdetail" parentschema="adetail" stereotype="detailnew" title="New Service Request" redeclaring="false">
          <customization position="siteid"/>
        </schema>

      </schemas>
    </application>

    <application entity="SR" name="quickservicerequest" title="Quick Requests" role="ssr">
      <schemas>
        <schema id="quicksrgrid" title="Quick Request Grid" stereotype="list" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request">
              <renderer type="default" params="excelwidth=50" />
            </field>
          </customization>
          <customization position="+reportedby">
            <field attribute="reportedemail" label="Reported By Email"/>
            <field label="Reported Date" attribute="reportdate">
              <renderer type="datetime" />
            </field>
          </customization>
        </schema>

        <schema id="quicknewdetail" stereotype="detailnew" title="New Quick Request" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=200;inputsize=xlarge" />
            </field>
          </customization>
          <customization position="ld_.ldtext">
            <field label="Details/Location" attribute="ld_.ldtext" >
              <renderer type="richtext"/>
            </field>
          </customization>
          <customization position="siteid"/>
        </schema>

        <schema id="quickeditdetail" stereotype="detail" title="Quick Request Details" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=200;inputsize=xlarge" />
            </field>
          </customization>
          <customization position="ld_.ldtext">
            <field label="Details/Location" attribute="ld_.ldtext" >
              <renderer type="richtext"/>
            </field>
          </customization>
          <customization position="siteid"/>
        </schema>
      </schemas>
    </application>

    <application name="workorder" title="Work Order" entity="workorder" role="workorders">

      <properties>
        <property key="list.offline.text.indexlist" value="wonum,asset_.description,status,description"/>
        <property key="list.offline.date.indexlist" value="schedstart"/>
      </properties>

      <schemas>
        <schema id="list" stereotype="list.selection" title="Work Order Grid" platform="web" redeclaring="true">
          <filters>
            <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px" />
            <optionfilter attribute="location" provider="location_.description" allowblank="true" displaycode="true"/>
            <optionfilter attribute="asset_.description" provider="asset_.description" allowblank="true" style="width:300px" displaycode="true" whereclause="!@assetnum in (!@#value)"/>
            <optionfilter attribute="wopriority" displaycode="true">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="High" value="1" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Medium" value="2" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Low" value="3" />
            </optionfilter>
            <optionfilter attribute="statusicons" displaycode="true">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Communications" value="communicationcounter" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Attachments" value="attachmentcounter" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Related Records" value="relatedcounter" />
            </optionfilter>
          </filters>
          <field attribute="wonum" label="WO#" >
            <renderer type="default" params="width=8%" />
          </field>
          <field attribute="worktype" label="Work Type" >
            <renderer type="default" params="width=8%" />
          </field>
          <field attribute="description" label="Work Request">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field label="Reported Date" attribute="reportdate">
            <renderer type="datetime" params="width=10%" />
          </field>
          <field attribute="location" label="Location">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="asset_.description" label="Asset Description">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="lead2" label="Employee" >
            <renderer type="default" params="width=8%" />
          </field>
          <field attribute="siteid" label="Site" hidden="true"/>
          <field attribute="status" label="Status">
            <renderer type="statuscolor" params="width=8%;grid=workorder;column=status" />
          </field>
          <field attribute="wopriority" tooltip="Priority">
            <renderer type="priorityicon" params="width=5%;icon=fa-flag;headericon=true;changevalue=true;onclick=priorityService.setPriority"/>
          </field>
          <field attribute="communicationcounter" tooltip="Communications" hidden="true">
            <renderer type="icon" params="icon=fa-envelope-o;autoloadcomposition=commlog_"/>
          </field>
          <field attribute="attachmentcounter" tooltip="Attachments" hidden="true">
            <renderer type="icon" params="hideValueOnTooltip=true;icon=fa-paperclip;autoloadcomposition=attachment_"/>
          </field>
          <field attribute="relatedcounter" tooltip="Related Records" hidden="true">
            <renderer type="icon" params="icon=fa-tags;autoloadcomposition=relatedrecord_"/>
          </field>
          <field attribute="statusicons" tooltip="Status Icons">
            <renderer type="statusicons" params="width=9%;iconcolumns=communicationcounter,attachmentcounter,relatedcounter;icon=fa-tachometer;headericon=true;showsort=false"/>
          </field>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
            <property key="list.defaultorderby" value="workorder.statusdate desc"/>
            <property key="list.noresultsnewschema" value="newdetail"/>
            <property key="list.search.compositionstoexclude" value="assetmeter,locationmeter"/>
            <property key="list.print.detailedlistschemaid" value="umcreport"/>
            <property key="list.print.detailedbydefault" value="true"/>
            <!--<property key="list.click.mode" value="@status == 'CLOSE' ? 'output' : 'input'"/>-->
          </properties>

          <commandbars>
            <commandgroup position="actions">
              <command id="Create" icon="fa-pencil" label="Change Status"
                       showexpression="service:genericTicketService.hasSelectedItemsForBatchStatus"
                       service="genericTicketService" method="initBatchStatusChange"
                       parameters="schema,datamap" cssclasses="large-button"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="adetail" title="Work Order Details" abstract="true" stereotype="detail" platform="web" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=200;inputsize=xlarge" />
            </field>
          </customization>
          <customization position="ld_.ldtext">
            <field label="Details/Location" attribute="ld_.ldtext">
              <renderer type="richtext"/>
            </field>
          </customization>

          <customization position="+#reportdateplaceholder">
            <association target="lead2" labelfield="employee_.displayname" label="Employee"/>
          </customization>

          <customization position="+hiddenfield">
            <section orientation="horizontal">
              <association label="Failure Class" target="failurecode" labelfield="failurelist_.description" extraprojectionvalues="failurelist" orderbyfield="failurecode asc" requiredexpression="true">
                <renderer type="lookup" />
              </association>
              <association label="Problem Code" enableexpression="@failurecode!=null" target="problemcode" labelfield="problemlist_.description" extraprojectionvalues="failurelist" requiredexpression="true" >
                <renderer type="lookup"  />
                <dataprovider prefilterfunction="FilterProblemCodes" />
              </association>
              <association label="Trade" target="crewid" labelfield="crew_.description" requiredexpression="true">
                <renderer type="lookup"/>
              </association>
            </section>
          </customization>
          <customization position="worktype">
            <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc" requiredexpression="true">
              <renderer type="lookup" params="inputsize=small"/>
            </association>
          </customization>

          <customization position="miscsection">
            <section orientation="horizontal" id="miscsection">
              <header displacement="ontop" label="Miscellaneous" params="fieldset=true" />
              <renderer type="default" params="childinputsize=medium" />
              <field label="Job Plan" attribute="jpnum" readonly="true">
                <renderer type="default" />
              </field>
              <association label="GL Account" target="glaccount" labelfield="glcomponents_.comptext" >
                <renderer type="modal" params="application=glcomponents;schema=detail;onsave=glcomponentService.getGLAccount;onload=glcomponentService.loadGLAccount;cssclass=crud-lookup-modal;title=Select GL Account;allowcustomvalue=true" />
              </association>

              <association label="On Behalf of" target="onbehalfof" labelfield="onbehalfofperson_.displayname">
                <renderer type="lookup" />
              </association>
              <section id="attachmentsection"/>
            </section>
          </customization>
          
          <properties>
            <property key="detail.disablesecondarycontent" value="true"/>
          </properties>
     

        </schema>

        <schema id="editdetail" parentschema="adetail"  title="Work Order Details" platform="web" redeclaring="false">

          <!--<customization position="failurecode"/>-->
          <!--<customization position="problemcode"/>-->

          
        
          <commandbars>
            <commandgroup position="actions">
              <command id="inprg" icon="fa-hourglass-2" label="Mark In Progress" position="right"
                       tooltip="Change Status to In Progress"
                       service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,INPRG"
                       cssclasses="large-button"
                       showexpression="@status == 'NEW' || (@status &amp;&amp; !@status.equalsAny('INPRG','CLOSE','COMP'))"
              />

              <command id="appr" icon="fa-thumbs-up" label="Approve"
                       cssclasses="large-button"
                       tooltip="Change Status to Approved"
                       service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,APPR"
                       showexpression="@status &amp;&amp; @status.equalsAny('WAPPR')"
              />

              <command id="comp" icon="fa-check" label="Complete"
                       cssclasses="large-button"
                       tooltip="Change Status to Completed"
                       service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,COMP"
                       showexpression="@status &amp;&amp; @status.equalsAny('APPR','INPRG')"
              />

              <command id="closed" icon="fa-close" label="Close"
                       cssclasses="large-button"
                       tooltip="Change Status to Closed"
                       service="genericTicketService" method="changeStatus" parameters="datamap,editdetail,CLOSE"
                       showexpression="@status != 'CLOSED' "
              />
            </commandgroup>

            <commandgroup position="detail.primary" removeundeclared="false">
              <command id="createWO" icon="fa-plus" service="workorderService" method="newWo" label="New" tooltip="New Work Order" cssclasses="large-button" position="-save"/>
            </commandgroup>
            
          </commandbars>

          <properties>
            <property key="detail.print.schemaid" value="umcreport"></property>
          </properties>
        
        </schema>

        <schema id="newdetail" parentschema="adetail" title="New Work Order"  platform="web" stereotype="detailnew" redeclaring="false">

        </schema>

        <schema id="workordercreationmodal" title="Fill In Workorder Details" stereotype="detail.modal" platform="web" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request:" requiredexpression="true"/>
          </customization>
          <customization position="ld_.ldtext">
            <field attribute="ld_.ldtext" label="Details/Location:" requiredexpression="false">
              <renderer type="textarea"/>
            </field>
          </customization>

        </schema>

        <schema id="newdetail" platform="mobile" stereotype="detailnew" redeclaring="false">
          <customization position="ld_.ldtext">
            <field label="Details/Location" attribute="ld_.ldtext">
              <renderer type="richtext"/>
            </field>
          </customization>
        </schema>


        <detail platform="mobile" title="Work Order">
          <reference id="detailhiddensoffline"/>

          <field attribute="owner" label="Owner"  readonly="true"/>

          <reference id="statuslookup"/>
          <field attribute="wopriority" label="Priority">
            <renderer type="numericinput" params="min=1;max=5;decimals=0"/>
            <number decimals="0" min="0" max="999" />
          </field>

          <field attribute="assetnum" label="Asset" requiredexpression="true">
            <renderer type="custom" params="resourcepath=Content/Customers/firstsolar_offline/templates/fslocationdrilldownbutton.html"/>
          </field>
          <association label="Location" target="location" labelfield="location.description" showexpression="false"/>

          <!-- do not remove - added to force the sync of assets -->
          <association label="Asset" target="assetnum" labelfield="asset.description" showexpression="false"/>

          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description" />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>
          <field label="Scheduled Start Date" attribute="schedstart" readonly="true">
            <renderer type="date"/>
          </field>

          <composition relationship="labtrans" label="Labor">
            <event type="beforedelete" service="laborService" method="confirmPossibleTimer"/>
            <event type="afterdelete" service="laborService" method="cancelPossibleTimer"/>
            <collectionproperties allowupdate="false" allowcreation="@originalstatus!='CLOSED'" />
          </composition>
          <composition relationship="attachment" label="Attachments">
            <collectionproperties prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
          </composition>

          <composition relationship="matusetrans" label="Material" >
            <collectionproperties allowupdate="false" allowcreation="@status!=='CLOSE'"/>
          </composition>


          <commandbars>
            <commandgroup platform="mobile" position="mobile.fab" removeundeclared="false">
              <container id="detail.container" icon="fa-bolt">
                <!-- TODO: currently no support for merging command containers so repeating base commands -->
                <command id="quicksync"
                         service="itemActionService" method="quickSyncCurrentItem"
                         showexpression="service:itemActionService.shouldAllowQuickSyncForCurrentItem"
                         icon="ion-loop" label="Quick Sync"/>
                <command id="restoreitem"
                         service="itemActionService" method="deleteOrRestoreCurrentItem"
                         showexpression="service:itemActionService.shouldAllowDeleteOrRestoreForCurrentItem"
                         icon="ion-trash-a" label="Delete/Restore" cssclasses="red" />

                <command id="startlabtrans" service="laborService" method="startLaborTransaction"
                         showexpression="service:laborService.shouldAllowLaborStart"
                         icon="ion-play" label="Start Labor Report" cssclasses="green"/>
                <command id="finishlabtrans" service="laborService" method="finishLaborTransaction"
                         showexpression="service:laborService.shouldAllowLaborFinish"
                         icon="ion-stop" label="Finish Labor Report" cssclasses="red" />
              </container>
            </commandgroup>
          </commandbars>

        </detail>

        <schema id="umcreport" stereotype="detail" mode="output" platform="web">

          <section>

            <field attribute="wonum_sum">
              <renderer type="default" params="outputclass=wonum_sum"/>
            </field>

            <field attribute="ld_.ldtext">
              <renderer type="richtext" params="class=bottom-border"/>
            </field>
          </section>

          <section>
            <renderer type="default" params="class=bottom-border"/>
            
            <association label="Asset" labelfield="asset_.description" target="asset"/>
            <association label="Location" labelfield="location_.description" target="location"/>
            <association label="Job Plan" labelfield="jobplan_.jpnum" target="jobplan"/>
          </section>

          <section orientation="horizontal">
            <section>
              <field attribute="wonum" label="WO"/>
              <field attribute="siteid" label="Site"/>
              <field attribute="status" label="Status"/>
              <field label="Parent" attribute="parent"/>
              <field label="Work Type" attribute="worktype">
                <renderer type="default" params="classexpression={'PM':'redbg'}"></renderer>
              </field>
              <field label="Trade" attribute="trade"/>
              <field label="Employee" attribute="employee_.displayname"/>
              <field label="Classification" attribute="classification"/>
              <field label="Risk Total" attribute=""/>
            </section>
            <section>
              <field attribute="targstartdate" label="Target Start">
                <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;showmeridian=true"/>
              </field>

              <field attribute="actstart" label="Actual Start">
                <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;showmeridian=true"/>
              </field>
              
              <field attribute="reportdate" label="Report Date">
                <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;showmeridian=true"/>
              </field>

              <field label="Priority" attribute="wopriority"/>
              <field label="Contract" attribute="contract"/>
              
              <field label="Failure Class" attribute="failurecode_.description"/>
              <field label="Problem Code" attribute="problemlist_.description"/>
              <field label="Cause" attribute="#causelist_.failurelist"/>
              <field label="Remedy" attribute="#remedylist_.failurelist"/>
              
            </section>
            
            <section>
              <field attribute="targcompdate" label="Target Finish">
                <renderer type="datetime" params="format=MM/dd/yyyy;showmeridian=true"/>
              </field>
              <field attribute="actfinish" label="Actual Finish">
                <renderer type="datetime" params="format=MM/dd/yyyy;showmeridian=true"/>
              </field>
              <field attribute="reportedby" label="Reported By"/>
              <field attribute="pmtype" label="PM Type"/>
            </section>
            
            
            
          </section>
          

          <properties>
            <property key="print.styleprops" value="@page{size:landscape; margin-left:0;margin-right:0; margin-top:0  }"/>
            <property key="print.customheader" value="/Content/Customers/umc/htmls/woreport/umcreportheader.html"/>
          </properties>

        </schema>
        
        
      </schemas>
    </application>

    <application name="labtrans" entity="labtrans" title="Labor">
      <schemas>
        <schema id="detail" redeclaring="false">
          <customization position="transtype">
            <field hidden="true" attribute="transtype" defaultexpression="71"/>
          </customization>
        </schema>

      </schemas>
    </application>

    <application name="worklog" title="Work Logs" entity="worklog" id="00000000-0000-0000-0000-000000000008">
      <schemas>
        <schema id="list"  stereotype="compositionlist" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" qualifier="title"/>
          </customization>
        </schema>

        <detail stereotype="compositiondetail" title="Work Log" platform="web" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=100"/>
            </field>
          </customization>

          <customization position="wld_.ldtext">
            <field attribute="wld_.ldtext" label="Details/Location" >
              <renderer type="richtext"/>
            </field>
          </customization>
        </detail>

        <detail stereotype="compositiondetail" title="Work Log" platform="mobile" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=100"/>
            </field>
          </customization>

          <customization position="wld_.ldtext">
            <field attribute="wld_.ldtext" label="Work Request" >
              <renderer type="richtext"/>
            </field>
          </customization>
        </detail>

      </schemas>
    </application>

    <application entity="woactivity" name="woactivity" title="WO Activity">
      <schemas>
        <schema id="list" title="woactivity" stereotype="compositionlist" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request"/>
          </customization>
        </schema>

        <detail stereotype="compositiondetail" redeclaring="false">
          <customization position="description">
            <field attribute="description" label="Work Request" requiredexpression="true">
              <renderer type="default" params="maxlength=100"/>
            </field>
          </customization>
          <customization position="ld_.ldtext">
            <field attribute="ld_.ldtext" label="Details/Location" >
              <renderer type="textarea"/>
            </field>
          </customization>

        </detail>

      </schemas>

    </application>

    <application entity="pm" name="pm" title="Preventive Maintenance">
      <schemas>
        <list title="PM Updater">
          <field attribute="siteid" hidden="true"/>
          <field attribute="pmnum" label="PM#">
            <renderer type="default" params="width=20%"/>
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" params="width=30%"/>
          </field>
          <field attribute="assetnum" label="Asset"/>
          <field attribute="jpnum" label="Job Plan"/>
          <field attribute="status" label="Status"/>


          <properties>
            <property key="list.selectionstyle" value="multiple"/>
          </properties>

          <commandbars>
            <commandgroup position="gridtop">
              <removecommand id="export"/>
              <removecommand id="print"/>
              <command id="editld" icon="fa-edit" label="Batch Update" enableexpression="service:umcPdService.isCommandEnabled" service="umcPdService" method="openUpdateLdModal" parameters="datamap" cssclasses="large-button"/>
            </commandgroup>
          </commandbars>
        </list>

        <schema id="editetail" stereotype="detail" title="Preventive Maintenance Details">
          <field attribute="pmuid" hidden="true"/>
          <field attribute="siteid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
          <field attribute="pmnum" label="PM#" readonly="true"/>
          <field attribute="description" label="Summary" requiredexpression="true"/>
          <field attribute="ld_.ldtext" label="Description">
            <renderer type="richtext"/>
          </field>

          <section orientation="horizontal">
            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location" >
              <renderer type="lookup" params="largemodal=true;application=asset;schemaId=assetLookupList;"/>
            </association>
            <association label="Job Plan" target="jpnum" labelfield="jp_.jpnum" extraprojectionvalues="jpnum,description">
              <renderer type="lookup" params="application=jobplan;schemaId=list;"/>
            </association>
            <optionfield attribute="status" label="Status" defaultexpression="DRAFT" requiredexpression="true">
              <option value="DRAFT" label="Draft"/>
              <option value="ACTIVE" label="Active"/>
              <option value="INACTIVE" label="Inactive"/>
            </optionfield>
          </section>

          <field attribute="notes" label="Notes"/>
          
        </schema>


        <schema id="viewdetail" stereotype="detail" title="Preventive Maintenance Details">
          <field attribute="pmnum" hidden="true"/>
          <field attribute="DESCRIPTION_LONGDESCRIPTION" label="Description"/>
        </schema>

        <schema id="updateld" stereotype="detail.modal" title="Preventive Maintenance Batch Update">
          <!--          <optionfield attribute="selectionmode" label="Selection Mode">-->
          <!--            <renderer type="radio"/>-->
          <!--            <option label="Current Page" value="currentselection" help="Applies the batch only to the current selected items"/>-->
          <!--            <option label="All Items Matching the Criteria" value="currentpage" help=""/>-->
          <!--          </optionfield>-->

          <field attribute="commonld" label="Long Description" requiredexpression="true">
            <renderer type="richtext" params="height=400"/>
          </field>
          <field attribute="notes" label="Notes" helpicon="right" tooltip="Additional notes regarding the selected pms"/>
          <field attribute="alias" label="Batch Identifier" helpicon="right" tooltip="An optional alias to help identifying this operation later"/>
        </schema>

        <schema id="pmsimplelist" stereotype="list">
          <field attribute="pmuid"/>
          <field attribute="pmnum"/>
        </schema>
      </schemas>
    </application>
    <application entity="jobplan" name="jobplan" title="Job Plan">
      <schemas>
        <schema id="list" stereotype="compositionlist" platform="web">
          <field attribute="jobplanid" hidden="true"/>
          <field attribute="status" hidden="true"/>
          <field attribute="jpnum" label="Job Plan"/>
          <field attribute="description" label="Summary"/>
        </schema>

<!--        <schema id="list" platform="mobile" stereotype="compositionlist">-->
<!--          <field attribute="description" label="Description"/>-->
<!--          <field attribute="jpnum" hidden="true"/>-->
<!--        </schema>-->

      </schemas>
    </application>

    <application name="matusetrans" title="Materials" entity="matusetrans" id="00000000-0000-0000-0000-000000000009">
      <schemas>
        <detail platform="web" redeclaring="false">
          <customization position="gldebitacct">
            <field label="GL Debit Account:" attribute="gldebitacct" default="0000-000-000-00000" hidden="true" />
          </customization>
        </detail>

        <list stereotype="compositionlist" platform="mobile">
          <field attribute="itemnum" label="Item#" />
          <field attribute="description" label="Description" />
          <field attribute="linetype" label="Type" />
          <field attribute="storeloc" label="Storeroom" />
          <field attribute="qtyrequested" label="Quantity" />
          <field attribute="unitcost" showexpression="@linetype==='MATERIAL'" label="Unit Cost">
            <renderer type="default" params="formatter=money"/>
          </field>
          <field attribute="transdate" label="Created Date" >
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;showtime=true"/>
          </field>
        </list>

        <detail stereotype="compositiondetail" platform="mobile">
          <!-- declared just so it can be fetched in sync -->
          <association target="#inventory" labelfield="offlineinventory.itemnum"
                       showexpression="false" enableexpression="false"
                       label="#inventory" />

          <field attribute="matusetransid" hidden="true" />
          <field attribute="refwo" hidden="true" />
          <field attribute="orgid" defaultexpression="$.parentdata.fields.orgid" hidden="true" />
          <field attribute="siteid" defaultexpression="$.parentdata.fields.siteid" hidden="true" />

          <field attribute="transdate" hidden="true" defaultexpression="@now" >
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;showtime=true"/>
          </field>

          <optionfield attribute="linetype" label="Type" default="ITEM">
            <event type="afterchange" service="materialService" method="lineSelected"/>
            <option label="ITEM" value="ITEM"/>
            <option label="MATERIAL" value="MATERIAL"/>
          </optionfield>

          <association target="storeloc" labelfield="offlinelocation_.location"
                       showexpression="@linetype==='ITEM'" requiredexpression="@linetype==='ITEM'"
                       label="Storeroom">
            <dataprovider whereClause="@materialService.getStoreRoomWhereClause"/>
            <event type="afterchange" service="materialService" method="storeRoomSelected"/>
          </association>

          <association target="itemnum" labelfield="offlineitem_.description" extraprojectionvalues="description"
                       showexpression="@linetype==='ITEM'" requiredexpression="@linetype==='ITEM'"
                       label="Item" >
            <dataprovider whereClause="@materialService.getAvailableItemsWhereClause"/>
            <event type="afterchange" service="materialService" method="itemSelected"/>
          </association>

          <!--          <association target="warranty" labelfield="warranty_.description" requiredexpression="true" label="Warranty">-->
          <!--            <renderer type="lookup" params="showCode=false"/>-->
          <!--          </association>-->

          <field attribute="description" label="Material Description" requiredexpression="true" showexpression="@linetype==='MATERIAL'"/>
          <field attribute="unitcost" label="Unit Cost" qualifier="quantity" requiredexpression="@linetype==='MATERIAL'" showexpression="@linetype==='MATERIAL'">
            <renderer type="numericinput" params="min=0;step=0.01" />
          </field>

          <field attribute="qtyrequested" label="Quantity" requiredexpression="true" qualifier="quantity" default="1">
            <renderer type="numericinput" params="min=1;max=100;decimals=0;step=1"/>
          </field>

        </detail>

      </schemas>
    </application>


    <application name="offlineitem" entity="item" title="Item">
      <schemas>
        <list platform="mobile">
          <field attribute="itemnum" label="Item" />
          <field attribute="description" label="Description"/>
          <field attribute="status" label="Status"/>
          <field attribute="itemtype" label="Type"/>
          <field attribute="rotating" label="Rotating"/>
          <field attribute="commoditygroup" label="Commodity Group"/>
        </list>
      </schemas>
      <properties>
        <property key="list.offline.text.indexlist" value="itemnum"/>
      </properties>
    </application>

  </applications>

</metadata>