<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.example.org/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.example.org/metadata ../../Schema/Metadata.xsd ">

  <templates>
    <template path="@worklogs.xml"/>
    <template path="@workorder.xml"/>
    <template path="@attachments.xml"/>
    <template path="@relatedrecords.xml"/>
    <template path="@commlogs.xml"/>
    <template path="@servicerequest.xml"/>
    <template path="@asset.xml"/>
    <template path="@longdescription.xml"/>
  
    <template path="@materials.xml"/>
    <template path="@labtrans.xml"/>
    <template path="@woactivity.xml"/>
  </templates>
  
  <entities>
    <entity name="SR" idAttribute="ticketid">
      <relationships>
        <relationship to="asset">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="site">
          <relationshipAttribute from="assetsiteid" to="siteid" primary="true"/>
        </relationship>
        <relationship to="location">
          <relationshipAttribute from="location" to="location" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="worklog" collection="true">
          <relationshipAttribute from="ticketid" to="recordkey" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="class" literal="SR" quoteLiteral="true" />
        </relationship>
        <relationship to ="commlog" collection="true">
          <relationshipAttribute from="ticketuid" to="ownerid" primary="true" />
          <relationshipAttribute to="ownertable" literal="SR" quoteLiteral="true"/>
        </relationship>
        <relationship to="longdescription" >
          <relationshipAttribute from="ticketuid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="TICKET" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="DESCRIPTION" quoteLiteral="true" />
        </relationship>
        <relationship to="DOCLINKS" qualifier="attachment" collection="true">
          <relationshipAttribute from="ticketuid" to="ownerid" primary="true"/>
          <relationshipAttribute to="ownertable" literal="SR" quoteLiteral="true"/>
        </relationship>
        <relationship to="relatedrecord" collection="true">
          <relationshipAttribute from="ticketid" to="recordkey" primary="true"/>
          <relationshipAttribute to="class" literal="SR" quoteLiteral="true"/>
        </relationship>
        <relationship to="classstructure">
          <relationshipAttribute from="classstructureid" to="classstructureid" primary="true"/>
        </relationship>
        <!--COMSW 24 Reverse Lookup of Service Address (Lazy Fetch)-->
        <relationship to="serviceaddress" reverselookupattribute="addresscode" >
          <relationshipAttribute from="ticketid" to="tkserviceaddress_.ticketid" primary="true"/>
        </relationship>
        <relationship to="tkserviceaddress">
          <relationshipAttribute from="ticketid" to="ticketid" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="class" literal="SR" quoteLiteral="true"/>
        </relationship>
        <relationship to="synonymdomain" qualifier="synstatus">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="SRSTATUS" quoteLiteral="true" />
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWSR" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Manchester.ComServiceRequestCrudConnector" />
      </connectorParameters>
    </entity>
    
    <entity name ="failurelistonly" parententity="failurelist" idAttribute="failurelist" whereclause="((failurelistonly.TYPE is null)) " >
    </entity>

    <entity name ="problemlist" parententity="failurelist" idAttribute="failurelist" whereclause="((problemlist.TYPE like 'PROBLEM')) " >
    </entity>

    <entity name="workorder" idAttribute="wonum">
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWWO" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Manchester.ComWorkOrderCrudConnector" />
      </connectorParameters>
    </entity>
  </entities>

  <applications>
    <application entity="SR" name="servicerequest" title="Service Request">
      <properties>
        <property key="mobile.disabled" value="true"/>
      </properties>
      <schemas>
        <schema id="adetail" title="Request Details" abstract="true" stereotype="detail">
          <section id ="siteidsection"/>
          <field attribute="ticketid" label="SR No:" readonly="true"/>
          <field attribute="ticketuid" label="SR No:" hidden="true"/>
          <field attribute="class" label="" hidden="true"/>
          <field attribute="actlabcost" hidden="true" />
          <field attribute="actlabhrs" hidden="true"/>
          <field attribute="siteid" hidden="true" />
          <field attribute="orgid" hidden="true"/>
          <field attribute="createby" hidden="true"/>

          <section id="statussection"/>
          <!--COMSW-1-->
          <optionfield attribute="classstructureid" label="Classification:" providerattribute="_SRClassStructureType" default="@classstructureid">
            <renderer type="autocompleteclient" />
          </optionfield>
          <!--SWWEB-342-->
          <field attribute="changeby" default="@username" hidden="true"/>
          <association label="Owner:" target="owner" labelfield="ownerperson_.displayname" enableexpression="@ownergroup==null">
            <renderer type="lookup"/>
            <event type="afterchange" service="genericTicetService" method="afterchangeowner"/>
          </association>
          <!-- Added the Owner Group field-->
          <association label="Owner Group:" target="ownergroup" labelfield="persongroup_.description" enableexpression="@owner==null">
            <renderer type="lookup"/>
            <event type="afterchange" service="genericTicetService" method="afterchangeownergroup"/>
          </association>
          <field attribute="reportedby" label="Reported By:" default="@username" readonly="true"/>
          <association label="Affected Person:" target="affectedperson" labelfield="person_.displayname" default="@username" >
            <renderer type="lookup" params="columnlabel=Name"/>
          </association>
          <!--Added Reported Date just the way it was in gric to otb Dt: 06/20/2014 -->
          <field label="Reported Date &amp; Time:" attribute="reportdate" readonly="true" default="@currentdatetime">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
          </field>
          <field attribute="targetstart" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="targetfinish" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="actualstart" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="actualfinish" hidden="true" attributeToServer="#notusedattribute"/>

          <section id="targetStart" resourcepath="/Content/Templates/samelinepickers.html"
                   parameters="joinattribute=targetstart;">
            <header label="Target Start Date:" displacement="sameline"/>
          </section>
          <section id="targetFinish" resourcepath="/Content/Templates/samelinepickers.html"
                   parameters="joinattribute=targetfinish;">
            <header label="Target Finish Date:" displacement="sameline"/>
          </section>
          <section id="actualStart" resourcepath="/Content/Templates/samelinepickers.html"
                   parameters="joinattribute=actualstart;">
            <header label="Actual Start Date:" displacement="sameline"/>
          </section>
          <section id="actualFinish" resourcepath="/Content/Templates/samelinepickers.html"
                   parameters="joinattribute=actualfinish;">
            <header label="Actual Finish Date:" displacement="sameline"/>
          </section>
          <field attribute="description" label="Summary:" requiredexpression="true"/>
          <field label="Details:" attribute="longdescription_.ldtext">
            <renderer type="richtext"/>
          </field>

          <!-- Code added from gric metadata.xml SWWEB 173-->
          <section id="attachmentsection" />
          <!--COMSW 24 required field for population purposes-->
          <field attribute="serviceaddress_.description" attributeToServer="#tkdesc" hidden="true" />
          <field attribute="serviceaddress_.staddrnumber" attributeToServer="#tkstaddrnumber" hidden="true" />
          <field attribute="serviceaddress_.staddrstreet" attributeToServer="#tkstaddrstreet" hidden="true" />
          <field attribute="serviceaddress_.staddrsttype" attributeToServer="#tkstaddrsttype" hidden="true" />
          <field attribute="serviceaddress_.formattedaddress" attributeToServer="#tkformattedaddress" hidden="true" />
          <!--COMSW 24 association field used for lazy lookup-->
          <association label="Service Address" target="saddresscode" labelfield="serviceaddress_.description" extraprojectionvalues="description, staddrnumber, staddrstreet, staddrsttype, formattedaddress" >
            <renderer type="lookup" />
          </association>

          <!-- SWWEB 173-->
          <!-- SWWEB 172: Changed the location and asset to make them look similar to gric-->
          <association label="Location:" target="location" labelfield="location_.description" dependantfields="siteid" >
            <event type="beforechange" service="genericTicetService" method="beforeChangeLocation"/>
            <!--renderer type="lookup"/-->
          </association>
          <association label="Asset:" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
            <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
            <dataprovider prefilterfunction="FilterAssets"/>
            <event type="afterchange" service="genericTicetService" method="afterChangeAsset"/>
          </association>
          <section id="compositions"/>
        </schema>

        <schema parentschema="adetail" title="New Service Request" id="newdetail">
          <section id="siteidsection">
            <field attribute="ticketid" label="Request #:" hidden="true"/>
            <association label="Site:" target="siteid" labelfield="site_.description" requiredexpression="true">
              <!-- removed default='@usersite' from the above association label-->
              <renderer type="lookup"/>
            </association>
          </section>
          <section id="statussection">
            <field label="Status:" attribute="status" readonly="true" default="NEW" hidden="true"/>
          </section>
          <!--SSWEB 173-->
          <section id="attachmentsection">
            <field label="Attachment:" attribute="newattachment" >
              <renderer type="upload"/>
            </field>
          </section>
        </schema>
        <schema parentschema="adetail" id="editdetail" title="Service Request Detail">
          <section id="siteidsection">
            <field attribute="ticketid" label="Request #:" readonly="true" requiredexpression="true"/>
            <field label="Site:" attribute="siteid" readonly="true"/>
          </section>
          <section id="statussection">
            <association label="Status:" target="status" labelfield="synstatus.description" requiredexpression="true">
              <renderer type="combo" />
            </association>
          </section>
          <section id="compositions">
            <composition relationship="worklog" label="Work Logs">
              <collectionproperties allowcreation="@status!='CLOSED'" allowupdate="true" />
            </composition>
            <composition relationship="commlog" label="Communication">
              <collectionproperties allowcreation="@status!='CLOSED'" allowupdate="false"/>
              <event type="onviewdetail" service="commlogService" method="updatereadflag"/>
            </composition>
            <composition relationship="attachment" label="Attachments">
              <collectionproperties allowcreation="@status!='CLOSED'" allowupdate="false"/>
            </composition>
            <composition relationship="relatedrecord" label="Related Records">
              <collectionproperties allowcreation="false" />
            </composition>
          </section>
          <commandbars>
            <commandgroup position="detailform">
              <command id="crud_delete" label="Delete" service="crudextraService" method="deletefn" parameters="schema,datamap"
                       showexpression="@status=='NEW' &amp;&amp; @reportedby==@username" successmessage="SR deleted" position="left"/>
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>
  </applications>
</metadata>