<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@worklogs.xml"/>
    <template path="@attachments.xml"/>
    <template path="@commlogs.xml"/>
    <template path="@materials.xml"/>
    <template path="@labtrans.xml"/>
    <template path="@tooltrans.xml"/>
    <template path="@woactivity.xml"/>
    <template path="@asset.xml"/>
    <template path="@jobplan.xml"/>

    <template path="@glcomponents.xml"/>
    <template path="@failurecode.xml"/>
    <template path="@meter.xml"/>

    <!--Applications required, temporarily for mobile, remove later-->
    <template path="@location.xml"/>
    <template path="@worktype.xml"/>
    <template path="@synstatus.xml"/>
    <template path="@route.xml"/>
    <template path="@relatedrecords.xml"/>
    <template path="@multiassetlocci.xml"/>
    <template path="@serviceaddress.xml"/>
  </templates>

  <entities>
    <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum" whereclause="!@woclass like 'WORKORDER'">
      <attributes>
        <attribute name="class" type="varchar" required="true" query="woclass"/>
      </attributes>
      <relationships>
        <relationship to="worklog" collection="true">
          <relationshipAttribute from="wonum" to="recordkey" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="class" literal="WORKORDER" quoteLiteral="true" />
        </relationship>
        <relationship to ="commlog" collection="true">
          <relationshipAttribute from="workorderid" to="ownerid" primary="true" />
          <relationshipAttribute to="ownertable" literal="WORKORDER" quoteLiteral="true"/>
        </relationship>
        <relationship to="matusetrans" collection="true">
          <relationshipAttribute from="wonum" to="refwo" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="labtrans" collection="true">
          <relationshipAttribute from="wonum" to="refwo" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="location" >
          <relationshipAttribute from="location" to="location" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="asset" >
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="failurecode" >
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
        <relationship to="worktype" >
          <relationshipAttribute from="worktype" to="worktype" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="chartofaccounts" >
          <relationshipAttribute from="glaccount" to="glaccount" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
       
        <relationship to="longdescription" qualifier="ld">
          <relationshipAttribute from="workorderid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="WORKORDER" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="DESCRIPTION" quoteLiteral="true" />
        </relationship>
        <relationship to="DOCLINKS" qualifier="attachment" collection="true">
          <relationshipAttribute from="workorderid" to="ownerid" primary="true"/>
          <relationshipAttribute to="ownertable" literal="WORKORDER" quoteLiteral="true"/>
        </relationship>
        <relationship to="tooltrans" collection="true">
          <relationshipAttribute from="wonum" to="refwo" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="multiassetlocci" collection="true">
          <relationshipAttribute from="wonum" to="RECORDKEY" primary="true"/>
          <relationshipAttribute from="woclass" to="RECORDCLASS" />
          <relationshipAttribute from="siteid" to="worksiteid" />
        </relationship>
        <relationship to="relatedrecord" collection="true">
          <relationshipAttribute from="wonum" to="recordkey" primary="true"/>
          <relationshipAttribute to="class" literal="WORKORDER" quoteLiteral="true"/>
        </relationship>
        
        <relationship to="failurelistonly" qualifier="failurelist">
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
        <relationship to="problemlist" qualifier="problemlist">
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
        <relationship to="person" qualifier="ownerperson">
          <relationshipAttribute from="owner" to="personid" primary="true"/>
        </relationship>
        <relationship to ="persongroup">
          <relationshipAttribute from ="ownergroup" to ="persongroup" primary="true"/>
        </relationship>
        <relationship to ="person" qualifier="onbehalfofperson">
          <relationshipAttribute from="onbehalfof" to ="personid" primary="true"/>
        </relationship>
        <relationship to="person" qualifier="reportedbyperson">
          <relationshipAttribute from="reportedby" to="personid" primary="true"/>
        </relationship>
        <relationship to="woactivity" collection="true">
          <relationshipAttribute from="wonum" to="parent" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="site">
          <relationshipAttribute from="siteid" to="siteid" primary="true"/>
          <relationshipAttribute to="active" literal="1" quoteLiteral="true"/>
        </relationship>
        <relationship to="worktype" qualifier="changecategory">
          <relationshipAttribute from="worktype" to="worktype" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
          <relationshipAttribute to="woclass" literal="CHANGE" quoteLiteral="true" />
        </relationship>
        <relationship to="longdescription" qualifier="reasonforchange">
          <relationshipAttribute from="workorderid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="WORKORDER" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="REASONFORCHANGE" quoteLiteral="true" />
        </relationship>
        <relationship to="longdescription" qualifier="exceptionreason">
          <relationshipAttribute from="workorderid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="WORKORDER" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="EXCEPTIONREASON" quoteLiteral="true" />
        </relationship>
        <!-- this collection = true here forces realtionship to be ignored on detail loading, which is what we need. that primary attribute is a fake one-->
        <relationship to ="glcomponents" collection="true">
          <relationshipAttribute from="glaccount" to="comptext" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
        <relationship to="synonymdomain" qualifier="synstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="WOSTATUS" quoteLiteral="true" />
        </relationship>

        <relationship to="locationmeter" collection="true" >
          <relationshipAttribute from="location" to="location" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" primary="true"/>
          <relationshipAttribute to="active" literal="1"/>
        </relationship>

        <relationship to="assetmeter" collection="true" >
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" primary="true"/>
          <relationshipAttribute to="active" literal="1"/>
        </relationship>
        <relationship to ="commlog" collection="true">
          <relationshipAttribute from="workorderid" to="ownerid" primary="true" />
          <relationshipAttribute to="ownertable" literal="WORKORDER" quoteLiteral="true"/>
        </relationship>
        <relationship to="multiassetlocci" collection="true">
          <relationshipAttribute from="wonum" to="RECORDKEY" primary="true"/>
          <relationshipAttribute from="woclass" to="RECORDCLASS" />
          <relationshipAttribute from="siteid" to="worksiteid" />
          <!--we need to exclde primary entries to keep consistency with maximo behaviour-->
          <relationshipAttribute to="ISPRIMARY" literal="0"/>
        </relationship>
        <relationship to="classstructure">
          <relationshipAttribute from="classstructureid" to="classstructureid" primary="true"/>
        </relationship>

        <relationship to="jobplan">
          <relationshipAttribute from="jpnum" to="jpnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        
        
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWWO" />
        <connectorParameter key="entermeter_customconnector" value="softWrench.sW4.Data.Persistence.Dataset.Commons.Ticket.Workorder.MeterReadingOperationHandler" />
        <!--        <connectorParameter key="markmultiassetcomplete_mif_customconnector" value="softWrench.sW4.Data.Persistence.Dataset.Commons.Ticket.Workorder.ProgressMultiAssetHandler" />-->
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Applications.Workorder.BaseWorkOrderCrudConnector" />
      </connectorParameters>
    </entity>
    
    <entity name ="problemlist" parententity="failurelist" idAttribute="failurelist" whereclause="((problemlist.TYPE like 'PROBLEM')) " >
      <attributes>
        <attribute name="description" query="(select description from failurecode where failurecode = !@failurecode and orgid = !@orgid)" type="varchar"/>
      </attributes>
    </entity>

    <entity name ="causelist" parententity="failurelist" idAttribute="failurelist" whereclause="((causelist.TYPE like 'CAUSE')) " >
      <attributes>
        <attribute name="description" query="(select description from failurecode where failurecode = !@failurecode and orgid = !@orgid)" type="varchar"/>
      </attributes>
    </entity>

    <entity name ="remedylist" parententity="failurelist" idAttribute="failurelist" whereclause="((remedylist.TYPE like 'REMEDY')) " >
      <attributes>
        <attribute name="description" query="(select description from failurecode where failurecode = !@failurecode and orgid = !@orgid)" type="varchar"/>
      </attributes>
    </entity>
    
  </entities>

  <applications>
    <application name="workorder" title="Work Order" entity="workorder" role="workorders">

      <components>
        <componentdisplayable id="classification">
          <optionfield attribute="classstructureid" label="Classification" providerattribute="_WOClassStructureType">
            <renderer type="lookup" params="inputsize=large" />
          </optionfield>
        </componentdisplayable>

        <componentdisplayable id="siteid">
          <association label="Site" target="siteid" labelfield="site_.description"
                   requiredexpression="true" defaultexpression="@user.site">
            <renderer type="lookup" />
          </association>
        </componentdisplayable>

        <componentdisplayable id="detailhiddensoffline">
          <field attribute="workorderid" hidden="true"/>
          <field attribute="orgid" hidden="true" />
          <field attribute="siteid" hidden="true"/>
          <field attribute="woclass" hidden="true"/>
          <field attribute="hasfollowupwork" hidden="true"/>
          <field attribute="origrecordid" hidden="true"/>
          <field attribute="origrecordclass" hidden="true"/>
          <field attribute="wonum" hidden="true" />
          <field attribute="reportdate" label="Reported On" default="@now" hidden="true"/>
          <field attribute="changeby" label="Changed By" hidden="true"/>
        </componentdisplayable>

        <componentdisplayable id="statuslookup">
          <association label="Status" target="status" labelfield="synstatus.description">
            <dataprovider prefilterfunction="FilterStatusCodes"/>
            <renderer type="lookup" params="avoidautofocus=true"/>
          </association>
        </componentdisplayable>


        
      </components>

      
      
      
      <properties>
        <property key="mobile.fetchlimit" value="300"/>
        <property key="mobile.presyncservice" value="workorderOfflineService.preSync"/>
        <property key="icon.composition.tab" value="fa fa-wrench"/>
        <property key="list.offline.text.indexlist" value="wonum,description,status,location,asset_.description"/>
        <property key="list.offline.date.indexlist" value="schedstartnotime"/>
        <property key="mobile.icon.provider" value="laborTimerIconProvider"/>
      </properties>
      
      <schemas>
        <schema id="list" stereotype="list.selection" title="Work Order Grid" platform="web">
          <filters>
            <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px" />
            <optionfilter attribute="location" provider="location_.description" allowblank="true" displaycode="true"/>
            <optionfilter attribute="asset_.description" provider="asset_.description" allowblank="true" style="width:300px" whereclause="!@assetnum in (!@#value)" displaycode="true"/>
            <optionfilter attribute="wopriority" displaycode="true">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="High" value="1" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Medium" value="2" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Low" value="3" />
            </optionfilter>
            <optionfilter attribute="statusicons" displaycode="true">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Communications" value="communicationcounter" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Attachments" value="attachmentcounter" />
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Related Records" value="relatedcounter" />
            </optionfilter>
          </filters>
          <field attribute="wonum" label="WO#" >
            <renderer type="default" params="width=10%" />
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field attribute="location" label="Location">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="asset_.description" label="Asset">
            <renderer type="default" params="width=25%" />
          </field>
          <field attribute="siteid" label="Site" hidden="true"/>
          <field attribute="status" label="Status">
            <renderer type="statuscolor" params="width=15%;grid=workorder;column=status" />
          </field>
          <field attribute="wopriority" tooltip="Priority">
            <renderer type="priorityicon" params="width=5%;icon=fa-flag;headericon=true;changevalue=true;onclick=priorityService.setPriority"/>
          </field>
          <field attribute="communicationcounter" tooltip="Communications" hidden="true">
            <renderer type="icon" params="icon=fa-envelope-o;autoloadcomposition=commlog_"/>
          </field>
          <field attribute="attachmentcounter" tooltip="Attachments" hidden="true">
            <renderer type="icon" params="hideValueOnTooltip=true;icon=fa-paperclip;autoloadcomposition=attachment_"/>
          </field>
          <field attribute="relatedcounter" tooltip="Related Records" hidden="true">
            <renderer type="icon" params="icon=fa-tags;autoloadcomposition=relatedrecord_"/>
          </field>
          <field attribute="statusicons" tooltip="Status Icons">
            <renderer type="statusicons" params="width=9%;iconcolumns=communicationcounter,attachmentcounter,relatedcounter;icon=fa-tachometer;headericon=true;showsort=false"/>
          </field>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
            <property key="list.defaultorderby" value="workorder.statusdate desc"/>
            <property key="list.noresultsnewschema" value="newdetail"/>
            <property key="list.search.compositionstoexclude" value="assetmeter,locationmeter"/>
            <!--<property key="list.click.mode" value="@status == 'CLOSE' ? 'output' : 'input'"/>-->
          </properties>

          <commandbars>
            <commandgroup position="actions">
              <command id="Create" icon="fa-pencil" label="Change Status"
                       showexpression="service:genericTicketService.hasSelectedItemsForBatchStatus"
                       service="genericTicketService" method="initBatchStatusChange"
                       parameters="schema,datamap" cssclasses="large-button"/>
            </commandgroup>
          </commandbars>
          
        </schema>

        <schema id="batchStatusChangeModal" stereotype="detail.modal" title="Change Status" platform="web">
          <association label="Status" target="status" labelfield="synstatus.description">
            <dataprovider prefilterfunction="FilterStatusCodes"/>
            <renderer type="lookup" params="avoidautofocus=true"/>
          </association>
        </schema>

        <schema id="wonumlookup" title="item" stereotype="list" platform="web">
          <field attribute="wonum"/>
          <field attribute="workorderid"/>
          <field attribute="siteid"/>
        </schema>

        <schema id="locationwolist" title="Work Orders" stereotype="compositionlist" platform="web">
          <properties>
            <property key="list.click.event" value="workorderService.goToDetail"/>
          </properties>
          <field attribute="workorderid" hidden="true"/>
          <field attribute="wonum" label="Work Order"/>
          <field attribute="description" label="Description"/>
          <field attribute="assetnum" label="Asset"/>
          <field attribute="status" label="Status"/>
          <field attribute="schedstart" label="Scheduled Start"/>
          <field attribute="wopriority" label="Priority"/>
          <field attribute="siteid" label="Site"/>
          <commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="save"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="assetwolist" title="Work Orders" stereotype="compositionlist" platform="web">
          <properties>
            <property key="list.click.event" value="workorderService.goToDetail"/>
          </properties>
          <field attribute="workorderid" hidden="true"/>
          <field attribute="wonum" label="Work Order"/>
          <field attribute="description" label="Description"/>
          <field attribute="assetnum" label="Asset"/>
          <field attribute="status" label="Status"/>
          <field attribute="schedstart" label="Scheduled Start"/>
          <field attribute="wopriority" label="Priority"/>
          <field attribute="siteid" label="Site"/>
          <!--<commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="save"/>
            </commandgroup>
          </commandbars>-->
        </schema>

        <schema id="ahiddendetails" title="schemaForHoldingHiddensOnly" abstract="true" stereotype="detail" platform="web">
          <field attribute="estdur"            hidden="true"/>
          <field attribute="estlabhrs"         hidden="true"/>
          <field attribute="estmatcost"        hidden="true"/>
          <field attribute="estintlabhrs"      hidden="true"/>
          <field attribute="estintlabcost"     hidden="true"/>
          <field attribute="estatapprlabhrs"   hidden="true"/>
          <field attribute="estatapprmatcost"  hidden="true"/>
          <field attribute="estatapprlabcost"  hidden="true"/>
          <field attribute="estatapprtoolcost" hidden="true"/>
          <field attribute="estatapprservcost" hidden="true"/>
          <field attribute="estapprlabhrs"     hidden="true"/>
          <field attribute="estapprmatcost"    hidden="true"/>
          <field attribute="estapprlabcost"    hidden="true"/>
          <field attribute="estlabcost"        hidden="true"/>
          <field attribute="esttoolcost"       hidden="true"/>
          <field attribute="estservcost"       hidden="true"/>
          <field attribute="actlabhrs"         hidden="true"/>
          <field attribute="actlabcost"        hidden="true"/>
          <field attribute="actservcost"       hidden="true"/>
          <field attribute="actmatcost"        hidden="true"/>
          <field attribute="acttoolcost"       hidden="true"/>
          <field attribute="outlabcost"        hidden="true"/>
          <field attribute="outmatcost"        hidden="true"/>
          <field attribute="outtoolcost"       hidden="true"/>
          <field attribute="outservcost"       hidden="true"/>
          <field attribute="workorderid"  readonly="true" hidden="true"/>
          <field attribute="route"  readonly="true" hidden="true"/>
          <section id="realfields"/>
        </schema>

        <schema id="adetail" title="Work Order Details" abstract="true" stereotype="detail" platform="web">
          <field attribute="workorderid" hidden="true"/>
          <field attribute="orgid"  requiredexpression="true" readonly="true" hidden="true"/>
          <field attribute="woclass" hidden="true"/>

          <!--TODO: investigate hidden fields on customizations not being added-->
<!--          <field attribute="crewid" hidden="true"/>-->

          <field attribute="class" hidden="true"/>
          <field attribute="synstatus_.maxvalue"  readonly="true" hidden="true"/>
          <field hidden="true" attribute="failurelist_.failurelist"/>
          
          <field attribute="pmnum"  hidden="true"/>
          <field attribute="cinum"  hidden="true"/>
          <!--          <field attribute="failurecode"  hidden="true"/>-->

          <!-- field used for PECSO customization -->
          <field attribute="tophiddenfield" hidden="true"/>

          <section orientation="horizontal">
            <renderer type="default" params="childinputsize=large" />
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100;inputsize=xlarge" />
            </field>
            <section id="statussection" />
            <section id="siteidsection"/>

            <!-- field used for PECSO customization -->
            <field attribute="locationhiddenfield" hidden="true"/>
          </section>

          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>




          <section orientation="horizontal">

            <section orientation="vertical">
              <header displacement="ontop" label="Work Details" params="fieldset=true" />
              <renderer type="default"/>

              <section orientation="horizontal">
                <renderer type="default" params="childinputsize=large" />
                <association label="Location" target="location" labelfield="location_.description"  dependantfields="siteid" enableexpression="!@siteid != null" extraprojectionvalues="serviceaddress_.latitudey, serviceaddress_.longitudex, serviceaddress_.addresscode, serviceaddress_.description, serviceaddress_.streetaddress, serviceaddress_.city, serviceaddress_.stateprovince, serviceaddress_.country">
                  <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
                  <renderer type="lookup" />
                </association>
                <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
                  <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
                  <dataprovider prefilterfunction="FilterAssets"/>
                  <event type="afterchange" service="genericTicketService" method="afterChangeAsset"/>
                </association>
              </section>

             <section orientation="horizontal" id="classsection">              
               <optionfield attribute="classstructureid" label="Classification" providerattribute="_WOClassStructureTypeDescription">
                 <renderer type="lookup" params="inputsize=large" />
               </optionfield>

                

                <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc">
                  <renderer type="lookup" params="inputsize=small"/>
                </association>

                <optionfield attribute="wopriority" label="Priority" providerattribute="_SWPriorityType">
                  <renderer type="lookup" params="inputsize=small"/>
                </optionfield>
                
              </section>
              <!-- field used to base custmozations for UMC from -->
              <field attribute="hiddenfield" hidden="true"/>
            </section>

            <section orientation="horizontal">
              <header displacement="ontop" label="Responsibility" params="fieldset=true" />
              <renderer type="default" params="childinputsize=large" />
              <association label="Owner"  target="owner" labelfield="ownerperson_.displayname" enableexpression="@ownergroup==null" orderbyfield="personid asc">
                <renderer type="lookup"  />
                <event type="afterchange" service="genericTicketService" method="afterchangeowner"/>
              </association>
              <association label="Owner Group" target="ownergroup" labelfield="persongroup_.description" enableexpression="@owner==null" orderbyfield="persongroup asc">
                <renderer type="lookup"  />
                <event type="afterchange" service="genericTicketService" method="afterchangeownergroup"/>
              </association>
              <association label="Reported By" target="reportedby" labelfield="reportedbyperson_.displayname" default="@personid" orderbyfield="personid asc" >
                <renderer type="lookup" params="columnlabel=Name;"/>
              </association>
              <field label="Reported Date &amp; Time" attribute="reportdate" readonly="true" default="@currentdatetime">
                <renderer type="datetime" />
              </field>
            </section>

          </section>


          <section secondarycontent="true" orientation="vertical">

            <composition inline="true" relationship="multiassetlocci" label="Multi Asset Locations:" detailschema="detail" showexpression="true">
              <collectionproperties listschema="newlist" autocommit="false" allowcreation="true"/>
              <renderer type="TABLE" params="mode=batch;"/>
            </composition>

            <section orientation="horizontal">
              <header displacement="ontop" label="Scheduling" params="fieldset=true" />

              <!-- target -->
              <section orientation="vertical">
                <field attribute="targstartdate" label="Target Start Date">
                  <renderer type="datetime" params="format=MM/dd/yyyy;"/>
                </field>
                <field attribute="targcompdate" label="Target Finish Date">
                  <renderer type="datetime" params="format=MM/dd/yyyy;"/>
                </field>
              </section>

              <!-- scheduled -->
              <section orientation="vertical">
                <field attribute="schedstart" label="Scheduled Start Date">
                  <renderer type="datetime" params="format=MM/dd/yyyy;"/>
                </field>
                <field attribute="schedfinish" label="Scheduled Finish Date">
                  <renderer type="datetime" params="format=MM/dd/yyyy;"/>
                </field>
              </section>

              <!-- actual -->
              <section orientation="vertical">
                <field attribute="actstart" label="Actual Start Date">
                  <renderer type="datetime" params="format=MM/dd/yyyy;"/>
                </field>
                <field attribute="actfinish" label="Actual Finish Date">
                  <renderer type="datetime" params="format=MM/dd/yyyy;"/>
                </field>
              </section>

            </section>

            <section orientation="horizontal">
              <header displacement="ontop" label="Miscellaneous" params="fieldset=true" />
              <renderer type="default" params="childinputsize=medium" />

              <association label="Failure Class" target="failurecode" labelfield="failurelist_.description" hideDescription="false" extraprojectionvalues="failurelist" orderbyfield="failurecode asc">
                <renderer type="lookup" />
              </association>
              <association label="Problem Code" enableexpression="@failurecode!=null" target="problemcode" labelfield="problemlist_.description">
                <renderer type="lookup"  />
                <dataprovider prefilterfunction="FilterProblemCodes" />
              </association>
              <field label="Job Plan" attribute="jpnum" readonly="true">
                <renderer type="default" />
              </field>
              <association label="GL Account" target="glaccount" labelfield="glcomponents_.comptext" >
                <renderer type="modal" params="application=glcomponents;schema=detail;onsave=glcomponentService.getGLAccount;onload=glcomponentService.loadGLAccount;cssclass=crud-lookup-modal;title=Select GL Account;allowcustomvalue=true" />
              </association>

              <association label="On Behalf of" target="onbehalfof" labelfield="onbehalfofperson_.displayname">
                <renderer type="lookup" />
              </association>

              <section id="attachmentsection"/>
            </section>

            <!-- field used for PECSO customization -->
            <field attribute="bottomhiddenfield" hidden="true"/>


          </section>

          <section id="compositions"/>


        </schema>

        <schema id="newdetail" parentschema="adetail" title="New Work Order"  platform="web" stereotype="detailnew">
          <section id="siteidsection">
            <association label="Site" target="siteid" labelfield="site_.description" requiredexpression="true" extraprojectionvalues="orgid">
              <renderer type="lookup" />
              <event type="afterchange" method="adjustOrgId" service="genericTicketService"/>
            </association>
          </section>


          <!--<section id="statussection">
            <field attribute="wonum" label="WO#" readonly="true">
              <renderer type="default" />
            </field>
            <field label="Status" attribute="status" readonly="true" default="WAPPR">
              <renderer type="default" />
            </field>
          </section>-->

          <section id="attachmentsection">
            <field label="Attachment" attribute="newattachment" >
              <renderer type="upload"/>
            </field>
          </section>
        </schema>

        <schema id="editdetail" parentschema="adetail"  title="Work Order Details" platform="web">
          <section id="wonumsection">
            <field attribute="wonum" label="WO#" readonly="true">
              <renderer type="default" />
            </field>
          </section>

          <section id="siteidsection">
            <field label="Site" attribute="siteid" readonly="true" requiredexpression="true">
              <renderer type="default" />
            </field>
          </section>

          <section id="statussection">
            <field attribute="wonum" label="WO#" readonly="true" hidden="true">
              <renderer type="default" />
            </field>
            <association label="Status" target="status" labelfield="synstatus.description">
              <dataprovider prefilterfunction="FilterStatusCodes"/>
              <renderer type="lookup" params="avoidautofocus=true"/>
            </association>
          </section>

          <section id="compositions">
            <composition relationship="worklog" label="Work Logs">
              <collectionproperties allowupdate="true" allowcreation="@status!='CLOSE'" orderbyfield="modifydate desc"/>
            </composition>

            <composition relationship="woactivity" label="WO Tasks">
              <collectionproperties allowupdate="false" allowcreation="false"  />
            </composition>
            <composition relationship="matusetrans" label="Materials">
              <collectionproperties allowupdate="false" allowcreation="@status!='CLOSE'" />
            </composition>
            <composition relationship="labtrans" label="Labor">
              <collectionproperties listschema="compositionlist" allowupdate="true" allowcreation="@status!='CLOSE'" allowremoval="@status!='CLOSE'" />
            </composition>
            <composition relationship="tooltrans" label="Tools">
              <collectionproperties allowupdate="false" allowcreation="@status!='CLOSE'" />
            </composition>
            <composition relationship="commlog" label="Communications">
              <collectionproperties allowcreation="@status!='CLOSE'" allowupdate="false"  orderbyfield="createdate desc"/>
              <event type="onviewdetail" service="commlogService" method="updatereadflag"/>
            </composition>
            <composition relationship="attachment" label="Attachments" printenabled="false" >
              <collectionproperties allowupdate="false" allowcreation="@status!='CLOSE'" allowremoval="@status!='CLOSE'" prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
            </composition>
            <composition relationship="assetmeter" label="Asset Meter Reading" detailschema="" hidden="true" fetchtype="manual">
              <collectionproperties allowcreation="false" listschema="composition"/>
            </composition>
            <composition relationship="locationmeter" label="Location Meter Reading" detailschema="" hidden="true" fetchtype="manual">
              <collectionproperties allowcreation="false" listschema="composition"/>
            </composition>
            <composition relationship="relatedrecord" label="Related Records">
              <collectionproperties allowupdate="false" allowcreation="@status!='CLOSE'"/>
            </composition>

            <tab label="Location Address" id="saddress" icon="fa-map-o" showexpression="(@location_.serviceaddress_.latitudey &amp;&amp; @location_.serviceaddress_.longitudex) || @location_.serviceaddress_.streetaddress">
              <section id="saddresssection" resourcepath="/Content/Templates/otb/saddress.html" parameters="zoom=19;tabid=saddress">
              </section>
            </tab>
          </section>
          <!--          <commandbars>-->
          <!--commented since no customization is possible currently-->
          <!--            <commandgroup position="actions">-->
          <!--              <container label="Actions" id="actioncontainer" icon="fa-bolt">-->
          <!--                <command id ="readmeters" icon="fa-tachometer" label="Enter Readings"  nextSchemaId="readings" stereotype="modal" -->
          <!--                         properties="modalclass=readingsmodal"-->
          <!--                         parameters="schema,datamap" service="meterReadingService" method="read"/>-->
          <!---->
          <!--                <command id ="applyroute" icon="fa-steam" label="Apply Route"  nextSchemaId="routes.selection" stereotype="modal"-->
          <!--                         properties="modalclass=readingsmodal"-->
          <!--                         parameters="schema,datamap" service="routeService" method="apply"/>-->
          <!--              </container>-->
          <!--            </commandgroup>-->
          <!--          </commandbars>-->
          <commandbars>
            <commandgroup position="actions">
<!--              <container label="Workflow" id="actioncontainer" icon="fa-bolt">-->
              <command id="initiateWorkflow" icon="fa-play" label="Initiate Workflow" parameters="schema,datamap" service="workflowService" method="initiateWorkflow" permissionexpression="@maximoVersionEvaluator.Is76" cssclasses="large-button"/>
              <command id="routeWorkflow" icon="fa-step-forward" label="Route Workflow" service="workflowService" method="routeWorkflow" permissionexpression="@maximoVersionEvaluator.Is76" cssclasses="large-button"/>
              <command id="stopWorkflow" icon="fa-stop" label="Stop WorkFlow" service="workflowService" method="stopWorkflow" permissionexpression="@maximoVersionEvaluator.Is76" cssclasses="large-button"/>
              <!-- Create new SR as Related Record -->
              <command id="createrelated" icon="fa-ticket" label="Create Request" service="workorderService" method="createRelatedSr" parameters="schema,datamap" cssclasses="large-button" enableexpression="$scope:enableSave"/>
<!--              </container>-->
            </commandgroup>
          </commandbars>
          <event type="beforesubmit.postvalidation" service="genericTicketService" method="handleStatusChange"/>
          <event type="beforesubmit.prevalidation" service="genericTicketService" method="validateCloseStatus"/>
          <event  type="onassociationsloaded" service="workorderService" method="setLocationFromAsset"/>
        </schema>

        <schema id="readings" title="Enter Meter Readings" platform="web">
          <field attribute="assetnum" hidden="true"></field>
          <field attribute="location" hidden="true"></field>
          <composition relationship="assetmeter" label="Asset Meter Reading" detailschema="">
            <collectionproperties allowcreation="false" listschema="composition"/>
          </composition>
          <composition relationship="locationmeter" label="Location Meter Reading" detailschema="">
            <collectionproperties allowcreation="false" listschema="composition"/>
          </composition>
        </schema>

        <schema id="workordercreationmodal" title="Fill In Workorder Details" stereotype="detail.modal" platform="web">
          <field attribute="description" label="Summary:" requiredexpression="true"/>
          <field attribute="ld_.ldtext" label="Details:" requiredexpression="false">
            <renderer type="textarea"/>
          </field>
          <optionfield attribute="classstructureid" label="Classification" providerattribute="_WOClassStructureTypeDescription">
            <renderer type="lookup" />
          </optionfield>
          <field attribute="assetnum" label="Asset" readonly="true" hidden="true"/>
          <field attribute="location" label="Location" readonly="true" hidden="true"/>
          <field attribute="reportedby" label="Reported by" default="@personid" readonly="true" hidden="true"/>
          <field attribute="reportdate" label="Reported date" default="@now" readonly="true" hidden="true"/>
          <field attribute="siteid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
        </schema>
        
        <!-- region: mobile-->
        <list platform="mobile" title="Work Order Grid">
          <field attribute="wonum" label="Number" qualifier="title"/>
          <field attribute="asset_.description" label="Asset" qualifier="subtitle"/>
          <field attribute="status" label="Status" qualifier="featured"/>
          <field attribute="description" label="Description" qualifier="excerpt"/>
        </list>

        <schema id="newdetail" platform="mobile" stereotype="detailnew">
          <field attribute="reportdate" label="Reported On" default="@now" hidden="true"/>
          <field attribute="wopriority" label="Priority">
            <renderer type="numericinput" params="min=1;max=5;decimals=0"/>
            <number decimals="0" min="0" max="999" />
          </field>
          <association label="Location" target="location" labelfield="location.description" />
          <association label="Asset" target="assetnum" labelfield="asset.description" />
          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description"  />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>
        </schema>
        
        <detail platform="mobile" title="Work Order">
          <reference id="detailhiddensoffline"/>
          
          <field attribute="owner" label="Owner"  readonly="true"/>
          
          <reference id="statuslookup"/>
          <field attribute="wopriority" label="Priority">
            <renderer type="numericinput" params="min=1;max=5;decimals=0"/>
            <number decimals="0" min="0" max="999" />
          </field>
          <association label="Location" target="location" labelfield="location.description" />
          <association label="Asset" target="assetnum" labelfield="asset.description" />
          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description" />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>
          
          <composition relationship="worklog" label="Work Logs" />
          <composition relationship="labtrans" label="Labor">
            <event type="beforedelete" service="laborService" method="confirmPossibleTimer"/>
            <event type="afterdelete" service="laborService" method="cancelPossibleTimer"/>
            <collectionproperties allowupdate="false" allowcreation="@status!='CLOSED'" />
          </composition>
          <composition relationship="attachment" label="Attachments">
            <collectionproperties prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
          </composition>

          <commandbars>
            <commandgroup platform="mobile" position="mobile.fab">
              <command id="startlabtrans" service="laborService" method="startLaborTransaction" 
                       icon="ion-play" showexpression="service:laborService.shouldAllowLaborStart" label="Start Labor Report" cssclasses="green" />
              <command id="finishlabtrans" service="laborService" method="finishLaborTransaction" 
                       icon="ion-stop" showexpression="service:laborService.shouldAllowLaborFinish" label="Finish Labor Report" cssclasses="red"/>
            </commandgroup>
          </commandbars>
          
        </detail>
        <!-- endregion -->

      </schemas>
    
    </application>


  </applications>




</metadata>
