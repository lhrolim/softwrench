<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@chartofaccounts.xml"/>
    <template path="@workorder.xml"/>
    <template path="@item.xml"/>
    <template path="@glcomponents.xml"/>
  </templates>

  <entities>

  </entities>

  <applications>

    <application entity="invuse" name="invuse" title="Inventory Transfer">
      <schemas>

        <schema id="transferline" stereotype="compositionlist">
          <association target="fromstoreloc" label="From Storeroom" labelfield="fromlocation_.description" requiredexpression="true" dependantfields="siteid" hideDescription="true">
            <renderer type="lookup" />
            <dataprovider prefilterfunction="FilterFromStoreLoc"/>
            <event type="afterchange" service="invtransferService" method="afterChangeFromStoreLoc"/>
          </association>
          <association label="From Bin" target="invuseline_.frombin" forcedistinctoptions="false" dependantfields="itemnum" labelfield="frominvbalance_.binnum" hideDescription="true" extraprojectionvalues="curbal,lotnum,binnum">
            <renderer type="lookup" params="application=invbalances;schemaId=binLookupList;inputsize=small"/>
            <event type="afterchange" service="invtransferService" method="afterChangeFromBin"/>
            <dataprovider prefilterfunction="FilterFromBin"/>
          </association>
          <field attribute="#curbal" label="Current Balance" readonly="true">
            <renderer type="default"  params="inputsize=small" />
          </field>
          <association target="tostoreloc" label="To Storeroom" labelfield="tolocation_.description" hideDescription="true" requiredexpression="true" extraprojectionvalues="tostoreloc">
            <dataprovider prefilterfunction="FilterToStoreLoc"/>
            <renderer type="lookup" params="inputsize=small" />
            <event type="afterchange" service="invtransferService" method="afterChangeToStoreLoc"/>
          </association>
        
          <association target="invuseline_.tobin" label="To Bin" labelfield="toinvbalance_.binnum" forcedistinctoptions="false" hideDescription="true" extraprojectionvalues="curbal,lotnum,binnum">
            <dataprovider prefilterfunction="FilterToBin" />
            <renderer type="lookup" params="application=invbalances;schemaId=binLookupList;allowFreeText=true;inputsize=small"/>
          </association>

          <association target="invuseline_.rotassetnum" label="Rotating Asset" labelfield="asset_.description" requiredexpression="true"
                                    extraprojectionvalues="binnum,lotnum" showexpression="@inventory_!=undefined &amp;&amp; @inventory_.item_.rotating==1" >
            <renderer type="lookup" />
          </association>
          <field attribute="invuseline_.quantity" label="Quantity" requiredexpression="true" default="1">
            <event type="afterchange" service="invtransferService" method="afterChangeTransferQuantity"/>
            <renderer type="numericinput" params="min=1;max=@curbal;inputsize=small"/>
          </field>
          <field attribute="invuseline_.unitcost" label="Unit Cost" hidden="true"/>
          <field attribute="inventory_.costtype" label="Cost Type" hidden="true"/>
          <field attribute="lotnum" hidden="true"/>

        </schema>


        <schema id="transferdetail" stereotype="compositiondetail">
          <field label="Lot" attribute="invuseline_.fromlot" readonly="true">
            <renderer type="default"  params="inputsize=small" />
          </field>
          <field attribute="inventory_.issueunit" label="Issue Unit" readonly="true">
            <renderer type="default"  params="inputsize=small" />
          </field>

        </schema>

        <schema id="newdetail" stereotype="detailnew" mode="input" title="New Inventory Transfer">

          <properties>
            <property key="routing.nextapplication" value="matrectransTransfers"/>
            <property key="nextschema.schemaid" value="matrectransTransfersList"/>
          </properties>

          <field attribute="usetype" hidden="true"/>
          <field attribute="invuseline_.fromstoreloc" default="@storeloc" hidden="true"/>
          <field attribute="mode" label="Mode" qualifier="batchselector" default="true" hidden="true"/>

          <section orientation="horizontal">
            <renderer type="default" params="childinputsize=medium" />
            <association label="Site" target="siteid" labelfield="site_.description"
             extraprojectionvalues="description" requiredexpression="true" hideDescription="true" default="@usersite">
              <renderer type="lookup" params="inputsize=medium" />
              <event type="afterchange" service="invtransferService" method="afterChangeSite"/>
            </association>
            <association label="Item" target="itemnum" forcedistinctoptions="true" labelfield="inventory_.item_.description"
                         extraprojectionvalues="itemnum,costtype,issueunit,unitcost,item_.description,item_.itemtype,item_.iskit,item_.rotating" requiredexpression="true">
              <renderer type="lookup" params="application=inventory;schemaId=inventoryLookupList;"/>
              <event type="afterchange" service="invtransferService" method="afterChangeItem"/>
            </association>
            <field attribute="inventory_.item_.itemtype" readonly="true" label="Item Type">
              <renderer type="default" />
            </field>
          </section>


          <composition inline="true" relationship="#batchitem" label="Transfers" detailschema="transferdetail" showexpression="@itemnum!=null">
            <collectionproperties listschema="transferline" autocommit="false"/>
            <renderer type="TABLE" params="mode=batch;composition.inline.startwithentry=true"/>
          </composition>


          <commandbars>
            <commandgroup position="detail.primary" removeundeclared="false">
              <removecommand id="print"/>
              <removecommand id="cancel"/>
              <command id="cancelTransfer" icon="fa fa-times" label="Cancel" service="invtransferService" method="cancel"/>
            </commandgroup>
          </commandbars>
          <event type="onload" service="scannerdetectionService" method="initInvuseTransferDetailListener"/>
        </schema>
      </schemas>
    </application>

  </applications>
</metadata>
