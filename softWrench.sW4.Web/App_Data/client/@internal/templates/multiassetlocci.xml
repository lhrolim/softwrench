<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <entities>

    <entity name="MULTIASSETLOCCI" idAttribute="multiid">
      <attributes>
        <attribute name="multiid" type="bigint" required="true" />
        <attribute name="assetnum" type="varchar" required="false" />
        <attribute name="location" type="varchar" required="false" />
        <attribute name="cinum" type="varchar" required="false" />
        <attribute name="sequence" type="int" required="false" />
        <attribute name="progress" type="smallint" required="true" />
        <attribute name="progress2" type="smallint" query="!@progress" />
        <attribute name="isprimary" type="smallint" required="true" />
        <attribute name="workorgid" type="varchar" required="false" />
        <attribute name="worksiteid" type="varchar" required="false" />
        <attribute name="orgid" type="varchar" required="false" />
        <attribute name="siteid" type="varchar" required="false" />
        <attribute name="comments" type="varchar" required="false" />
        <attribute name="route" type="varchar" required="false" />
        <attribute name="routestop" type="int" required="false" />
        <attribute name="movetoparent" type="varchar" required="false" />
        <attribute name="movetolocation" type="varchar" required="false" />
        <attribute name="movetobin" type="varchar" required="false" />
        <attribute name="performmoveto" type="smallint" required="true" />
        <attribute name="targetdesc" type="varchar" required="false" />
        <attribute name="recordkey" type="varchar" required="false" />
        <attribute name="recordclass" type="varchar" required="true" />
        <attribute name="langcode" type="varchar" required="true" />
        <attribute name="startassetfeatureid" type="bigint" required="false" />
        <attribute name="assetfeatureid" type="bigint" required="false" />
        <attribute name="endassetfeatureid" type="bigint" required="false" />
        <attribute name="endmeasure" type="decimal" required="false" />
        <attribute name="endoffset" type="decimal" required="false" />
        <attribute name="endyoffset" type="decimal" required="false" />
        <attribute name="endzoffset" type="decimal" required="false" />
        <attribute name="startmeasure" type="decimal" required="false" />
        <attribute name="startoffset" type="decimal" required="false" />
        <attribute name="startyoffset" type="decimal" required="false" />
        <attribute name="startzoffset" type="decimal" required="false" />
        <attribute name="movetosite" type="varchar" required="false" />
        <attribute name="newassetnum" type="varchar" required="false" />
        <attribute name="replacementsite" type="varchar" required="false" />
        <attribute name="replaceassetnum" type="varchar" required="false" />
        <attribute name="newreplaceassetnum" type="varchar" required="false" />
        <attribute name="hasld" type="smallint" required="true" />
        <attribute name="startyoffsetref" type="varchar" required="false" />
        <attribute name="endyoffsetref" type="varchar" required="false" />
        <attribute name="startzoffsetref" type="varchar" required="false" />
        <attribute name="endzoffsetref" type="varchar" required="false" />
        <attribute name="basemeasureunitid" type="varchar" required="false" />
        <attribute name="endbasemeasure" type="decimal" required="false" />
        <attribute name="endmeasureunitid" type="varchar" required="false" />
        <attribute name="endoffsetunitid" type="varchar" required="false" />
        <attribute name="startbasemeasure" type="decimal" required="false" />
        <attribute name="startmeasureunitid" type="varchar" required="false" />
        <attribute name="startoffsetunitid" type="varchar" required="false" />
        <attribute name="feature" type="varchar" required="false" />
        <attribute name="featurelabel" type="varchar" required="false" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>

      <relationships>
        <relationship to="assetmeter">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
        </relationship>
        <relationship to="asset">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="location">
          <relationshipAttribute from="location" to="location" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
      </relationships>

      <connectorParameters>
        <connectorParameter key="dbtable" value="MULTIASSETLOCCI" />
      </connectorParameters>
    </entity>

  </entities>
  
  
  <applications>
    <application name="multiassetlocci" title="Multi Asset Locci" entity="multiassetlocci">
      <schemas>
        <schema id="newlist" stereotype="compositionlist" platform="web">
          <!--<properties>
            <property key="expansible" value="false"/>
          </properties>-->
          <field attribute="multiid" hidden="true" defaultexpression="null"></field>
          <field attribute="siteid" hidden="true"></field>
          <field attribute="isprimary" hidden="true"></field>
          <association target="assetnum" labelfield="asset_.description" label="Asset" extraprojectionvalues="location" >
            <renderer type="lookup"/>
            <dataprovider prefilterfunction="FilterAssets"/>
            <event type="afterchange" service="multiassetlocciService" method="afterChangeAsset"/>
          </association>
          <association target="location" labelfield="location_.location" label="Location">
            <renderer type="lookup" params="allowcustomvalue=true"/>
            <event type="afterchange" service="multiassetlocciService" method="afterChangeLocation"/>
          </association>
          <field attribute="sequence" label="Sequence" >
            <renderer type="numericinput" params="min=1;width=10%"/>
          </field>
          <field attribute="progress" label="Progress">
            <renderer type="checkbox" params="editable=true;width=5%"/>
          </field>
          <field attribute="#isDirty" defaultexpression="true" showexpression="false" hidden="true"/>
          <commandbars>
            <commandgroup position="detail.primary" removeundeclared="true">
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="list" stereotype="compositionlist" platform="web">
          <properties>
            <property key="detail.cancel.lbl" value="Close"/>
            <property key="expansible" value="false"/>
          </properties>
          <field attribute="siteid" hidden="true"></field>
          <association target="assetnum" labelfield="asset_.assetnum" label="Asset">
            <renderer type="lookup"/>
          </association>
          <association target="location" labelfield="location_.location" label="Location" >
            <!--TODO: remove that parameter it´s a workaround-->
            <renderer type="lookup" params="allowcustomvalue=true"/>
          </association>
          <field attribute="sequence" label="Sequence" >
            <renderer type="numericinput" params="min=1;"/>
          </field>
          <field attribute="progress" label="Progress" >
            <renderer type="checkbox"/>
          </field>
          <commandbars>
            <commandgroup position="detail.primary" removeundeclared="true">
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="detail" stereotype="compositiondetail" platform="web">
          <field attribute="siteid" hidden="true"></field>
          <association target="assetnum" labelfield="asset_.assetnum" label="Asset">
            <renderer type="lookup"/>
          </association>
          <association target="location" labelfield="location_.location" label="Location">
            <renderer type="lookup"/>
          </association>
          <field attribute="sequence" label="Sequence">
            <renderer type="numericinput" params="min=1;"/>
          </field>
        </schema>
      </schemas>
    </application>
  </applications>
</metadata>
