<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.example.org/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.example.org/metadata ../../../Schema/Metadata.xsd ">

  <templates>
    <template path="@chartofaccounts.xml"/>
    <template path="@item.xml"/>
  </templates>
  
  <entities>
    <entity name="matusetrans" idAttribute="matusetransid" >
      <attributes>
        <attribute name="matusetransid"  type="bigint" required="true" />
        <attribute name="siteid"  type="varchar" required="true" />
        <attribute name="orgid"  type="varchar" required="true" />
        <attribute name="refwo"  type="varchar" required="true" />
        <attribute name="storeloc"  type="varchar" required="true" />
        <attribute name="itemnum"  type="varchar" required="true" />
        <attribute name="description"  type="varchar" required="true" />
        <attribute name="transdate"  type="datetime" required="true" />
        <attribute name="qtyrequested"  type="double" required="true" />
        <attribute name="unitcost"  type="double" required="true" />
        <attribute name="gldebitacct" type="varchar" required="false" />
      </attributes>
      <relationships>
        <relationship to="inventory">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute to="status" literal="ACTIVE"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="item" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
        </relationship>
        <relationship to="location" qualifier="storeroom">
          <relationshipAttribute from="siteid" to="siteid" primary="true" />
          <relationshipAttribute to="type" literal="STOREROOM" quoteLiteral="true" />
        </relationship>
        <relationship to="chartofaccounts" >
          <relationshipAttribute from="gldebitacct" to="glaccount" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="invbalances" qualifier="invbal" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="itemsetid" to="itemsetid" />
          <relationshipAttribute from="location" to="location" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
      </relationships>
    </entity>
    
    <entity name="inventory" idAttribute="inventoryid">
      <relationships>
        <relationship to="item" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
          <relationshipAttribute to="itemtype" literal="ITEM" quoteLiteral="true"/>
        </relationship>
        <relationship to="invcost" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="itemsetid" to="itemsetid" />
          <relationshipAttribute from="location" to="location" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="invbalances" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="itemsetid" to="itemsetid" />
          <relationshipAttribute from="location" to="location" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="dbtable" value="inventory" />
      </connectorParameters>
    </entity>
  </entities>

  <applications>
    <application name="inventory" title="Inventory" entity="inventory">
      <schemas>
        <schema id="materialLookupList" stereotype="list" mode="output">
          <field attribute="siteid" hidden="true"/>
          <field label="Item" attribute="itemnum"/>
          <field label="Description" attribute="item_.description"/>
          <field label="Storeroom" attribute="location"/>
        </schema>
      </schemas>
    </application>

    <application name="balances" title="Inventory" entity="invbalances">
      <schemas>
        <schema id="binLookupList" stereotype="list" mode="output">
          <field attribute="siteid" hidden="true"/>
          <field attribute="itemnum" hidden="true"/>
          <field label="Bin" attribute="binnum">
            <renderer type="default" params="width=15%"/>
          </field>
          <field label="Lot" attribute="lotnum">
            <renderer type="default" params="width=15%"/>
          </field>
        </schema>
      </schemas>
    </application>
    
    <application entity="invcost" name="invcost" title="invcost">
      <schemas>
        <schema id="list" title="Invcost List" stereotype="list">
          <field attribute="itemnum" label="Item"/>
          <field attribute="store" label="location"/>
          <field attribute="avgcost" label="Average Cost"/>
          <field attribute="stdcost" label="Standard Cost"/>
          <field attribute="lastcost" label="Last Cost"/>
        </schema>
      </schemas>
    </application>
    
    <application name="matusetrans" title="Materials" entity="matusetrans" id="00000000-0000-0000-0000-000000000009">
      <properties>
        <property key ="icon.composition.tab" value="fa fa-suitcase"/>
      </properties>
      <schemas>
        <list>
          <field attribute="matusetransid" hidden="true" />
          <field attribute="itemnum" label="Item No." qualifier="title"/>
          <field attribute="description" label="Description" qualifier="subtitle"/>
          <field attribute="linetype" label="Type" qualifier="subtitle"/>
          <field attribute="storeloc" label="Storeroom" qualifier="subtitle"/>
          <field attribute="qtyrequested" label="Quantity" qualifier="subtitle"/>
        </list>

        <detail platform="web">
          <field attribute="matusetransid" hidden="true" />
          <field attribute="orgid" hidden="true" />
          <field attribute="siteid" hidden="true" />
          <field attribute="refwo" hidden="true" />
          <field attribute="description" hidden="true" />
          <field attribute="transdate" hidden="true" />
          <field attribute="unitcost" hidden="true" />

          <optionfield attribute="linetype" label="Type:">
            <renderer type="combo"/>
            <option label="ITEM" value="ITEM"/>
            <option label="MATERIAL" value="MATERIAL"/>
            <event type="afterchange" service="matusetranService" method="afterlinetypechange"/>
          </optionfield>
          
          <association label="Item:" target="itemnum" labelfield="inventory_.item_.description, location" labelpattern="{0}" extraprojectionvalues="item_.description, itemsetid, location, siteid, costtype" showexpression="@linetype == 'ITEM'">
             <!--<dataprovider prefilterfunction="FilterMaterials"/>-->
            <renderer type="lookup" params="application=inventory;schemaId=materialLookupList;"/>
            <event type="afterchange" service="matusetranService" method="afteritemnumchange"/>
          </association>
          <field label="Storeroom:" attribute="storeloc" readonly="true" showexpression="@linetype == 'ITEM'"/>
          <!--<field label="Bin:" attribute="binnum" readonly="true" showexpression="@linetype == 'ITEM'"/>
          <field label="Lot:" attribute="lotnum" readonly="true" showexpression="@linetype == 'ITEM'"/>-->
          <association label="Bin:" target="binnum" labelfield="0invbal_.binnum" dependantfields="itemnum" showexpression="@linetype == 'ITEM'">
            <dataprovider postfilterfunction="filterMaterialBinnum"/>
          </association>
          <association label="Lot:" target="lotnum" labelfield="1invbal_.lotnum" dependantfields="itemnum" showexpression="@linetype == 'ITEM'">
            <dataprovider postfilterfunction="filterMaterialLotnum"/>
          </association>
          
          <field attribute="description" label="Material Description:" requiredexpression="true" showexpression="@linetype == 'MATERIAL'"/>
          <field attribute="unitcost" label="Unit Cost:" qualifier="quantity" requiredexpression="true" showexpression="@linetype == 'MATERIAL'"/>

          <field attribute="qtyrequested" label="Quantity:" requiredexpression="true" qualifier="quantity">
            <renderer type="numericinput" params="min=1;max=100;decimals=0"/>
          </field>
          
          <association label="GL Debit Account:" target="gldebitacct" labelfield="chartofaccounts_.accountname" >
            <renderer type="lookup"/>
          </association>
        </detail>
      </schemas>
    </application>

  </applications>




</metadata>
