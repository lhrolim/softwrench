<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@chartofaccounts.xml"/>
    <template path="@item.xml"/>
    <template path="@sparepart.xml"/>
  </templates>

  <entities>
    <entity name="matusetrans" idAttribute="matusetransid" >
      <attributes>
        <attribute name="itemnum" type="varchar" required="false" />
        <attribute name="storeloc" type="varchar" required="false" />
        <attribute name="transdate" type="datetime" required="true" />
        <attribute name="actualdate" type="datetime" required="true" />
        <attribute name="quantity" type="double" required="true" />
        <attribute name="curbal" type="double" required="true" />
        <attribute name="physcnt" type="double" required="true" />
        <attribute name="unitcost" type="double" required="true" />
        <attribute name="actualcost" type="double" required="true" />
        <attribute name="ponum" type="varchar" required="false" />
        <attribute name="conversion" type="double" required="false" />
        <attribute name="assetnum" type="varchar" required="false" />
        <attribute name="enterby" type="varchar" required="true" />
        <attribute name="it1" type="varchar" required="false" />
        <attribute name="it2" type="varchar" required="false" />
        <attribute name="it3" type="varchar" required="false" />
        <attribute name="it4" type="decimal" required="false" />
        <attribute name="it5" type="varchar" required="false" />
        <attribute name="memo" type="varchar" required="false" />
        <attribute name="outside" type="smallint" required="true" />
        <attribute name="issueto" type="varchar" required="false" />
        <attribute name="packingslipnum" type="varchar" required="false" />
        <attribute name="polinenum" type="int" required="false" />
        <attribute name="rollup" type="smallint" required="true" />
        <attribute name="itin1" type="varchar" required="false" />
        <attribute name="itin2" type="varchar" required="false" />
        <attribute name="itin3" type="varchar" required="false" />
        <attribute name="binnum" type="varchar" required="false" />
        <attribute name="lotnum" type="varchar" required="false" />
        <attribute name="issuetype" type="varchar" required="true" />
        <attribute name="gldebitacct" type="varchar" required="false" />
        <attribute name="glcreditacct" type="varchar" required="false" />
        <attribute name="linecost" type="double" required="true" />
        <attribute name="financialperiod" type="varchar" required="false" />
        <attribute name="currencycode" type="varchar" required="true" />
        <attribute name="currencyunitcost" type="double" required="false" />
        <attribute name="rotassetnum" type="varchar" required="false" />
        <attribute name="currencylinecost" type="double" required="false" />
        <attribute name="location" type="varchar" required="false" />
        <attribute name="description" type="varchar" required="false" />
        <attribute name="exchangerate" type="double" required="false" />
        <attribute name="sparepartadded" type="smallint" required="true" />
        <attribute name="qtyrequested" type="double" required="false" />
        <attribute name="exchangerate2" type="double" required="false" />
        <attribute name="linecost2" type="double" required="false" />
        <attribute name="mrnum" type="varchar" required="false" />
        <attribute name="mrlinenum" type="int" required="false" />
        <attribute name="matusetransid" type="bigint" required="true" />
        <attribute name="matrectransid" type="bigint" required="false" />
        <attribute name="it6" type="varchar" required="false" />
        <attribute name="it7" type="varchar" required="false" />
        <attribute name="it8" type="varchar" required="false" />
        <attribute name="it9" type="varchar" required="false" />
        <attribute name="it10" type="varchar" required="false" />
        <attribute name="itin4" type="varchar" required="false" />
        <attribute name="itin5" type="varchar" required="false" />
        <attribute name="itin6" type="varchar" required="false" />
        <attribute name="itin7" type="varchar" required="false" />
        <attribute name="sourcesysid" type="varchar" required="false" />
        <attribute name="ownersysid" type="varchar" required="false" />
        <attribute name="externalrefid" type="varchar" required="false" />
        <attribute name="sendersysid" type="varchar" required="false" />
        <attribute name="fincntrlid" type="varchar" required="false" />
        <attribute name="issueid" type="bigint" required="false" />
        <attribute name="qtyreturned" type="double" required="false" />
        <attribute name="orgid" type="varchar" required="true" />
        <attribute name="siteid" type="varchar" required="true" />
        <attribute name="refwo" type="varchar" required="false" />
        <attribute name="enteredastask" type="smallint" required="true" />
        <attribute name="linetype" type="varchar" required="true" />
        <attribute name="itemsetid" type="varchar" required="false" />
        <attribute name="conditioncode" type="varchar" required="false" />
        <attribute name="condrate" type="int" required="false" />
        <attribute name="commoditygroup" type="varchar" required="false" />
        <attribute name="commodity" type="varchar" required="false" />
        <attribute name="tositeid" type="varchar" required="true" />
        <attribute name="langcode" type="varchar" required="true" />
        <attribute name="hasld" type="smallint" required="true" />
        <attribute name="porevisionnum" type="int" required="false" />
        <attribute name="invuselineid" type="bigint" required="false" />
        <attribute name="invuseid" type="bigint" required="false" />
        <attribute name="consignment" type="smallint" required="true" />
        <attribute name="consinvoicenum" type="varchar" required="false" />
        <attribute name="consvendor" type="varchar" required="false" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>
      <relationships>
        <relationship to="inventory">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="status" literal="ACTIVE"/>
        </relationship>
        <relationship to="item">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
          <relationshipAttribute to="itemtype" literal="ITEM" quoteLiteral="true"/>
          <relationshipAttribute to="status" literal="ACTIVE" quoteLiteral="true"/>
          <relationshipAttribute to="rotating" literal="0" quoteLiteral="true"/>
        </relationship>
        <relationship to="location" qualifier="storeroom">
          <relationshipAttribute from="siteid" to="siteid" primary="true" />
          <relationshipAttribute to="type" literal="STOREROOM" quoteLiteral="true" />
        </relationship>
        <relationship to="invbalances" qualifier="invbal" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="location" to="location" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="chartofaccounts" >
          <relationshipAttribute from="gldebitacct" to="glaccount" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="sparepart">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
        </relationship>
      </relationships>
    </entity>
  </entities>

  <applications>
    <application entity="inventory" name="invlookup" title="invlookup">
      <schemas>
        <schema id="list" title="item" stereotype="list">
          <field attribute="itemnum" label="item"/>
          <field attribute="location" label="location"/>
          <field attribute="siteid" label="siteid"/>
          <field attribute="orgid" label="orgid"/>
          <!--Extract Data-->
          <field attribute="itemsetid" label="itemsetid"/>
          <field attribute="costtype" label="costtype"/>
        </schema>
      </schemas>
    </application>
    
    

    <application entity="item" name="itemlookup" title="itemlookup">
      <schemas>
        <schema id="list" title="item" stereotype="compositionlist">
          <field attribute="itemnum" label="item"/>
          <field attribute="itemsetid" label="itemsetid"/>
          <!--Extract Data-->
          <field attribute="commoditygroup" label="commoditygroup"/>
        </schema>
      </schemas>
    </application>

    <application entity="invcost" name="invcostlookup" title="invcost">
      <schemas>
        <schema id="list" title="item" stereotype="list">
          <field attribute="itemnum" label="item"/>
          <field attribute="location" label="location"/>
          <field attribute="conditioncode" label="conditioncode"/>
          <field attribute="siteid" label="siteid"/>
          <field attribute="orgid" label="orgid"/>
          <!--Extract Data-->
          <field attribute="stdcost" label="stdcost"/>
          <field attribute="avgcost" label="avgcost"/>
          <field attribute="lastcost" label="lastcost"/>
        </schema>
      </schemas>
    </application>

    <application entity="invbalances" name="invbalookup" title="invbal">
      <schemas>
        <schema id="list" title="item" stereotype="list">
          <field attribute="itemnum" label="item"/>
          <field attribute="location" label="location"/>
          <field attribute="conditioncode" label="conditioncode"/>
          <field attribute="siteid" label="siteid"/>
          <field attribute="orgid" label="orgid"/>
          <field attribute="binnum" label="binnum"/>
          <field attribute="lotnum" label="lotnum"/>
          <!--Extract Data-->
          <field attribute="curbal" label="balance"/>
          <field attribute="physcnt" label="physical"/>
        </schema>
      </schemas>
    </application>

    <application name="matusetrans" title="Materials" entity="matusetrans" id="00000000-0000-0000-0000-000000000009">
      <properties>
        <property key ="icon.composition.tab" value="fa fa-suitcase"/>
        <property key ="add.button.label" value="Add Material"/>
      </properties>
      <schemas>
        <list stereotype="compositionlist" platform="web">
          <field attribute="matusetransid" hidden="true" />
          <field attribute="itemnum" label="Item#" qualifier="title"/>
          <field attribute="description" label="Description" qualifier="subtitle"/>
          <field attribute="transdate" label="Created Date" />
          <field attribute="linetype" label="Type" qualifier="subtitle"/>
          <field attribute="storeloc" label="Storeroom" qualifier="subtitle"/>
          <field attribute="qtyrequested" label="Quantity" qualifier="subtitle"/>
        </list>

        <schema id="detail" stereotype="detail" title="Material Details" platform="web">
          <event type="onload" service="scannerdetectionService" method="initMaterialScanningListener" />
          <field attribute="matusetransid" hidden="true" />
          <field attribute="orgid" defaultexpression="$.parentdata['orgid']" hidden="true" />
          <field attribute="siteid" defaultexpression="$.parentdata['siteid']" hidden="true" />
          <field attribute="refwo" hidden="true" />
          <field attribute="description" hidden="true" />
          <field attribute="transdate" hidden="true" />

          <field attribute="lotnum" hidden="true" />
          <field attribute="binnum" hidden="true" />
          <field attribute="costtype" hidden="true" />
          <field attribute="unitcost" hidden="true" />

          <optionfield attribute="linetype" label="Type">
            <renderer type="combo"/>
            <option label="ITEM" value="ITEM"/>
            <option label="MATERIAL" value="MATERIAL"/>
            <option label="SPARE PART" value="SPAREPART"/>
          </optionfield>
         
          <association label="Item" target="itemnum" labelfield="sparepart_.description" extraprojectionvalues="description" showexpression="@linetype == 'SPAREPART'" requiredexpression="true">
            <dataprovider prefilterfunction="filterSpareParts"/>
            <renderer type="lookup" params="application=sparepart;schemaId=sparepartlist;"/>
            <event type="afterchange" service="matusetranService" method="afteritemchange"/>
          </association>
          
          <association label="Item" target="itemnum" labelfield="item_.description" extraprojectionvalues="description" showexpression="@linetype == 'ITEM'" requiredexpression="true">
            <dataprovider prefilterfunction="filterItems"/>
            <renderer type="lookup"/>
            <event type="afterchange" service="matusetranService" method="afteritemchange"/>
          </association>
    
          <association label="Storeroom" target="storeloc" labelfield="invbal0.location" dependantfields="itemnum" showexpression="@linetype == 'ITEM' || @linetype == 'SPAREPART'">
            <dataprovider postfilterfunction="filterStoreLoc"/>
            <event type="afterchange" service="matusetranService" method="afterchange"/>
            <renderer type="autocompleteclient" params="selectonlyavailableoption=true"/>
          </association>
          <association label="Bin" target="binnum" labelfield="invbal1.binnum" dependantfields="itemnum" showexpression="@linetype == 'ITEM' || @linetype == 'SPAREPART'">
            <dataprovider postfilterfunction="filterBinnum"/>
            <event type="afterchange" service="matusetranService" method="afterchange"/>
          </association>
          <association label="Lot" target="lotnum" labelfield="invbal2.lotnum" dependantfields="itemnum" showexpression="@linetype == 'ITEM' || @linetype == 'SPAREPART'">
            <dataprovider postfilterfunction="filterLotnum"/>
            <event type="afterchange" service="matusetranService" method="afterchange"/>
          </association>
          <association label="Condition" target="conditioncode" labelfield="invbal3.conditioncode" dependantfields="itemnum" showexpression="@linetype == 'ITEM' || @linetype == 'SPAREPART'">
            <dataprovider postfilterfunction="filterLotnum"/>
            <event type="afterchange" service="matusetranService" method="afterchange"/>
          </association>
          <field label="Available Balances" attribute="curbal" readonly="true" showexpression="@linetype=='ITEM' || @linetype == 'SPAREPART'"/>
          <field attribute="unitcost" label="Unit Cost" qualifier="quantity" readonly="true" showexpression="@linetype == 'ITEM' || @linetype == 'SPAREPART'"/>
          <field attribute="description" label="Material Description" requiredexpression="true" showexpression="@linetype == 'MATERIAL'"/>
          <field attribute="unitcost" label="Unit Cost" qualifier="quantity" requiredexpression="@linetype == 'MATERIAL'" showexpression="@linetype == 'MATERIAL'"/>
          <field attribute="qtyrequested" label="Quantity" requiredexpression="true" qualifier="quantity">
            <renderer type="numericinput" params="min=1;max=100;decimals=0"/>
          </field>
          <association label="GL Debit Account" target="gldebitacct" labelfield="chartofaccounts_.accountname">
            <renderer type="lookup"/>
          </association>
        </schema>

        
      </schemas>
    </application>
  </applications>

</metadata>
