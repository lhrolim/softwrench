<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@worklogs.xml"/>
    <template path="@attachments.xml"/>
    <template path="@relatedrecords.xml"/>
    <template path="@commlogs.xml"/>
    <template path="@failurecode.xml"/>
    <template path="@serviceaddress.xml"/>
  </templates>


  <applications>

    <application entity="SR" name="quickservicerequest" title="Quick Requests" role="ssr">
      <components>
        <componentdisplayable id="status">
          <field attribute="originalstatus" hidden="true"/>

          <association label="Status" target="status" labelfield="synstatus.description" requiredexpression="true" enableexpression="false">
            <dataprovider postfilterfunction="FilterAvailableStatus"/>
            <renderer type="lookup" />
          </association>
        </componentdisplayable>

        <componentdisplayable id="attachments">
          <composition relationship="attachment" label="Attachments" printenabled="false" >
            <collectionproperties allowupdate="false" allowcreation="@originalstatus!='CLOSED'" allowremoval="@originalstatus!='CLOSED'" prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
          </composition>
        </componentdisplayable>


        <componentdisplayable id="worklogs">
          <composition relationship="worklog" label="Work Logs">
            <collectionproperties allowcreation="@originalstatus!='CLOSED'" allowupdate="true" />
          </composition>
        </componentdisplayable>
        
        
        
      </components>

      <properties>
        <property key="mobile.disabled" value="true"/>
      </properties>
      <schemas>
        <schema id="quicksrgrid" title="Quick Request Grid" stereotype="list">

          <filters>
            <optionfilter attribute="status" provider="synstatus_.description"  displaycode="true"/>
            <optionfilter attribute="owner" provider="ownerperson_.displayname" allowblank="true">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Current User" value="@personid"/>
            </optionfilter>
            <optionfilter attribute="reportedby" provider="reportedbyp_.displayname" allowblank="true">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Current User" value="@personid"/>
            </optionfilter>
          </filters>

          <field attribute="ticketid" label="SR#">
            <renderer type="default" params="width=12%" />
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field attribute="reportedby" label="Reported By">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="owner" label="Owner">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="status" label="Status">
            <renderer type="statuscolor" params="width=12%;grid=quickservicerequest;column=status" />
          </field>
          <properties>
            <property key="list.click.schema" value="quickeditdetail"/>
            <property key="list.defaultorderby" value="sr.ticketuid desc"/>
          </properties>
        </schema>

        <schema id="quicknewdetail" stereotype="detailnew" title="New Quick Request">
          <properties>
            <property key="nextschema.schemaid" value="quicksrgrid"/>
          </properties>

          <section id="extrahiddenfields"/>

          <section orientation="horizontal" id="statussection">
            <renderer type="default" params="childinputsize=large" />
            <field attribute="ticketuid" label="SR#" hidden="true"/>
            <field label="Status" attribute="status" readonly="true" default="NEW" hidden="true"/>
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100;inputsize=xlarge" />
            </field>
          </section>

          <field label="Details" attribute="ld_.ldtext" >
            <renderer type="richtext"/>
          </field>

          <section orientation="horizontal" id="reportedbysection">
            <renderer type="default" params="childinputsize=medium" />
            <association label="Reported By" target="reportedby" labelfield="reportedbyp_.displayname" default="@personid" orderbyfield="personid asc" >
              <renderer type="lookup" params="columnlabel=Name;"/>
              <event type="afterchange" service="genericTicketService" method="afterChangeReportedBy"/>
            </association>
            <field attribute="reportedphone" label="Reported By Phone" default="@user.phone" readonly="true"/>
            <field attribute="reportedemail" label="Reported By Email" default="@user.email" readonly="true"/>
            <association label="Site" target="siteid" labelfield="site_.description" requiredexpression="true">
              <renderer type="lookup"/>
            </association>
            <association label="Location" target="location" labelfield="location_.description" dependantfields="siteid" >
              <renderer type="lookup"/>
              <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
            </association>
            <field label="Attachment" attribute="newattachment" >
              <renderer type="upload"/>
            </field>
          </section>
        </schema>

        <schema id="quickeditdetail" stereotype="detail" title="Quick Request Details">
          <properties>
            <property key="nextschema.schemaid" value="quicksrgrid"/>
          </properties>

          <section id="extrahiddenfields"/>


          <!-- hiddens for communication template -->
          <field attribute="changedate" hidden="true"/>
          <field attribute="classificationid" hidden="true"/>
          <field attribute="reportedemail" hidden="true"/>
          <field attribute="affectedemail" hidden="true"/>
          <field attribute="solution" hidden="true"/>
          <field attribute="assetsiteid" hidden="true"/>
          <field attribute="location" hidden="true"/>
          <field attribute="assetnum" hidden="true"/>
          <field attribute="failurecode" hidden="true"/>
          <field attribute="cinum" hidden="true"/>
          <field attribute="class" label="" hidden="true"/>
          <field attribute="ticketuid" hidden="true"/>

          <field attribute="ticketid" label="SR#" readonly="true" hidden="true"/>

          <section orientation="horizontal" id="statussection">
            <renderer type="default" params="childinputsize=large" />
            <field attribute="description" label="Summary" requiredexpression="true">
              <renderer type="default" params="maxlength=100;inputsize=xlarge" />
            </field>
            <reference id="status"/>
          </section>

          <field label="Details" attribute="ld_.ldtext" >
            <renderer type="richtext"/>
          </field>

          <section orientation="horizontal" id="reportedbysection">
            <renderer type="default" params="childinputsize=medium" />
            <association label="Reported By" target="reportedby" labelfield="reportedbyp_.displayname" default="@personid" orderbyfield="personid asc" >
              <renderer type="lookup" params="columnlabel=Name;"/>
              <event type="afterchange" service="genericTicketService" method="afterChangeReportedBy"/>
            </association>
            <field attribute="reportedphone" label="Reported By Phone" readonly="true"/>
            <field attribute="reportedemail" label="Reported By Email" readonly="true"/>
            <association label="Site" target="siteid" labelfield="site_.description" requiredexpression="true">
              <renderer type="lookup"/>
            </association>
            <association label="Location" target="location" labelfield="location_.description" dependantfields="siteid" >
              <renderer type="lookup"/>
              <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
            </association>
          </section>
          <section id="compositions">
            <reference id="attachments"/>
          </section>
        </schema>
      </schemas>
    </application>
  </applications>
</metadata>
