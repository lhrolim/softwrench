<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">
  
  <templates>
    <template path="@assetlocrelation.xml"/>
    <template path="@assetspec.xml"/>
    <template path="@locationmeter.xml"/>
    <template path="@sparepart.xml"/>
    <template path="@meter.xml"/>
    <template path="@safety.xml"/>
    
  </templates>
  <entities>

    <entity name="asset" idAttribute="assetuid" useridAttribute="assetnum">
      <relationships>
        <relationship to="site">
          <relationshipAttribute from="siteid" to="siteid" primary="true" />
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="synonymdomain" qualifier="synstatus" cacheable="true">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="LOCASSETSTATUS" quoteLiteral="true" />
        </relationship>
        <relationship to="AssetUserCust" qualifier="primaryuser">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute to="isprimary" literal="1" quoteLiteral="false"/>
        </relationship>
        <relationship to="AssetUserCust" qualifier="assetcustodian" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="assetspec" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="assettrans">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="location">
          <relationshipAttribute from="location" to="location" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="type" query="!@type not in ('STOREROOM','LABOR')" />
        </relationship>
        <relationship to="ticket" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="workorder" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="asset" qualifier="parentasset">
          <relationshipAttribute from="parent" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="asset" qualifier="childassets" collection="true">
          <relationshipAttribute from="assetnum" to="parent" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="asset" qualifier="subassembly" collection="true">
          <relationshipAttribute from="assetnum" to="ancestor" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="assetloccomm">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="assetloccomm">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="item">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
        </relationship>
        <relationship to="condition">
          <relationshipAttribute from="conditioncode" to="conditionnum" primary="true"/>
        </relationship>
        <relationship to="metergroup">
          <relationshipAttribute from="groupname" to="groupname" primary="true"/>
        </relationship>
        <relationship to="companies" qualifier="vendor">
          <relationshipAttribute from="vendor" to="company" primary="true"/>
          <relationshipAttribute to="type" literal="V" quoteLiteral="true"/>
        </relationship>
        <relationship to="companies" qualifier="manufacturer">
          <relationshipAttribute from="manufacturer" to="company" primary="true"/>
          <relationshipAttribute to="type" literal="M" quoteLiteral="true"/>
        </relationship>
        <relationship to="assetstatus">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="sparepart" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="assetmeter" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="classstructure">
          <relationshipAttribute from="classstructureid" to="classstructureid" primary="true"/>
        </relationship>
        <relationship to="assetlocrelation" collection="true" ignoreprimary="true">
          <!--Required to have a relationshipAttribute on relationship declaration, real query build in prefilterfunction-->
          <relationshipAttribute query=""/>
        </relationship>
        <relationship to="safetylexicon" qualifier="hazards" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute query="safetylexicon.tagoutid is null and sl.tagoutid is null"/>
        </relationship>
        <relationship to="safetylexicon" qualifier="hazardrousmaterials" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute query="hazard_.hazmatenabled = 1"/>
        </relationship>
        <relationship to="safetylexicon" qualifier="tagouts" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute query="safetylexicon.tagoutid is not null"/>
        </relationship>
        <relationship to="sprelatedasset" collection="true">
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
      </relationships>

    </entity>

    <entity name="assetstatus" idAttribute="assetnum">
      <attributes>
        <attribute name="assetnum" type="varchar" required="true" />
        <attribute name="wonum" type="varchar" required="false" />
        <attribute name="isrunning" type="smallint" required="true" />
        <attribute name="changedate" type="datetime" required="true" />
        <attribute name="changeby" type="varchar" required="true" />
        <attribute name="downtime" type="float" required="true" />
        <attribute name="calnum" type="varchar" required="false" />
        <attribute name="code" type="varchar" required="false" />
        <attribute name="operational" type="smallint" required="true" />
        <attribute name="location" type="varchar" required="false" />
        <attribute name="siteid" type="varchar" required="true" />
        <attribute name="orgid" type="varchar" required="true" />
        <attribute name="assetstatusid" type="bigint" required="true" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>
      <connectorParameters>
        <connectorParameter key="dbtable" value="assetstatus" />
      </connectorParameters>
    </entity>
    
   

    <entity name="condition" idAttribute="conditionid">
      <attributes>
        <attribute name="conditionid" type="bigint" required="true" />
        <attribute name="conditionnum" type="varchar" required="true" />
        <attribute name="type" type="varchar" required="true" />
        <attribute name="expression" type="varchar" required="false" />
        <attribute name="classname" type="varchar" required="false" />
        <attribute name="description" type="varchar" required="false" />
        <attribute name="nocaching" type="smallint" required="false" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>
      <connectorParameters>
        <connectorParameter key="dbtable" value="condition" />
      </connectorParameters>
    </entity>
  </entities>
  <applications>
    <application name="asset" title="Asset" entity="asset" id="00000000-0000-0000-0000-000000000001" >
      <filters>
        <optionfilter attribute="location" provider="location_.description" displaycode="true" allowblank="true"/>
        <optionfilter attribute="status" provider="synstatus_.description" displaycode="true"/>
        <optionfilter attribute="parent" provider="parentasset_.description" displaycode="true"/>
        <optionfilter attribute="siteid" provider="site_.siteid"/>
        <optionfilter attribute="priority" displaycode="true">
            <option xmlns="http://www.controltechnologysolutions.com/filters" label="High" value="1" />
            <option xmlns="http://www.controltechnologysolutions.com/filters" label="Medium" value="2" />
            <option xmlns="http://www.controltechnologysolutions.com/filters" label="Low" value="3" />
          </optionfilter>
        <optionfilter attribute="statusicons" displaycode="true">
          <option xmlns="http://www.controltechnologysolutions.com/filters" label="Active Work Orders" value="workordercounter" />
        </optionfilter>
      </filters>
      <properties>
        <property key="mobile.fetchlimit" value="2000"/>
        <property key="mobile.userInteractionEnabled" value="false"/>
        <property key="icon.composition.tab" value="fa fa-tags"/>
        <property key="list.offline.text.indexlist" value="location,assetnum"/>
      </properties>
      <schemas>
        
        <!--#region: Mobile-->
        <list id="list" platform="mobile">
          <field attribute="assetnum" label="Asset" qualifier="title"/>
          <field attribute="location" label="Location" qualifier="subtitle"/>
          <field attribute="vendor" label="Vendor"  qualifier="featured"/>
          <field attribute="description" label="Description"/>
        </list>
        
        <!--#endregion-->
        <!--<schema id="detail" stereotype="detail">
          <field attribute="assetid" label="ID"  requiredexpression="true" />
          <field attribute="assetnum" label="Asset"  requiredexpression="true" />
          <field attribute="location" label="Location"  requiredexpression="true" />
          <field attribute="vendor" label="Vendor"  />
          <field attribute="description" label="Description"  />
          <field attribute="failurecode" label="Failure Class"  />
          <field attribute="priority" label="Priority"  />
          <field attribute="siteid"  requiredexpression="true" readonly="true" hidden="true"/>
        </schema>-->
        <schema id="list" title="Asset Grid" stereotype="list"  platform="web">
          <properties>
            <property key="routing.nextapplication" value="asset"/>
            <property key="nextschema.schemaid" value="assetdetail"/>
            <property key="list.search.compositionstoexclude" value="assetlocrelation"/>
          </properties>
          <field attribute="assetnum" label="Asset"/>
          <field attribute="description" label="Description"/>
          <field attribute="location" label="Location"/>
          <field attribute="parent" label="Parent"/>
          <field attribute="status" label="Status"/>
          <field attribute="siteid" label="Site ID"/>
          <field attribute="priority" tooltip="Priority">
            <renderer type="priorityicon" params="width=5%;icon=fa-flag;headericon=true;changevalue=true;onclick=priorityService.setPriority"/>
          </field>
          <field attribute="workordercounter" tooltip="Active Work Orders" hidden="true">
            <renderer type="icon" params="icon=fa-wrench;autoloadcomposition=workorder_"/>
          </field>
          <field attribute="statusicons" tooltip="Status Icons">
            <renderer type="statusicons" params="width=9%;iconcolumns=workordercounter;icon=fa-tachometer;headericon=true;showsort=false"/>
          </field>
        </schema>
        <schema id="detail" title="Asset Detail" stereotype="detail" platform="web">
          <commandbars>
            <commandgroup position="actions">
<!--              <container id="actioncontainer" icon="fa-bolt" label="Actions">-->
                <command id="createWO" service="workorderService" method="openNewDetailModal"  label="Create W.O." icon="fa-wrench" cssclasses="large-button"/>
<!--              </container>-->
            </commandgroup>
          </commandbars>
          
          <field attribute="assetid" label="Asset#" readonly="true" hidden="true"/>
          <field attribute="assetuid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
          <field attribute="unchargedcost" hidden="true"/>
          <field attribute="totunchargedcost" hidden="true"/>
          
          <section orientation="horizontal">
            <renderer type="default" params="childinputsize=large" />
            <field attribute="assetnum" label="Asset:" readonly="true" hidden="true"/>
            <field attribute="description" label="Description" readonly="true">
              <renderer type="default" params="maxlength=100;inputsize=xlarge" />
            </field>
            <field attribute="status" label="Status" readonly="true"/>
            <field attribute="siteid" label="Site" readonly="true"/>
          </section>
          
          <section orientation="horizontal">
            <header displacement="ontop" label="Asset Description" params="fieldset=true" />
            <renderer type="default" params="childinputsize=medium" />
            <field attribute="parent" label="Parent" readonly="true"/>
            <field attribute="parentasset_.description" label="Parent Description" readonly="true"/>
            <field attribute="location" label="Location" readonly="true"/>
            <field attribute="location_.description" label="Location Description" readonly="true"/>
            <field attribute="assettype" label="Asset Type" readonly="true"/>
            <field attribute="itemnum" label="Rotating Item" readonly="true"/>
            <field attribute="item_.description" label="Item Description" readonly="true"/>
          </section>
          
          <section orientation="horizontal">
            <header displacement="ontop" label="Condition" params="fieldset=true" />
            <renderer type="default" params="childinputsize=medium" />

            <optionfield attribute="priority" label="Priority" providerattribute="_SWPriorityType" readonly="true">
              <renderer type="lookup"/>
            </optionfield>
            
            <field attribute="conditioncode" label="Condition Code" readonly="true"/>
            <field attribute="condition_.description" label="Condition Description" readonly="true"/>
            <field attribute="failurecode" label="Failure Class" readonly="true"/>
            <field attribute="serialnum" label="Serial #" readonly="true"/>
            <field attribute="groupname" label="Meter Group" readonly="true"/>
            <field attribute="metergroup_.description" label="Meter Group Description" readonly="true"/>
            <field attribute="usage" label="Usage" readonly="true"/>
          </section>
          
          <!-- Show more section -->
          <section secondarycontent="true">
            <section orientation="horizontal">
              <header displacement="ontop" label="Supply Information" params="fieldset=true" />
              <renderer type="default" params="childinputsize=medium" />
              <field attribute="vendor" label="Vendor" readonly="true"/>
              <field attribute="vendor_.name" label="Vendor Description" readonly="true"/>
              <field attribute="manufacturer" label="Manufacturer" readonly="true"/>
              <field attribute="monufacturer" label="Manufacturer Description" readonly="true"/>
            </section>
            
            <section orientation="horizontal">
              <header displacement="ontop" label="Budget Information" params="fieldset=true" />
              <renderer type="default" params="childinputsize=medium" />
              <field attribute="installdate" label="Installation Date" readonly="true"/>
              <field attribute="purchaseprice" label="Purchase Price" readonly="true"/>
              <field attribute="replacecost" label="Replacement Cost" readonly="true"/>
              <field attribute="assettrans_.ponum" label="PO" readonly="true"/>
              <field attribute="totalcost" label="Total Cost" readonly="true"/>
              <field attribute="ytdcost" label="YTD Cost" readonly="true"/>
              <field attribute="budgetcost" label="Budget Cost" readonly="true"/>
              <field attribute="invcost" label="Inventory" readonly="true"/>
            </section>
            
            <section orientation="horizontal">
              <header displacement="ontop" label="Status" params="fieldset=true" />
              <renderer type="default" params="childinputsize=medium" />
              <field attribute="isrunning" label="Asset Up?" enableexpression="false">
                <renderer type="checkbox"/>
              </field>
              <field attribute="assetstatus_.changedate" label="Status Date" readonly="true"/>
              <field attribute="totdowntime" label="Total Downtime" readonly="true"/>
            </section>
            
            <section orientation="horizontal">
              <header displacement="ontop" label="Change Information" params="fieldset=true" />
              <renderer type="default" params="childinputsize=medium" />
              <field attribute="changeby" label="Change By" readonly="true"/>
              <field attribute="changedate" label="Change Date" readonly="true"/>
            </section>
          </section>
          <tab id="spareparts" label="Spare Parts" icon="fa-download" countrelationship="sparepart">
            <section orientation="horizontal">
              <renderer type="default" params="childinputsize=small" />
              <field attribute="assetnum" label="Asset" readonly="true"/>
              <field attribute="desription" label="Description" readonly="true"/>
              <field attribute="siteid" label="Site" readonly="true"/>
              <field attribute="parentasset_.assetnum" label="Parent" readonly="true"/>
              <field attribute="parentasset_.description" label="Description" readonly="true"/>
            </section>
            <composition relationship="subassembly" inline="true" label="Subassemblies" detailschema="" printschema="">
              <collectionproperties listschema="subassemblies" allowcreation="false" allowremoval="false" allowupdate="false"/>
            </composition>
            <composition relationship="sparepart" inline="true" label="Spare Parts" detailschema="" printschema="">
              <collectionproperties listschema="assetsparepartlist" allowcreation="false" allowremoval="false" allowupdate="false"/>
            </composition>
          </tab>
          <tab id="safety" label="Safety" icon="fa-shield">
            <section orientation="horizontal">
              <renderer type="default" params="childinputsize=medium" />
              <field attribute="assetnum" label="Asset" readonly="true"/>
              <field attribute="description" label="Description" readonly="true"/>
              <field attribute="siteid" label="Site" readonly="true"/>
            </section>
            
            <section>
              <renderer type="default" params="tabsection=true"/>
              <tab id="hazardsprecation" label="Hazards and Precautions" icon="fa-bullhorn" countrelationship="hazards">
                <composition relationship="hazards" inline="true" label="Hazards" detailschema="hazarddetail" printschema="" >
                  <collectionproperties listschema="hazardlist" allowcreation="false" allowremoval="false" allowupdate="false" prefilterfunction="FilterHazards"/>
                </composition>
              </tab>
              <composition relationship="hazardrousmaterials" label="Hazardous Material" detailschema="hazardrousmaterialsdetail" printschema="">
                <collectionproperties listschema="hazardrousmaterialslist" allowcreation="false" allowremoval="false" allowupdate="false"/>
              </composition>
              <composition relationship="tagouts" label="Lock Out/Tag Out" detailschema="" printschema="">
                <collectionproperties listschema="tagoutslist" allowcreation="false" allowremoval="false" allowupdate="false"/>
              </composition>
              <composition relationship="sprelatedasset" label="Safety-Related Assets" detailschema="" printschema="">
                <collectionproperties listschema="sprelatedassetlist" allowcreation="false" allowremoval="false" allowupdate="false"/>
              </composition>
            </section>
          </tab>
          <tab id="meters" label="Meters" icon="fa-tachometer" countrelationship="assetmeter">
            <section orientation="horizontal">
              <field attribute="assetnum" label="Asset" readonly="true"/>
              <field attribute="description" label="Description" readonly="true"/>
              <field attribute="groupname" label="Meter Group" readonly="true"/>
              <field attribute="metergroup_.description" label="Description" readonly="true"/>
            </section>
            <composition relationship="assetmeter" inline="true" label="Meters List" detailschema="assetmeterdetail" printschema="">
              <collectionproperties listschema="assetmeterlist" allowcreation="false" allowremoval="false" allowupdate="false"/>
            </composition>
          </tab>
          
          <composition relationship="assetspec" label="Specifications" detailschema="compositiondetail" printschema="">
            <collectionproperties listschema="compositionlist" allowcreation="false" allowremoval="false" allowupdate="false"/>
          </composition>
          
          <composition relationship="assetlocrelation" label="Relationships" detailschema="assetlocrelationdetail">
            <collectionproperties listschema="assetlocrelationlist" allowcreation="false" allowremoval="false" allowupdate="false" prefilterfunction="BuildAssetlocrelationWhereClause"/>
          </composition>
          
          <composition relationship="workorder" label="Work Order History" detailschema="">
            <collectionproperties listschema="assetwolist" allowcreation="false" allowupdate="false" allowremoval="false" printenabled="false"/>
          </composition>
          
        </schema>
        <schema id="subassemblies" stereotype="compositionlist" platform="web">
          <field attribute="assetnum" label="Asset" readonly="true"/>
          <field attribute="description" label="Description" readonly="true"/>
          <field attribute="location" label="Location" readonly="true"/>
          <field attribute="location_.description" label="Description" readonly="true"/>
        </schema>
        <schema id="assetLookupList" stereotype="list.singleselection.modal" platform="web">
          <field attribute="assetnum" label="Asset"/>
          <field attribute="description" label="Description">
            <renderer type="default" params="minwidth=300px" />
          </field>
          <field attribute="parent" label="Parent"/>
          <field attribute="location" label="Location"/>
          <field attribute="siteid"  label="Site"/>
          <field attribute="status" label="Status"/>
        </schema>
        <schema id="multiAssetLookupList" stereotype="list.selection.modal" platform="web" title="Select Assets">
          <filters>
            <optionfilter attribute="status" displaycode="false">
              <option xmlns="http://www.controltechnologysolutions.com/filters" value="ACTIVE" label="ACTIVE"/>
              <option xmlns="http://www.controltechnologysolutions.com/filters" value="OPERATING" label="OPERATING"/>
            </optionfilter>
          </filters>
          
          <field attribute="assetnum" label="Asset"/>
          <field attribute="description" label="Description">
            <renderer type="default" params="minwidth=300px" />
          </field>
          <field attribute="parent" label="Parent"/>
          <field attribute="location" label="Location"/>
          <field attribute="siteid"  label="Site"/>
          <field attribute="status" label="Status"/>

          <properties>
            <property key="list.advancedfilter.hidesearchoptions" value="true"/>
          </properties>
          
          <commandbars>
            <commandgroup position="gridfiltertop">
              <removecommand id="toggleselected"/>
            </commandgroup>
          </commandbars>
        </schema>
        <schema id="locationassets" title="Assets" stereotype="compositionlist" platform="web">
          <properties>
            <property key="list.click.event" value="assetService.goToDetail"/>
          </properties>
          <field attribute="assetid" hidden="true"/>
          <field attribute="assetuid" hidden="true"/>
          <field attribute="assetnum" label="Asset"/>
          <field attribute="description" label="Description"/>
          <field attribute="location" label="Location"/>
          <field attribute="parentasset_.assetnum" label="Parent"/>
          <field attribute="parentasset_.description" label="Parent Description"/>
          <field attribute="itemnum" label="Rotating Item"/>
          <field attribute="isrunning" label="Asset Up?">
            <renderer type="default" params="formatter=numberToBoolean"/>
          </field>
          <field attribute="calnum" label="Calendar"/>
          <commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="save"/>
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>

    </application>
  </applications>




</metadata>
