<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <entities>
    <entity name="po" idAttribute="ponum">
      <relationships>
        <relationship to="synonymdomain" qualifier="postatus">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="POSTATUS" quoteLiteral="true"/>
        </relationship>
        <relationship to="synonymdomain" qualifier="potype">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="POTYPE" quoteLiteral="true"/>
        </relationship>
        <relationship to="currency" qualifier="currency" collection="true">
          <relationshipAttribute from="currencycode" to="currencycode" primary="true"/>
        </relationship>
        <relationship to="companies" qualifier="companies" collection="true">
          <relationshipAttribute from="vendor" to="company" primary="true"/>
          <relationshipAttribute to="type" literal="V" quoteLiteral="true"/>
        </relationship>
        <relationship to ="poline" qualifier="poline" collection ="true">
          <relationshipAttribute from="ponum" to="ponum" primary="true"/>
        </relationship>
        <relationship to="matrectrans" qualifier="matrectrans" collection="true">
          <relationshipAttribute from="ponum" to ="ponum" primary="true"/>
          <relationshipAttribute from="siteid" to ="siteid"/>
          <relationshipAttribute from ="orgid" to="orgid"/>
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWPO" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Commons.BasePurchaseOrderCrudConnector" />
      </connectorParameters>
    </entity>

    <entity name="poline" idAttribute="polinenum">
      <relationships>
        <relationship to ="item">
          <relationshipAttribute from ="itemnum" to="itemnum" primary="true"/>
        </relationship>
        <relationship to="matrectrans" qualifier="matrectrans" collection="true">
          <relationshipAttribute from="ponum" to="ponum" primary="true"/>
          <relationshipAttribute from="polinenum" to="polinenum"/>
        </relationship>
      </relationships>
    </entity>

    <entity name="commodities" idAttribute="commoditiesid">
      <relationships>
        <relationship to="assetloccomm" qualifier="selectedcommodities">
          <relationshipAttribute from="commodity" to="commodity" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid" />
          <relationshipAttribute to="assetnum" literal=":commodityassetnum" quoteLiteral="false" />
        </relationship>
      </relationships>
    </entity>

    <entity name="pr" idAttribute="prnum">
      <relationships>
        <relationship to="companies">
          <relationshipAttribute from="vendor" to="company" primary="true"/>
          <relationshipAttribute to="type" literal="V" quoteLiteral="true"/>
        </relationship>
        <relationship to="contract">
          <relationshipAttribute from="contractrefnum" to="contractnum" primary="true"/>
          <relationshipAttribute from="vendor" to="vendor" />
        </relationship>
        <relationship to ="prline" qualifier="prline" collection ="true">
          <relationshipAttribute from="prnum" to="prnum" primary="true"/>

          <relationshipAttribute from="siteid" to ="siteid"/>
          <relationshipAttribute from ="orgid" to="orgid"/>
        </relationship>
        <relationship to="prterm" collection ="true">
          <relationshipAttribute from="prnum" to="prnum" primary="true"/>
          <relationshipAttribute from="siteid" to ="siteid"/>
          <relationshipAttribute from ="orgid" to="orgid"/>
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWPR" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Commons.BasePurchaseRequestCrudConnector" />
      </connectorParameters>
    </entity>

    <entity name="prterm" idAttribute ="prtermid">
      <relationships>
        <relationship to="term" >
          <relationshipAttribute from="termid" to="termid" primary="true"/>
          <relationshipAttribute from="siteid" to ="siteid"/>
        </relationship>
      </relationships>
    </entity>

    <entity name="prline" idAttribute="prlinenum">
      <relationships>
        <relationship to ="item">
          <relationshipAttribute from ="itemnum" to="itemnum" primary="true"/>
        </relationship>
        <relationship to ="tax" qualifier="tax" collection="true">
          <relationshipAttribute from="tax1code" to ="taxcode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
      </relationships>
    </entity>

    <entity name="materialrecords" parententity="matrectrans" idAttribute="matrectransid">
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWRECEIPT" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Commons.BaseReceiptCrudConnector" />
      </connectorParameters>
    </entity>
  </entities>

  <applications>
    <application entity="po" name="po" title="Puchase Orders">
      <properties>
        <property key ="mobile.disabled" value="true"/>
      </properties>
      <schemas>
        <list title="Purchase Order Grid">
          <field attribute ="ponum" label="PO#">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute ="description" label="Description">
            <renderer type="default" params="excelwidth=50"/>
          </field>
          <field attribute ="status" label="Status">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute ="siteid" label="Site">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute ="potype" label="Type">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute ="priority" label="Priority">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute ="requireddate" label="Required Date">
            <renderer type="datetime" params="width=15%;format=MM/dd/yyyy HH:mm;showtime=false"/>
          </field>
          <field attribute ="totalcost" label="Total Cost">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="receipts" hidden="true"/>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
          </properties>
        </list>

        <schema id="adetail" title="PO Details" abstract="true" stereotype="detail">
          <field attribute="ponum" label="PO#" readonly="true">
            <renderer type="default" params="inputsize=medium" />
          </field>

          <section>
            <header displacement="ontop" label="PO Details" params="fieldset=true" />
            <field attribute="description" label="Description:">
              <renderer type="richtext"/>
            </field>
            <field attribute="siteid" hidden="true" />
            <section orientation="horizontal">
              <renderer type="default" params="childinputsize=medium" />
              <association label="Type:" target="type" labelfield="potype_.description">
                <renderer type="lookup"/>
              </association>
              <field attribute="priority" label="Priority:">
                <renderer type="default" params="placeholder=Please enter a value from 0-9"/>
              </field>
              <field attribute="companies_.phone" label="Phone:"/>
            </section>
          </section>
          
          <section orientation="horizontal">
            <header displacement="ontop" label="Scheduling" params="fieldset=true" />
            <field attribute="orderdate" label="Reported Date:" readonly="true">
              <renderer type="datetime" params="format=MM/dd/yyyy;"/>
            </field>
            <field attribute="targetstart" label="Required Date:" attributeToServer="#notusedattribute">
              <renderer type="datetime" params="format=MM/dd/yyyy;"/>
            </field>
          </section>
          
          <section id="compositions"/>
        </schema>
        
        <schema parentschema="adetail"  id="newdetail" title="New PO" stereotype="detailnew">
        </schema>

        <schema parentschema="adetail" id="editdetail" title="PO Details">
          <section id="compositions">
            <composition relationship="poline" label="PO Lines" >
              <collectionproperties allowupdate="true" allowcreation="true"/>
            </composition>
          </section>
        </schema>
      </schemas>
    </application>

    <application name="poline" entity="poline" title="PO Lines">
      <properties>
        <!--will need to change the icon later-->
        <property key ="icon.composition.tab" value="fa fa-clipboard"/>
      </properties>
      <schemas>

        <schema id="list" stereotype="compositionlist">
          <!--<properties>-->
          <!--<property key="list.click.popup" value="modal"/>-->
          <!--</properties>-->

          <field attribute="ponum" label="PO#" readonly="true">
            <renderer type="default"/>
          </field>
          <field attribute="polinenum" label="Line#">
            <renderer type="default"/>
          </field>
          <field attribute="itemnum" label="Item">
            <renderer type="default"/>
          </field>
          <field attribute="description" label="Description">
            <renderer type="default" />
          </field>
          <field attribute="orderqty" label="Quantity">
            <renderer type="default"/>
          </field>
          <field attribute="unitcost" label="Unit Cost">
            <renderer type="default"/>
          </field>
          <field attribute="gldebitacct" hidden="true"/>
          <field attribute="siteid" hidden="true" />
          <field attribute="orgid" hidden="true" />
          <field attribute="itemsetid" hidden="true"/>
          <field attribute="linetype" hidden="true"/>
          <field label="Entered Date &amp; Time" attribute="enterdate" readonly="true"  hidden="true" default="@currentdatetime">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
          </field>
          <section resourcepath="/Content/Templates/otb/receiving.html">
            <renderer type="default" params="width=4%"/>
          </section>
          <commandbars>
            <commandgroup position="compositiontop" removeundeclared="false">
              <command id ="Complete" icon="fa-thumbs-o-up" service="poreceivingService" method="completeReceipts" label="Complete Receipts" parameters="schema,datamap,parentdata" />
            </commandgroup>
          </commandbars>
        </schema>

        <detail stereotype="compositiondetail">
          <field attribute="ponum" label="PO#" readonly="true"/>
          <field attribute="itemnum" label="Item:" readonly="true"/>
          <field attribute="#qtydue" label="Quantity Due:" readonly="true"/>
          <field attribute="#qtytoreceive" label="Quantity to Receive:">
            <renderer type="numericinput" params="min=1;max=@#qtydue;"/>
          </field>
          <commandbars>

            <commandgroup position="detailform" removeundeclared="true">
              <command id="Receive" icon="fa-check" service="poreceivingService" method="submitMatrecTrans" label="Save" parameters="schema,datamap"/>
              <command id="cancel" icon="fa-times" service="$scope" method="cancel" label="Cancel"/>
            </commandgroup>
          </commandbars>
        </detail>

      </schemas>
    </application>

    <application name="commodities" title="Commodities" entity="commodities" >
      <schemas>
        <detail>
          <field attribute="commodity" label="" />
          <field attribute="description" label="" />
          <field attribute="selectedcommodities_.assetnum" label="" />
        </detail>
      </schemas>
    </application>

    <application entity="pr" name ="pr" title="Purchase Requests">
      <schemas>
        <!--Creating the Grid: SWWEB-232-->
        <list title="Purchase Request Grid">
          <field attribute="prnum" label="PR#">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field attribute="status" label="Status">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="requireddate" label="Required Date">
            <renderer type="datetime" params="width=15%;format=MM/dd/yyyy HH:mm;showtime=false" />
          </field>
          <field attribute="vendor" label="Vendor">
            <renderer type="default" params="width=15%;" />
          </field>
          <field attribute="totalcost" label="Total Cost">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="siteid" label="Site ID">
            <renderer type="default" params="width=15%" />
          </field>
          <field attribute="#color" label="">
            <renderer type="color" params="width=4%;grid=pr;column=status"/>
          </field>

          <properties>
            <property key="list.click.schema" value="detail"/>
          </properties>
        </list>


        <schema id="adetail" title="Purchase Request Details" abstract="true" stereotype="detail">

          <section orientation="horizontal">
            <renderer type="default" params="childinputsize=medium" />
            <field attribute="description" label="Summary" hidden="true" />
            <field attribute="prnum" label="PR#" hidden="true" />
            <field attribute="priority" label="Priority:" requiredexpression="true" default="0">
              <renderer type="numericinput" params="min=0;max=9;decimals=0" />
            </field>
            <field attribute="totaltax1" label="Total Tax:" />
            <field attribute="totalcost" label="Total Cost:" default="0" requiredexpression="true" />
            <field attribute="currencycode" label="Currency:" requiredexpression="true" />
          </section>

          <section orientation="horizontal">
            <header displacement="ontop" label="Responsibility" params="fieldset=true" />
            <renderer type="default" params="childinputsize=medium" />
            <field attribute="supervisor" label="Supervisor:" />
          </section>
          
          <section>
            <header displacement="ontop" label="Vendow Info" params="fieldset=true" />
            <optionfield attribute="novendor" label="No Vendor? :"  requiredexpression="true" >
              <renderer type="radio"/>
              <option label="No" value="FALSE"/>
              <option label="Yes" value="TRUE"/>
            </optionfield>
            <section orientation="horizontal">
              <association label="Vendor:" target="vendor" labelfield="companies_.company" enableexpression="@novendor=='FALSE'">
                <renderer type="lookup"/>
              </association>
              <association label="Vendor Contract:" target="contractrefnum" labelfield="contract_.description" >
                <renderer type="lookup"/>
              </association>
            </section>
          </section>
          
          <section id="compositions" />
        </schema>
        
        <schema parentschema="adetail" id="detail" stereotype="detail" mode="input" title="Purchase Request Details">
          <section id="compositions">
            <composition relationship="prline" label="PR Lines" ></composition>
            <commandbars>
              <commandgroup position="detailform">
                <command id="crud_delete" label="Delete" service="crudextraService" method="deletefn" parameters="schema,datamap"
                         showexpression="@status=='NEW'" successmessage="Purchase Request Deleted" position="left"/>
              </commandgroup>
            </commandbars>
          </section>
        </schema>
          
        <schema parentschema="adetail" id="newdetail" stereotype="detailnew" mode="input" title="New Purchase Request" />
      </schemas>
    </application>

    <application entity="prline" name="prline" title="Purchase Request Line">
      <properties>
        <property key ="icon.composition.tab" value="fa fa-money"/>
      </properties>
      <schemas>
        <schema id="list" stereotype="compositionlist">
          <field attribute="prnum" label="PR#" readonly="true"/>
          <field attribute="prlinenum" label="Line#" />
          <field attribute="itemnum" label="Item"/>
          <field attribute="description" label="Description"/>
          <field attribute="orderqty" label="Quantity"/>
          <field attribute="unitcost" label="Unit Cost"/>
          <field label="Entered Date &amp; Time" attribute="enterdate" readonly="true"  hidden="true" default="@currentdatetime">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
          </field>
        </schema>

        <detail stereotype="compositiondetail">
          <optionfield attribute="linetype" label="Line Type:" >
            <renderer type="radio"/>
            <option label="Item" value="item"/>
            <option label="Material" value="material"/>
          </optionfield>
          <field attribute="prnum" label="PR#" readonly="true"/>
          <field attribute="prlinenum" label="Line:"  >
            <renderer type="default"/>
          </field>
          <association label="Item:" target="itemnum" labelfield="item_.description" enableexpression="@linetype=='item'">
            <renderer type="lookup"/>
          </association>
          <field attribute="description" label="Description:" enableexpression="@linetype=='material'">
            <renderer type="textarea" params="maxlength=1000" />
          </field>
          <field attribute="orderqty" label="Quantity:"/>
          <field attribute="unitcost" label="Unit Cost:"/>
          <field attribute="linecost" label="Line Cost:" evalexpression="@orderqty*@unitcost"/>
          <association label="Tax Code:" target="tax1code" labelfield="tax_.taxcode" extraprojectionvalues="tax_.taxrate" showexpression="1 != 1">
            <renderer type="lookup"/>
          </association>
          <field attribute="tax_.taxrate" label="Tax Rate:"/>
          <field attribute="tax1" label="Total Tax:" evalexpression="@linecost*@tax_.taxrate"/>
          <!--field attribute="tax1" label="Tax:" evalexpression="@linecost*@tax_.taxrate"/-->
          <!--field attribute="conversion" label="Conversion Factor:" hidden="true" default="1"/-->
        </detail>
      </schemas>
    </application>

    <application entity="prterm" name="prterm" title="Terms and Conditions">
      <schemas>
        <schema id="list" stereotype="compositionlist">
          <field attribute="prnum" label="PR#" readonly="true"/>
          <field attribute="prtermid" label="Term ID" />
          <field attribute="seqnum" label="Sequence#"/>
          <field attribute="description" label="Description"/>

        </schema>

        <detail stereotype="compositiondetail">

          <field attribute="prnum" label="PR#" readonly="true"/>
          <field attribute="prtermid" label="Term ID" />
          <field attribute="seqnum" label="Sequence#"/>
          <field attribute="description" label="Description:"/>
        </detail>
      </schemas>
    </application>

    <application name="companies" entity="companies" title="Companies" id="00000000-0000-0000-0000-000000000017">
      <properties>
        <property key="mobile.fetchlimit" value="30"/>
        <property key="mobile.userInteractionEnabled" value="false"/>
      </properties>
      <schemas>
        <schema id="companiesLookupList" stereotype="list">
          <field attribute="company" label="Company"/>
          <field attribute="name" label="Name">
            <renderer type="default" params="minwidth=300px" />
          </field>
          <field attribute="type" label="Type"/>
          <field attribute="orgid"  label="Organization"/>
        </schema>
      </schemas>
    </application>

    <application name="materialrecords" entity="materialrecords" title="Matrectrans items">
      <schemas>
        <list id="list">
          <field attribute="ponum" label="ponum"/>
          <field attribute="polinenum" label="polinenum"/>
          <field attribute="quantity" label="quantity received"/>
        </list>

        <schema id="newdetail" platform="web" stereotype="detailnew" mode="input">
          <field attribute="matrectransid" hidden="true"/>
          <field attribute="ponum" label="ponum"/>
          <field attribute="polinenum" label="polinenum"/>
          <field attribute="quantity" label="Received"/>
        </schema>
      </schemas>
    </application>
  </applications>

</metadata>
