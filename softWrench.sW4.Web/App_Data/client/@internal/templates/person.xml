<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">
  <templates>
    <!--Email-->
    <template path="@email.xml"/>
    
    <!--Phone-->
    <template path="@phone.xml"/>
  </templates>
    
  <entities>
    <entity name="localPerson" parententity="person" idAttribute="personid">
      <connectorParameters>
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Commons.BasePersonCrudConnector" />
      </connectorParameters>
    </entity>
  </entities>

  <applications>
    <application name="person" title="Person" entity="localPerson">
      <properties>
        <property key="list.defaultorderby" value="personid asc"/>
        <property key="detail.navigationbuttons.disabled" value="true"/>
      </properties>
      <schemas>
        <schema id="list" stereotype="list" title="Person List">
          <field attribute="personuid" hidden="true"/>
          <field attribute="personid" label="Username"/>
          <field attribute="firstname" label="First Name"/>
          <field attribute="lastname" label="Last Name"/>
          <field attribute="#isactive" label="Active" enableexpression="false">
            <renderer type="checkbox"/>
          </field>
        </schema>
        
        <schema id="detail" stereotype="detail" title="Person Detail">
          <field attribute="personuid" label="Person ID" showexpression="false"/>
          <field attribute="personid" label="Username" requiredexpression="true" readonly="true"/>
          <field attribute="#password" label="Password" showexpression="!@ldapEnabled"/>
          <field attribute="#retypepassword" label="Retype Password" showexpression="!@ldapEnabled"/>
          <field attribute="firstname" label="First Name" requiredexpression="true"/>
          <field attribute="lastname" label="Last Name" requiredexpression="true"/>
          <association target="locationorg" labelfield="organization_.description" label="Org ID">
            <renderer type="lookup"/>
          </association>
          <association target="locationsite" labelfield="site_.description" label="Site ID">
            <renderer type="lookup"/>
          </association>
          <association target="location" labelfield="location_.description" label="Location">
            <renderer type="lookup"/>
          </association>
          <field attribute="department" label="Department"/>
          <field attribute="langcode" label="Language"/>
          <field attribute="#isactive" label="Active">
            <renderer type="checkbox"/>
          </field>

          <section attribute="profilessection" resourcepath="/Content/Templates/otb/profiles.html" role="sysadmin">
            <header displacement="ontop" label="Profiles" showexpression="true"/>
          </section>
          
          <composition relationship="phone" label="Phone Numbers" inline="false" >
            <collectionproperties allowcreation="true" allowupdate="false"/>
          </composition>
          <composition relationship="email" label="Email Addresses" inline="false">
            <collectionproperties allowcreation="true" allowupdate="false"/>
          </composition>
        </schema>

        <schema id="newPersonDetail" stereotype="detail" title="New User" mode="input">
          <properties>
            <property key="detail.hidetitle" value="true"/>
          </properties>
          <field attribute="personuid" label="Person ID" showexpression="false" default="-1"/>
          <field attribute="#personid" label="Username" requiredexpression="@personuid == -1" showexpression="@personuid == -1">
            <event type="afterchange" service="personService" method="afterChangeUsername"/>
          </field>
          <field attribute="personid" label="Username" showexpression="@personuid != -1" readonly="true" />
          <field attribute="#password" label="Password" requiredexpression="!@ldapEnabled &amp;&amp; @personuid == -1" showexpression="!@ldapEnabled"/>
          <field attribute="#retypepassword" label="Retype Password" requiredexpression="!@ldapEnabled &amp;&amp; @personuid == -1" showexpression="!@ldapEnabled"/>
          <field attribute="firstname" label="First Name" requiredexpression="true"/>
          <field attribute="lastname" label="Last Name" requiredexpression="true"/>
          <association target="locationorg" labelfield="organization_.description" label="Org ID">
            <renderer type="lookup"/>
          </association>
          <association target="locationsite" labelfield="site_.description" label="Site ID">
            <renderer type="lookup"/>
          </association>
          <association target="location" labelfield="location_.description" label="Location">
            <renderer type="lookup"/>
          </association>
          <field attribute="department" label="Department"/>
          <field attribute="langcode" label="Language"/>
          <field attribute="#isactive" label="Active">
            <renderer type="checkbox"/>
          </field>
          
          <section attribute="#profiles" resourcepath="/Content/Templates/otb/profiles.html" role="sysadmin">
            <header displacement="ontop" label="Profiles" showexpression="true"/>
          </section>
          
          <composition relationship="phone" label="Phone Numbers" inline="false" >
            <collectionproperties allowcreation="true" allowupdate="false"/>
          </composition>
          <composition relationship="email" label="Email Addresses" inline="false">
            <collectionproperties allowcreation="true" allowupdate="false"/>
          </composition>
        </schema>
      </schemas>
    </application>
  </applications>
</metadata>