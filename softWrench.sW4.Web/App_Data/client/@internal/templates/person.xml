<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata"
          xmlns:f="http://www.controltechnologysolutions.com/filters">
  <templates>
    <!--Email-->
    <template path="@email.xml"/>

    <!--Phone-->
    <template path="@phone.xml"/>
  </templates>

  <applications>
    <application name="person" title="Person" entity="person">
      <properties>
        <property key="list.defaultorderby" value="personid asc"/>
        <property key="detail.navigationbuttons.disabled" value="true"/>
      </properties>


      <schemas>


        <schema id="compositionlist" stereotype="compositionlist">
          <field attribute="displayname" label="Display Name" qualifier="title"/>
        </schema>
        <schema id="compositiondetail" stereotype="compositiondetail">
          <field attribute="personid" hidden="true" />
          <field attribute="displayname" label="Display Name" requiredexpression="true" />
        </schema>


        <schema id="list" stereotype="list" title="Users">

          <filters>
            <optionfilter attribute="maxuser_.active" allowblank="false" style="width:300px" eager="true">
              <f:option label="Active" value="1" />
              <f:option label="Inactive" value="0" />
            </optionfilter>
          </filters>

          <field attribute="personuid" hidden="true"/>
          <field attribute="personid" label="Username"/>
          <field attribute="firstname" label="First Name"/>
          <field attribute="lastname" label="Last Name"/>
          <field attribute="#isactive" label="Active (softWrench)" enableexpression="false" readonly="true">
            <renderer type="checkbox"/>
          </field>
          <field attribute="maxuser_.active" label="Active (MAXIMO)" readonly="true" enableexpression="false">
            <renderer type="checkbox" />
          </field>

          <field attribute="displayname" label="Display Name" qualifier="title" hidden="true"/>

          <commandbars>
            <commandgroup position="gridtop">
              <command id="new" icon="fa-plus" service="redirectService" method="goToApplicationView" parameters="person,newPersonDetail" label="New User" tooltip="New User" position="left"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="detail" stereotype="detail" title="User Profile">
          <event type="beforesubmit.onvalidation" service="personService" method="validatePerson"/>

          <section id="statistics" resourcepath="/Content/Templates/usersetup/userstatistics.html"></section>

          <field attribute="personuid" label="Person ID" showexpression="false"/>
          <field attribute="personid" label="Username" requiredexpression="true" readonly="true"/>

          <field attribute="#password" label="Password" showexpression="!@ldapEnabled">
            <renderer type="password" params="placeholder=Blank to keep current stored password;avoidautofocus=true"/>
          </field>
          <field attribute="#retypepassword" label="Retype Password" showexpression="!@ldapEnabled">
            <renderer type="password" params="placeholder=Blank to keep current stored password;avoidautofocus=true"/>
          </field>
          <field attribute="firstname" label="First Name" requiredexpression="true"/>
          <field attribute="lastname" label="Last Name" requiredexpression="true"/>
          <association target="locationorg" labelfield="organization_.description" label="Org ID" requiredexpression="true" defaultexpression="@orgid">
            <renderer type="lookup"/>
          </association>
          <association target="locationsite" labelfield="site_.description" label="Site ID" requiredexpression="true" defaultexpression="@siteid">
            <renderer type="lookup"/>
          </association>
          <association target="location" labelfield="location_.description" label="Location">
            <renderer type="lookup"/>
          </association>
          <field attribute="department" label="Department"/>
          <field attribute="langcode" label="Language"/>
          <field attribute="#isactive" label="Active (softWrench)">
            <renderer type="checkbox"/>
          </field>

          <field attribute="maxuser_.active" hidden="true"/>

          <field attribute="#maxactive" label="Active (MAXIMO)" readonly="true" enableexpression="false">
            <renderer type="checkbox" />
          </field>

          <composition relationship="phone" label="Phone Numbers" inline="false" >
            <collectionproperties allowcreation="true" allowupdate="false"/>
          </composition>
          <composition relationship="email" label="Email Addresses" inline="false">
            <collectionproperties allowcreation="true" allowupdate="false"/>
          </composition>

          <tab label="Security Groups" icon="fa-gear" id="permission" role="sysadmin">
            <section attribute="#profiles" resourcepath="/Content/Templates/otb/profiles.html" >
              <header displacement="ontop" label="Profiles" showexpression="true"/>
            </section>
          </tab>

          <tab label ="Preferences" icon="fa-cogs" id="preferences" >
            <field attribute="#signature" label="Email Signature">
              <renderer type="richtext"/>
            </field>
          </tab>

          <commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa fa-check" label="Save" service="personService" method="submitPerson" position="left" parameters="schema,datamap"/>
              <command id="cancel" icon="fa-times" service="personService" method="cancelEdition" label="Cancel" tooltip="Cancel"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="myprofiledetail" parentschema="detail" title="Edit My Profile">
          <!-- Fix for SWWEB-1245-->
<!--          <commandbars>-->
<!--            <commandgroup position="detail.primary">-->
<!--              -->
<!--            </commandgroup>-->
<!---->
<!--          </commandbars>-->
        </schema>

        <schema id="newPersonDetail" stereotype="detailnew" title="New User" mode="input">
          <event type="beforesubmit.onvalidation" service="personService" method="validatePerson"/>
          <field attribute="personuid" label="Person ID" showexpression="false" default="-1"/>
          <field attribute="#personid" label="Username" requiredexpression="@personuid == -1" showexpression="@personuid == -1">
            <event type="afterchange" service="personService" method="afterChangeUsername"/>
          </field>
          <field attribute="personid" label="Username" showexpression="@personuid != -1" readonly="true" />
          <field attribute="#primaryemail" requiredexpression="true" label="Primary Email" tooltip="The user will receive a confirmation link on this email"/>

          <optionfield attribute="passwordmode" default="auto" label="Password Generation" showexpression="!@ldapEnabled"
                       tooltip="If Automatic an email with a link will be sent to the new users where they will be able to select a password. 
                       On manual mode the user will receive the assigned password via email">
            <renderer type="radio"/>
            <option value="auto" label="Automatic"/>
            <option value="manual" label="Manual"/>
          </optionfield>

          <section orientation="vertical" showexpression="@passwordmode == 'manual'">
            <field attribute="#password" label="Password" showexpression="!@ldapEnabled" requiredexpression="true">
              <renderer type="password"  params="placeholder=Leave it blank to make the system autogenerate it;avoidautofocus=true"/>
            </field>
            <field attribute="#retypepassword" label="Retype Password" showexpression="!@ldapEnabled" requiredexpression="true">
              <renderer type="password" params="placeholder=Leave it blank to make the system autogenerate it;avoidautofocus=true"/>
            </field>
          </section>

          <field attribute="firstname" label="First Name" requiredexpression="true"/>
          <field attribute="lastname" label="Last Name" requiredexpression="true"/>

          <field attribute="#primaryphone" label="Primary Phone" />
          <association target="locationorg" labelfield="organization_.description" label="Org ID" default="@orgid" requiredexpression="true">
            <renderer type="lookup"/>
          </association>
          <association target="locationsite" labelfield="site_.description" label="Site ID" default="@siteid" requiredexpression="true">
            <renderer type="lookup"/>
          </association>
          <association target="location" labelfield="location_.description" label="Location">
            <renderer type="lookup"/>
          </association>
          <field attribute="department" label="Department"/>
          <optionfield attribute="langcode" label="Language">
            <option label="English" value="EN"/>
            <option label="Spanish" value="ES"/>
          </optionfield>
          <field attribute="#isactive" label="Active" default="1">
            <renderer type="checkbox"/>
          </field>


          <!--          <composition relationship="phone" label="Phone Numbers" inline="false" >-->
          <!--            <collectionproperties allowcreation="true" allowupdate="false"/>-->
          <!--          </composition>-->
          <!--          <composition relationship="email" label="Email Addresses" inline="false">-->
          <!--            <collectionproperties allowcreation="true" allowupdate="false"/>-->
          <!--          </composition>-->

          <tab label="Security Groups" icon="fa-gear" id="permission" showexpression="" role="sysadmin">
            <section attribute="#profiles" resourcepath="/Content/Templates/otb/profiles.html">
              <header displacement="ontop" label="Profiles" showexpression="true"/>
            </section>
          </tab>

        </schema>
        
        <schema id="userselectlist" stereotype="list.selection.modal" title="Users">
          <properties>
            <property key="schema.customparamprovider" value="userProfileService.getProfileId"/>
          </properties>
          <filters>
            <optionfilter attribute="maxuser_.active" allowblank="false" style="width:300px" eager="true">
              <f:option label="Active" value="1" />
              <f:option label="Inactive" value="0" />
            </optionfilter>
          </filters>

          <field attribute="personuid" hidden="true"/>
          <field attribute="personid" label="Username"/>
          <field attribute="firstname" label="First Name"/>
          <field attribute="lastname" label="Last Name"/>
          <field attribute="#isactive" label="Active (softWrench)" enableexpression="false" readonly="true">
            <renderer type="checkbox"/>
          </field>
          <field attribute="maxuser_.active" label="Active (MAXIMO)" readonly="true" enableexpression="false">
            <renderer type="checkbox" />
          </field>
          <field attribute="displayname" label="Display Name" qualifier="title" hidden="true"/>
        </schema>

        <schema id="userremovelist" stereotype="list.selection.modal" title="Users">
          <properties>
            <property key="schema.customparamprovider" value="userProfileService.getProfileId"/>
          </properties>
          <filters>
            <optionfilter attribute="maxuser_.active" allowblank="false" style="width:300px" eager="true">
              <f:option label="Active" value="1" />
              <f:option label="Inactive" value="0" />
            </optionfilter>
          </filters>

          <field attribute="personuid" hidden="true"/>
          <field attribute="personid" label="Username"/>
          <field attribute="firstname" label="First Name"/>
          <field attribute="lastname" label="Last Name"/>
          <field attribute="#isactive" label="Active (softWrench)" enableexpression="false" readonly="true">
            <renderer type="checkbox"/>
          </field>
          <field attribute="maxuser_.active" label="Active (MAXIMO)" readonly="true" enableexpression="false">
            <renderer type="checkbox" />
          </field>
          <field attribute="displayname" label="Display Name" qualifier="title" hidden="true"/>
        </schema>
      </schemas>
    </application>
  </applications>
</metadata>