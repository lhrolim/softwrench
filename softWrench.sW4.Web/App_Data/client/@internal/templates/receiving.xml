<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <entities>
    <entity name="receiving" parententity="po" idAttribute="ponum" whereclause="status = 'APPR'">
      <relationships>
        <relationship to="synonymdomain" qualifier="postatus">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="POSTATUS" quoteLiteral="true"/>
        </relationship>
        <relationship to="synonymdomain" qualifier="potype">
          <relationshipAttribute from="status" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="POTYPE" quoteLiteral="true"/>
        </relationship>
        <relationship to="currency" qualifier="currency" collection="true">
          <relationshipAttribute from="currencycode" to="currencycode" primary="true"/>
        </relationship>
        <relationship to="companies" qualifier="companies" collection="true">
          <relationshipAttribute from="vendor" to="company" primary="true"/>
          <relationshipAttribute to="type" literal="V" quoteLiteral="true"/>
        </relationship>
        <relationship to ="poline" qualifier="poline" collection ="true">
          <relationshipAttribute from="ponum" to="ponum" primary="true"/>
        </relationship>
        <relationship to="matrectrans" qualifier="matrectrans" collection="true">
          <relationshipAttribute from="ponum" to ="ponum" primary="true"/>
          <relationshipAttribute from="siteid" to ="siteid"/>
          <relationshipAttribute from ="orgid" to="orgid"/>
        </relationship>
      </relationships>
    </entity>

    <entity name="matrectrans" idAttribute="matrectransid">
      <relationships>
        <relationship to="poline" qualifier="poline">
          <relationshipAttribute from="ponum" to="ponum" primary="true"/>
          <relationshipAttribute from="polinenum" to="polinenum"/>
        </relationship>
      </relationships>
    </entity>
  </entities>

  <applications>
    <application entity="receiving" name="receiving" title="Receiving">
      <schemas>
        <list title="Receiving Grid">
          <field attribute ="ponum" label="PO#">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute ="description" label="Description">
            <renderer type="default" params="excelwidth=50"/>
          </field>
          <field attribute ="status" label="Status">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute ="receipts" label="Receipts">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute ="vendor" label="Company">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute ="siteid" label="Site">
            <renderer type="default" params="width=15%"/>
          </field>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
          </properties>
        </list>
        
        <schema id ="adetail" title="PO Receipt Details" abstract="true" stereotype="detail">
          <section id ="siteidsection"/>
          <field attribute="description" hidden="true"/>
          <section id ="compositions"/>
        </schema>
        
        <schema id="editdetail" parentschema="adetail" title="Receipt Details">
          <section id="siteidsection">
            <section orientation="horizontal">
              <renderer type="default" params="childinputsize=medium" />
              <field attribute="ponum" label="PO#" readonly="true" requiredexpression="true" hidden="true"/>
              <field label="Site:" attribute="siteid" readonly="true" />
            </section>
          </section>
          
          <section id ="compositions">
            <composition relationship="matrectrans" label="Material Receipts">
              <collectionproperties hideexistingdata="false" allowcreation="false" allowupdate="false"/>
            </composition>
          </section>
        </schema>
      </schemas>
    </application>

    <application name="matrectrans" entity="matrectrans" title="Material Receipts">
      <properties>
        <property key ="icon.composition.tab" value="fa fa-file"/>
      </properties>
      <schemas>
        <list stereotype="compositionlist">
          <field attribute="ponum" hidden="true"/>
          <field attribute="matrectransid" hidden="true"/>
          <field attribute="polinenum" label="PO Line"/>
          <field attribute="itemnum" label="Item"/>
          <field attribute="description" label="Description"/>
          <field attribute="quantity" label="Quantity Received"/>

          <commandbars>
            <commandgroup position="compositiontop" removeundeclared="true">
              <command id="ordereditems" label="Select Ordered Items" service="poreceivingService" method="submitorderedItems" parameters="schema,datamap" />
              <command id="rotatingitems" label="Select Rotating Items to Return" service="poreceivingService" method="returnRotatingItems" />
            </commandgroup>
            <commandgroup position="compositionbottom" removeundeclared="true"/>
          </commandbars>
        </list>

        <detail stereotype="compositiondetail">
          <field attribute="polinenum" label="PO Line:"/>
        </detail>
      </schemas>
    </application>
  </applications>

</metadata>