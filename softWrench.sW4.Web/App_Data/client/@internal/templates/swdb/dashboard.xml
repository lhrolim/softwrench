<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <applications>

    <application entity="Dashboard" name="dashboard" title="Dashboard">
      <schemas>
        <schema id="saveDashboardConfirmation" stereotype="detail">
          <field attribute="title" label="Title"/>
          <section showexpression="@canCreateBoth">
            <optionfield attribute="policy" label="Policy">
              <option label="Personal" value="personal"/>
              <option label="Shared" value="shared"/>
            </optionfield>
            <optionfield attribute="profiles" providerattribute="profiles" showexpression="@policy=='shared'" skipvalidation="true">
              <renderer type="checkbox"/>
            </optionfield>
          </section>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" parameters="datamap" service="dashboardAuxService" method="saveDashboard" label="Confirm" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </schema>
      </schemas>
    </application>


    <application entity="DashboardBasePanel" name="basedashboard" title="Base Dashboard">
      <schemas>
        <schema id="panelselection">
          <optionfield attribute="paneltype" label="Widget Type" tooltip="The type of widget to add" default="">
            <option label="Grid" value="dashboardgrid"/>
            <option label="Graphic" value="dashboardgraphic"/>
            <event type="afterchange" service="dashboardAuxService" method="loadPanels"/>
          </optionfield>

          <!--<section showexpression="@numberofpanels>0">
            <header label="Position" displacement="ontop"/>
            <field attribute="row" label="Row">
              <renderer type="numericinput" params="minvalue=1"/>
            </field>
            <field attribute="column" label="Column">
              <renderer type="numericinput" params="minvalue=1"/>
            </field>
          </section>-->

          <section orientation="horizontal" showexpression="@paneltype==='dashboardgrid'">
            <header label="Select Widget" displacement="sameline"/>
            <optionfield attribute="panel" providerattribute="availablepanels" skipvalidation="true"/>
            <section resourcepath="/Content/Shared/dashboard/templates/createnewpanelbutton.html"/>
          </section>

          <section orientation="horizontal" showexpression="@paneltype==='dashboardgraphic'">
            <header label="Select Graphic" displacement="sameline"/>
            <optionfield attribute="panel" providerattribute="availablepanels" skipvalidation="true"/>
            <section resourcepath="/Content/Shared/dashboard/templates/createnewpanelbutton.html"/>
          </section>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" enableexpression="@panel!=null" service="dashboardAuxService" parameters="datamap" method="selectPanel" label="Select Panel" tooltip="Add Panel" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </schema>
      </schemas>
    </application>

    <application entity="DashboardGridPanel" name="dashboardgrid" title="DashBoardGrid">
      <schemas>
        <detail>
          <field label="Alias" attribute="alias" requiredexpression="true" tooltip="How this panel can be located"/>
          <field label="Title" attribute="title" requiredexpression="true" tooltip="The Panel title"/>
          <optionfield label="Application" attribute="application" providerattribute="applications" requiredexpression="true" skipvalidation="true">
            <renderer type="autocompleteclient"/>
            <event type="afterchange" method="lookupFields" service="dashboardAuxService"/>
          </optionfield>
          <section showexpression="@application!=null">

            <optionfield label="Fields" attribute="fields" providerattribute="appfields" skipvalidation="true">
              <renderer type="checkbox"/>
            </optionfield>

            <optionfield label="Sort By" attribute="sortby" providerattribute="appfields" skipvalidation="true">
              <renderer type="autocompleteclient"/>
            </optionfield>

            <field attribute="limit" label="Limit" default="30" defaultexpression="30">
              <renderer type="numericinput"/>
            </field>

            <field label="Size" attribute="size" requiredexpression="true" tooltip="Panel's width">
              <renderer type="numericinput" params="min=1;max=12" />
            </field>

          </section>
          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" service="dashboardAuxService" method="createAndAssociateGridPanel"
                       parameters="datamap"
                       label="Add Panel" tooltip="Add Widget" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </detail>

      </schemas>

    </application>

    <application entity="DashboardGraphicPanel" name="dashboardgraphic" title="DashBoardGraphic">
      <schemas>
        <detail>
          <field label="Alias" attribute="alias" requiredexpression="true" tooltip="How this panel can be located"/>
          <field label="Title" attribute="title" requiredexpression="true" tooltip="The Panel title"/>
          <optionfield label="Provider" attribute="provider"
                       tooltip="Name of the graphic storage service in which the graphic is located"
                       requiredexpression="true" default="">
            <option label="Chart" value="swChart" />
            <option label="Tableau" value="Tableau" />
            <event type="afterchange" method="setGraphicProvider" service="dashboardAuxService"/>
          </optionfield>

          <section showexpression="@provider==='swChart'">

            <optionfield label="Application"
                         attribute="application"
                         requiredexpression="true"
                         default="">
              <renderer type="combo"/>
              
              <option label="Service Request" value="sr" />
              <option label="Work Order" value="workorder" />
              
              <event type="afterchange" service="swchartGraphicPanelService" method="onApplicationSelected" />
            </optionfield>

            <optionfield label="Field" attribute="field" providerattribute="fields" skipvalidation="true"
                         default="" requiredexpression="true">
              <renderer type="combo"/>
            </optionfield>

            <optionfield label="" attribute="statusfieldconfig"
                         default="all" requiredexpression="true"
                         showexpression="@field==='status'">
              <renderer type="radio"/>
              <option label="All" value="all" />
              <option label="Open/Closed" value="openclosed" />
            </optionfield>

            <optionfield label="Type" attribute="type"
                         requiredexpression="true"
                         default="">
              <option label="Record Count Bar Chart"  value="swRecordCountChart" />
              <option label="Record Count Gauge"      value="swRecordCountGauge" />
              <!--<option label="Record Count Map"        value="swRecordCountMap" />-->
              <option label="Record Count Pie Chart"  value="swRecordCountPie" />
              <option label="Record Trends"           value="swRecordTrends" />
              <option label="Sparkline"               value="swSparkline" />
            </optionfield>

            <!--<field label="Options"
                         attribute="options"
                         requiredexpression="false"
                         default=""
                         skipvalidation="true">
              <renderer type="textarea"/>
            </field>-->

          </section>

          <section showexpression="@provider==='Tableau'">
            <optionfield label="Workbook"
                         attribute="workbook" providerattribute="workbooks"
                         requiredexpression="true"
                         default="" skipvalidation="true">
              <event type="afterchange" service="tableauGraphicPanelService" method="onWorkbookSelected" />
            </optionfield>
            <optionfield showexpression="@workbook!==null &amp;&amp; @workbook!==''"
                         label="View"
                         attribute="view" providerattribute="views"
                         requiredexpression="true"
                         default="" skipvalidation="true"/>
          </section>

          <field label="Size" attribute="size" requiredexpression="true" tooltip="Panel's width">
            <renderer type="numericinput" params="min=1;max=12" />
          </field>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" label="Add Panel" tooltip="Add Widget" position="&lt;cancel"
                       service="dashboardAuxService" method="createAndAssociateGraphicPanel"
                       parameters="datamap" />
            </commandgroup>
          </commandbars>

          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </detail>

      </schemas>

    </application>


  </applications>

</metadata>
