<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <applications>

    <application entity="Dashboard" name="dashboard" title="Dashboard">
      <schemas>
        <schema id="saveDashboardConfirmation" stereotype="detailnew">
          <field attribute="title" label="Title" requiredexpression="@mode!='restore'" enableexpression="@mode!='restore'"/>
          <optionfield attribute="mode">
            <renderer type="radio" params="vertical=true"/>
            <filter clientfunction="dashboardAuxService.filterSelectableModeOptions"/>
            <option label="Brand New" value="brandnew"/>
            <option label="Copy from existing" value="clone"/>
            <option label="Restore" value="restore"/>
          </optionfield>

          <optionfield attribute="application" providerattribute="#applications" 
                       skipvalidation="true"
                       label="Application" tooltip="Restrict the dashboard to an application. Useful for filtering dashboards by application permission."
                       requiredexpression="false"
                       showexpression="@mode === 'brandnew'" default="" />

          <optionfield attribute="dashboardid" label="Select Dashboard" providerattribute="existingDashboards" showexpression="@mode!='brandnew'">
            <filter clientfunction="dashboardAuxService.filterSelectableDashboards"/>
          </optionfield>

          <!--<section showexpression="@canCreateBoth">
            <optionfield attribute="policy" label="Policy">
              <option label="Personal" value="personal"/>
              <option label="Shared" value="shared"/>
            </optionfield>
            <optionfield attribute="profiles" providerattribute="profiles" showexpression="@policy=='shared'" skipvalidation="true">
              <renderer type="checkbox"/>
            </optionfield>
          </section>-->

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" parameters="datamap" service="dashboardAuxService" method="saveDashboard" label="Confirm" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          
        </schema>
      </schemas>
    </application>


    <application entity="DashboardBasePanel" name="basedashboard" title="Base Dashboard">
      <schemas>
        <schema id="panelselection">
          <optionfield attribute="paneltype" label="Widget Type" tooltip="The type of widget to add" default="">
            <option label="Grid" value="dashboardgrid"/>
            <option label="Graphic" value="dashboardgraphic"/>
            <event type="afterchange" service="dashboardAuxService" method="loadPanels"/>
          </optionfield>

          <!--<section showexpression="@numberofpanels>0">
            <header label="Position" displacement="ontop"/>
            <field attribute="row" label="Row">
              <renderer type="numericinput" params="minvalue=1"/>
            </field>
            <field attribute="column" label="Column">
              <renderer type="numericinput" params="minvalue=1"/>
            </field>
          </section>-->

          <section orientation="horizontal" showexpression="@paneltype==='dashboardgrid'">
            <header label="Select Widget" displacement="sameline"/>
            <optionfield attribute="panel" providerattribute="availablepanels" skipvalidation="true"/>
            <section resourcepath="/Content/Shared/dashboard/templates/createnewpanelbutton.html"/>
          </section>

          <section orientation="horizontal" showexpression="@paneltype==='dashboardgraphic'">
            <header label="Select Graphic" displacement="sameline"/>
            <optionfield attribute="panel" providerattribute="availablepanels" skipvalidation="true"/>
            <section resourcepath="/Content/Shared/dashboard/templates/createnewpanelbutton.html"/>
          </section>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" enableexpression="@panel!=null" service="dashboardAuxService" parameters="datamap" method="selectPanel" label="Select Panel" tooltip="Add Widget" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </schema>
      </schemas>
    </application>

    <application entity="DashboardGridPanel" name="dashboardgrid" title="DashBoardGrid">
      <schemas>
        <detail>
          <field label="Alias" attribute="alias" requiredexpression="true" tooltip="How this panel can be located" enableexpression="!@id"/>
          <field label="Title" attribute="title" requiredexpression="true" tooltip="The Panel title"/>
          <optionfield label="Application" attribute="application" providerattribute="applications" requiredexpression="true" skipvalidation="true">
            <renderer type="autocompleteclient"/>
            <event type="afterchange" method="lookupFields" service="dashboardAuxService"/>
          </optionfield>
          <section showexpression="@application!=null">

            <optionfield label="Fields" attribute="fields" providerattribute="appfields" skipvalidation="true">
              <renderer type="checkbox"/>
            </optionfield>

            <optionfield label="Sort By" attribute="sortby" providerattribute="appfields" skipvalidation="true">
              <renderer type="autocompleteclient"/>
            </optionfield>

            <field attribute="limit" label="Limit" default="30" defaultexpression="30">
              <renderer type="numericinput"/>
            </field>

            <optionfield label="Width" attribute="size" requiredexpression="true" tooltip="Panel's width">
              <renderer type="combo" params="min=1;max=12" />
              <option label="3"   value="3" />
              <option label="4"   value="4" />
              <option label="6"   value="6" />
              <option label="8"   value="8" />
              <option label="9"   value="9" />
              <option label="12"  value="12" />
            </optionfield>

          </section>
          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" service="dashboardAuxService" method="createAndAssociateGridPanel"
                       parameters="datamap"
                       label="Add Grid Widget" tooltip="Add Grid Widget" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </detail>

      </schemas>

    </application>

    <application entity="DashboardGraphicPanel" name="dashboardgraphic" title="DashBoardGraphic">
      <schemas>
        <detail>
          <field label="Alias" attribute="alias" requiredexpression="true" tooltip="How this panel can be located" enableexpression="!@id"/>
          <field label="Title" attribute="title" requiredexpression="true" tooltip="The Panel title" />
          <optionfield label="Provider" attribute="provider"
                       tooltip="Name of the graphic storage service in which the graphic is located"
                       requiredexpression="true" default="">
            <option label="Chart" value="swChart" />
            <!--<option label="Tableau" value="Tableau" />-->
            <event type="afterchange" method="setGraphicProvider" service="dashboardAuxService"/>
          </optionfield>

          <section showexpression="@provider==='swChart'">

            <optionfield label="Application"
                         attribute="application"
                         requiredexpression="true"
                         default="">
              <renderer type="combo"/>
              <filter clientfunction="swchartGraphicPanelService.filterSelectableApplications"/>
              
              <option label="Service Request" value="SR" extraprojections="applicationName=servicerequest"/>
              <option label="Quick Service Request" value="SR" extraprojections="applicationName=quickservicerequest"/>
              <option label="Work Order" value="workorder" extraprojections="applicationName=workorder"/>
              
              <event type="afterchange" service="swchartGraphicPanelService" method="onApplicationSelected" />
            </optionfield>

            <optionfield label="Field" attribute="field" providerattribute="fields" skipvalidation="true"
                         default="" requiredexpression="true">
              <renderer type="combo"/>
            </optionfield>

            <optionfield label="Display Status As" attribute="statusfieldconfig"
                         default="all" requiredexpression="true"
                         showexpression="@field==='status'">
              <renderer type="radio"/>
              <option label="All" value="all" />
              <option label="Open/Closed" value="openclosed" />
            </optionfield>

            <section orientation="horizontal" showexpression="@statusfieldconfig!=='openclosed'">
              <field attribute="limit" default="0"
                     label="Top Values" tooltip="Number of the highest entries to show (zero means all entries)">
                <renderer type="numericinput" params="min=0" />
              </field>
              <field label="Show Others" attribute="showothers" showexpression="@limit > 0"
                     tooltip="Whether or not to show the remaining lowest entries accumulated as an 'others' category">
                <renderer type="checkbox"/>
              </field>
            </section>
            
            <optionfield label="Type" attribute="type"
                         requiredexpression="true"
                         default="">
              <option label="Vertical Bar Chart"    value="swRecordCountChart" />
              <option label="Horizontal Bar Chart"  value="swRecordCountRotatedChart" />
              <option label="Gauge"                 value="swRecordCountGauge" />
              <option label="Pie Chart"             value="swRecordCountPie" />
              <option label="Line Chart"            value="swRecordCountLineChart" />
              <!--
              <option label="Record Count Map"        value="swRecordCountMap" />
              <option label="Record Trends"         value="swRecordTrends" />
              <option label="Sparkline"             value="swSparkline" />
              -->
            </optionfield>

            <!--
            <field label="Options"
                         attribute="options"
                         requiredexpression="false"
                         default=""
                         skipvalidation="true">
              <renderer type="textarea"/>
            </field>
            -->

          </section>

          <section showexpression="@provider==='Tableau'">
            <optionfield label="Workbook"
                         attribute="workbook" providerattribute="workbooks"
                         requiredexpression="true"
                         default="" skipvalidation="true">
              <event type="afterchange" service="tableauGraphicPanelService" method="onWorkbookSelected" />
            </optionfield>
            <optionfield showexpression="@workbook!==null &amp;&amp; @workbook!==''"
                         label="View"
                         attribute="view" providerattribute="views"
                         requiredexpression="true"
                         default="" skipvalidation="true"/>
          </section>

          <optionfield label="Width" attribute="size" requiredexpression="true" tooltip="Panel's width">
            <renderer type="combo" params="min=1;max=12" />
            <option label="3"   value="3" />
            <option label="4"   value="4" />
            <option label="6"   value="6" />
            <option label="8"   value="8" />
            <option label="9"   value="9" />
            <option label="12"  value="12" />
          </optionfield>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" label="Save" tooltip="Save Graphic Widget" position="&lt;cancel"
                       service="dashboardAuxService" method="createAndAssociateGraphicPanel"
                       parameters="datamap" />
            </commandgroup>
          </commandbars>

          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </detail>

      </schemas>

    </application>


  </applications>

</metadata>
