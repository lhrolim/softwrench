<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@userprofile.xml"/>
  </templates>
  
  <entities>
    <!--This is a batch only for workorders-->
    <entity name="WOBatch"  whereclause="Application = 'WORKORDER' " idAttribute="Id" parententity="Batch">
      <attributes>
        <attribute name="wocount" type="int" query="@woBatchWhereClauseProvider.WoCountQuery"/>
      </attributes>
    </entity>
    

  </entities>


  <applications>


    <application entity="Dashboard" name="dashboard" title="Dashboard">
      <schemas>
        <schema id="saveDashboardConfirmation" stereotype="detail">
          <field attribute="title" label="Title"/>
          <section showexpression="@canCreateBoth">
            <optionfield attribute="policy" label="Policy">
              <option label="Personal" value="personal"/>
              <option label="Shared" value="shared"/>
            </optionfield>
            <optionfield attribute="profiles" providerattribute="profiles" showexpression="@policy=='shared'" skipvalidation="true">
              <renderer type="checkbox"/>
            </optionfield>
          </section>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" parameters="datamap" service="dashboardAuxService" method="saveDashboard" label="Confirm" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </schema>
      </schemas>
    </application>

    <application entity="AuditEntry" name="audit" title="Audit Trail">
      <schemas>
        <schema id="auditList" stereotype="list" title="Audit Trail">
          <field attribute="id" label="Audit Id"/>
          <field attribute="action" label="Action"/>
          <field attribute="refapplication" label="Application"/>
          <field attribute="refuserid" label="Record Id"/>
          <field attribute="createdby" label="Created By"/>
          <field attribute="createddate" label="Audit Date">
            <renderer type="datetime"/>
          </field>
        </schema>
          
        <schema id="auditDetail" stereotype="detail" title="Audit Trail Details">
          <field attribute="action" label="Action" readonly="true"/>
          <field attribute="refapplication" label="Application" readonly="true"/>
          <field attribute="refuserid" label="Record Id" readonly="true"/>
          <field attribute="createdby" label="Created By" readonly="true"/>
          <field attribute="createddate" label="Audit Date" readonly="true">
            <renderer type="datetime"/>
          </field>
          <!--<section showexpression="@canCreateBoth">
            <optionfield attribute="policy" label="Policy">
              <option label="Personal" value="personal"/>
              <option label="Shared" value="shared"/>
            </optionfield>
            <optionfield attribute="profiles" providerattribute="profiles" showexpression="@policy=='shared'">
              <renderer type="checkbox"/>
            </optionfield>
          </section>-->
        </schema>
      </schemas>
    </application>

    <application entity="DashboardBasePanel" name="basedashboard" title="Base Dashboard">
      <schemas>
        <schema id="panelselection">
          <optionfield attribute="paneltype" label="Widget Type" tooltip="The type of widget to add" default="">
            <option label="Grid" value="dashboardgrid"/>
            <option label="Graphic" value="dashboardgraphic"/>
            <event type="afterchange" service="dashboardAuxService" method="loadPanels"/>
          </optionfield>
          
          <!--<section showexpression="@numberofpanels>0">
            <header label="Position" displacement="ontop"/>
            <field attribute="row" label="Row">
              <renderer type="numericinput" params="minvalue=1"/>
            </field>
            <field attribute="column" label="Column">
              <renderer type="numericinput" params="minvalue=1"/>
            </field>
          </section>-->

          <section orientation="horizontal" showexpression="@paneltype==='dashboardgrid'">
            <header label="Select Widget" displacement="sameline"/>
            <optionfield attribute="panel" providerattribute="availablepanels" skipvalidation="true"/>
            <section resourcepath="/Content/Shared/dashboard/templates/createnewpanelbutton.html"/>
          </section>
          
          <section orientation="horizontal" showexpression="@paneltype==='dashboardgraphic'">
            <header label="Select Graphic" displacement="sameline"/>
            <optionfield attribute="panel" providerattribute="availablepanels" skipvalidation="true"/>
            <section resourcepath="/Content/Shared/dashboard/templates/createnewpanelbutton.html"/>
          </section>
          
          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" enableexpression="@panel!=null" service="dashboardAuxService" parameters="datamap" method="selectPanel" label="Select Panel" tooltip="Add Panel" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </schema>
      </schemas>
    </application>

    <application entity="DashboardGridPanel" name="dashboardgrid" title="DashBoardGrid">
      <schemas>
        <detail>
          <field label="Alias" attribute="alias" requiredexpression="true" tooltip="How this panel can be located"/>
          <field label="Title" attribute="title" requiredexpression="true" tooltip="The Panel title"/>
          <optionfield label="Application" attribute="application" providerattribute="applications" requiredexpression="true" skipvalidation="true">
            <renderer type="autocompleteclient"/>
            <event type="afterchange" method="lookupFields" service="dashboardAuxService"/>
          </optionfield>
          <section showexpression="@application!=null">

            <optionfield label="Fields" attribute="fields" providerattribute="appfields" skipvalidation="true">
              <renderer type="checkbox"/>
            </optionfield>

            <optionfield label="Sort By" attribute="sortby" providerattribute="appfields" skipvalidation="true">
              <renderer type="autocompleteclient"/>
            </optionfield>

            <field attribute="limit" label="Limit" default="30" defaultexpression="30">
              <renderer type="numericinput"/>
            </field>

          </section>
          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" service="dashboardAuxService" method="createAndAssociateGridPanel"
                       parameters="datamap"
                       label="Add Panel" tooltip="Add Widget" position="&lt;cancel" />
            </commandgroup>
          </commandbars>
          <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </detail>



      </schemas>
    </application>
    
    <application entity="DashboardGraphicPanel" name="dashboardgraphic" title="DashBoardGraphic">
      <schemas>
        <detail>
          <field label="Alias" attribute="alias" requiredexpression="true" tooltip="How this panel can be located"/>
          <field label="Title" attribute="title" requiredexpression="true" tooltip="The Panel title"/>
          <optionfield label="Provider" attribute="provider"
                       tooltip="Name of the graphic storage service in which the graphic is located"
                       requiredexpression="true" default="">
            <option label="Chart" value="swChart" />
            <option label="Tableau" value="Tableau" />
            <event type="afterchange" method="setGraphicProvider" service="dashboardAuxService"/>
          </optionfield>

          <section showexpression="@provider==='swChart'">
            <optionfield label="Application"
                         attribute="application"
                         requiredexpression="false"
                         default=""
                         skipvalidation="true">
              <renderer type="combo"/>
              <option label="Service Request" value="sr"/>
            </optionfield>
            <optionfield label="Field"
              attribute="field"
              default=""
              requiredexpression="false"
              skipvalidation="true">
              <renderer type="combo"/>
              <option label="Owner" value="owner"/>
              <option label="Priority" value="priority"/>
              <option label="Reporter" value="reporter"/>
              <option label="Status" value="status"/>
            </optionfield>
            <optionfield label="Type"
                         attribute="type"
                         requiredexpression="false"
                         default=""
                         skipvalidation="true">
              <option label="Record Count Bar Chart" value="swRecordCountChart"/>
              <option label="Record Count Gauge" value="swRecordCountGauge"/>
              <option label="Record Count Map" value="swRecordCountMap"/>
              <option label="Record Count Pie Chart" value="swRecordCountPie"/>
              <option label="Record Trends" value="swRecordTrends"/>
              <option label="Sparkline" value="swSparkline"/>
            </optionfield>
            <field label="Options"
                         attribute="options"
                         requiredexpression="false"
                         default=""
                         skipvalidation="true">
              <renderer type="textarea"/>
            </field>
          </section>
          
          <section showexpression="@provider==='Tableau'">
            <optionfield label="Workbook"
                         attribute="workbook" providerattribute="workbooks"
                         requiredexpression="true"
                         default="" skipvalidation="true">
              <event type="afterchange" service="tableauGraphicPanelService" method="onWorkbookSelected" />
            </optionfield>
            <optionfield showexpression="@workbook!==null &amp;&amp; @workbook!==''" 
                         label="View"
                         attribute="view" providerattribute="views"
                         requiredexpression="true" 
                         default="" skipvalidation="true"/>
          </section>
          
          <commandbars>
            <commandgroup position="modal.detail.primary">
              <removecommand id="save"/>
              <command id="save" icon="fa-check" label="Add Panel" tooltip="Add Widget" position="&lt;cancel"
                       service="dashboardAuxService" method="createAndAssociateGraphicPanel"
                       parameters="datamap" />
            </commandgroup>
          </commandbars>
          
            <properties>
            <property key="associationstoprefetch" value="#none"/>
          </properties>
        </detail>



      </schemas>
    </application>


    <application entity="WOBatch" name="wobatch" title="Workorder Batch">
      <schemas>
        <list title="Workorder Batches">
          <commandbars>
            <commandgroup position="gridtop" removeundeclared="true">
              <command id="refresh" icon="fa-refresh" tooltip="refresh" service="searchService" method="refreshGrid"/>
              <command id="newbatch" icon="fa fa-plus" label="New Batch" service="wobatchService" method="newBatch"/>
            </commandgroup>
          </commandbars>
          <event type="onload" service="wobatchService" method="configurePolling"/>
          <field attribute="id" label="Batch ID">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute="alias" label="Alias">
            <renderer type="default" params="width=30%"/>
          </field>
          <field attribute="status" label="Status">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute="updatedate" label="Updated">
            <renderer type="datetime" params="width=25%"/>
          </field>
          <field attribute="wocount" label="Work Order Count">
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute="itemids" label="Workorders" hidden="true"/>
          <properties>
            <property key="list.click.service" value="wobatchService.edit"/>
          </properties>
        </list>
      </schemas>
    </application>

    <application name="batchreport" entity="BatchReport" title="Batch Report">
      <schemas>
        <detail mode="output">
          <commandbars>
            <commandgroup position="detail.primary">
              <removecommand id="print"/>
              <command id="cancel" icon="fa-times" service="$scope" method="cancel" label="Cancel" tooltip="Cancel" parameters="default='_batch.list'"/>
            </commandgroup>
          </commandbars>
          <section id="sentbatch" resourcepath="/Content/Templates/batches/dynamiccomposition.html" parameters="schemaref=failedbatchschema;
                   datamapref=failedbatchdatamap;title=Problematic Items">
            <!--            <header label="Problematic Items" displacement="ontop"/>-->
          </section>
          <section id="sentbatch" resourcepath="/Content/Templates/batches/dynamiccomposition.html" parameters="schemaref=sentbatchschema;
                   datamapref=sentbatchdatamap;title=Sent Items">
            <!--            <header label="Sent Items" displacement="ontop"/>-->
          </section>
          <properties>
            <property key="detail.cancel.click" value="_wobatch.list"/>
          </properties>
        </detail>
      </schemas>
    </application>

    <application name="ProblemItems" entity="BatchItemProblem" title="Batch Problems">
      <schemas>
        <schema id="list" stereotype="compositionlist">
          <field attribute="itemid" label="Item Id"/>
          <field attribute="errormessage" label="Error Message"/>
        </schema>
      </schemas>
    </application>
    
    <application name="SoftwrenchError" entity="Problem" title="Softwrench Error">
      <schemas>
        <schema id="list" stereotype="list" title="Softwrench Errors">
          <field attribute="id" hidden="true"/>
          <field attribute="recordtype" label="Error Type"/>
          <field attribute="recordid" label="Record ID"/>
          <field attribute="description" label="Description"/>
          <field attribute="createddate" label="Error Date"/>
          <field attribute="createdby" label="Created By"/>
          <field attribute="assignee" label="Assignee"/>
          <field attribute="priority" label="Priority"/>
          <field attribute="status" label="Status"/>
        </schema>
    
        <schema id="detail" stereotype="detail" mode="input" title="Softwrench Error Detail">
          <field attribute="id" hidden="true"/>
          <field attribute="recordtype" label="Error Type" readonly="true"/>
          <field attribute="recordid" label="Record ID" readonly="true"/>
          <field attribute="description" label="Description" readonly="true"/>
          <field attribute="data" hidden="true"/>
          <field attribute="#dataasstring" label="Data">
            <renderer type="textarea"/>
          </field>
          <commandbars>
            <commandgroup position="detail.primary" removeundeclared="true">
              <command id="submit" label="Submit" position="&lt;cancel"/>
              <command id="resolve" label="Resolve" position="&lt;cancel"/>
              <command id="cancel" label="Cancel" stereotype="cancel"/>
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>
    
    
    
  </applications>
</metadata>