<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.example.org/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.example.org/metadata ../../Schema/Metadata.xsd ">


  <entities>
    <entity name="SR" idAttribute="ticketid">
      <relationships>
        <relationship to="person" qualifier="affectedperson">
          <relationshipAttribute from="affectedperson" to="personid" primary="true"/>
          <relationshipAttribute to="status" literal="ACTIVE" quoteLiteral="true" />
        </relationship>
        <relationship to="person" qualifier="reportedbyperson">
          <relationshipAttribute from="reportedby" to="personid" primary="true"/>
        </relationship>
        <relationship to="person" qualifier="createdbyperson">
          <relationshipAttribute from="createby" to="personid" primary="true"/>
        </relationship>
        <relationship to="person" qualifier="ownerperson">
          <relationshipAttribute from="owner" to="personid" primary="true"/>
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWSR" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Gric.GricServiceRequestCrudConnector" />
      </connectorParameters>
    </entity>

    <entity name="workorder" idAttribute="wonum" whereclause="( historyflag = 0 and istask = 0 )">
      <relationships>
        <relationship to="site" qualifier="site">
          <relationshipAttribute from="siteid" to="siteid" primary="true"/>
        </relationship>
        <relationship to="person" qualifier="reportedbyperson">
          <relationshipAttribute from="reportedby" to="personid" primary="true"/>
        </relationship>
        <relationship to="failurelist">
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWWO" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Commons.BaseWorkOrderCrudConnector" />
      </connectorParameters>
    </entity>
    
    <entity name ="failurelist" idAttribute="failurecode" whereclause="((failurelist.TYPE is null)) " >
      <attributes>
        <attribute name="failurelist" type="bigint" required="true" />
        <attribute name="failurecode" type="varchar" required="true" />
        <attribute name="parent" type="bigint" required="false" />
        <attribute name="type" type="varchar" required="false" />
        <attribute name="orgid" type="varchar" required="true" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>
      <connectorParameters>
        <connectorParameter key="dbtable" value="failurelist" />
      </connectorParameters>
    </entity>
  </entities>

  <applications>
    <application entity="SR" name="servicerequest" title="Service Request">
      <schemas>
        <list title="Service Request Grid">
          <field attribute="ticketid" label="Request #">
            <renderer type="default" params="minwidth=110px" />
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field attribute="reportedbyperson_.displayname" label="Reported By">
            <renderer type="default" params="minwidth=150px"/>
          </field>
          <field attribute="status" label="Status">
            <renderer type="default" params="minwidth=150px" />
          </field>
          <field attribute="affectedperson" label="Affected Person">
            <renderer type="default" params="minwidth=150px" />
          </field>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
          </properties>
        </list>

        <schema id="adetail" title="Request Details" abstract="true" stereotype="detail">

          <section id="siteidsection"/>
          <field attribute="ticketuid" label="Request #" hidden="true"/>
          <field attribute="class" label="" hidden="true"/>
          <field attribute="actlabcost" hidden="true" />
          <field attribute="actlabhrs" hidden="true"/>
          <field attribute="siteid" hidden="true" />
          <field attribute="orgid" hidden="true"/>
          <field attribute="createby" hidden="true"/>

          <section id="statussection"/>
          <section id="reportbysection"/>
          <association label="Owner" target="owner" labelfield="ownerperson_.displayname" default="@username">
            <renderer type="lookup"/>
            <event type="afterchange" service="srService" method="afterchangeowner"/>
          </association>
          <field label="Reported Date &amp; Time" attribute="reportdate" readonly="true" default="@currentdatetime">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
          </field>

          <field attribute="targetstart" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="targetfinish" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="actualstart" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="actualfinish" hidden="true" attributeToServer="#notusedattribute"/>

          <section id="targetStart" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=targetstart;">
            <header label="Target Start Date:" displacement="sameline"/>
          </section>

          <section id="targetFinish" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=targetfinish;">
            <header label="Target Finish Date:" displacement="sameline"/>
          </section>

          <section id="actualStart" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=actualstart;">
            <header label="Actual Start Date:" displacement="sameline"/>
          </section>

          <section id="actualFinish" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=actualfinish;">
            <header label="Actual Finish Date:" displacement="sameline"/>
          </section>


          <association label="Affected Person" target="affectedperson" labelfield="affectedperson_.displayname" default="@username">
            <renderer type="lookup"/>
          </association>
          <field attribute="description" label="Summary" required="true"/>
          <field label="Details" attribute="longdescription_.ldtext" required="true">
            <renderer type="textarea"/>
          </field>
          <section id="attachmentsection" />
          <association label="Location:" target="location" labelfield="location_.description" dependantfields="siteid" >
            <event type="beforechange" service="srService" method="beforeChangeLocation"/>
          </association>
          <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location_.description">
            <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
            <dataprovider prefilterfunction="FilterAssets"/>
            <event type="afterchange" service="srService" method="afterChangeAsset"/>
          </association>

          <section id="compositions"/>
        </schema>

        <schema title="New Service Request" id="newdetail" parentschema="adetail">
          <section id="siteidsection">
            <field attribute="ticketid" label="Request #" hidden="true"/>
            <association label="Site" target="siteid" labelfield="site_.description" required="true">
              <!-- removed default='@usersite' from the above association label-->
              <renderer type="lookup"/>
            </association>
          </section>
          <section id="statussection">
            <field label="Status" attribute="status" readonly="true" default="NEW" hidden="true"/>
          </section>
          <section id="reportbysection">
            <field attribute="reportedby" label="Reported By" default="@username" readonly="true" />
          </section>
          <section id="attachmentsection">
            <field label="Attachment:" attribute="newattachment" >
              <renderer type="upload"/>
            </field>
          </section>
        </schema>

        <schema id="editdetail" title="Service Request Detail" parentschema="adetail">
          <section id="siteidsection">
            <field attribute="reportdate" hidden="true">
              <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
            </field>
            <field attribute="ticketid" label="Request #" readonly="true"/>
            <field label="Site" attribute="siteid" readonly="true"/>
          </section>

          <section id="statussection">
            <association label="Status" target="status" labelfield="synstatus.description">
              <renderer type="combo" />
							<event type="beforechange" service="srService" method="beforeChangeStatus"/>
            </association>
          </section>

          <section id="reportbysection">
            <field attribute="reportedby" label="Reported By" default="@username" readonly="true" hidden="true"/>
            <field attribute="reportedbyperson_.displayname" label="Reported By" default="@username" readonly="true" />
          </section>

          <section id="compositions">
            <composition relationship="worklog" label="Work Log"/>
            <composition relationship="attachment" label="Attachments"/>
          </section>

          <commands>
            <command id="crud_delete" label="Delete" service="crudextraService" method="deletefn" parameters="schema,datamap" 
                     showexpression="@status=='NEW'" successmessage="SR deleted" icon="glyphicon-remove"/>
          </commands>
        </schema>



      </schemas>

    </application>

    <application name="asset" title="Asset" entity="asset" id="00000000-0000-0000-0000-000000000001" >
      <properties>
        <property key="mobile.fetchlimit" value="30"/>
        <property key="mobile.userInteractionEnabled" value="false"/>
      </properties>
      <schemas>
        <list>
          <field attribute="assetnum" label="Asset" qualifier="title"/>
          <field attribute="location" label="Location" qualifier="subtitle"/>
          <field attribute="vendor" label="Vendor"  qualifier="featured"/>
        </list>
        <detail>
          <field attribute="assetid" label="ID"  required="true" />
          <field attribute="assetnum" label="Asset"  required="true" />
          <field attribute="location" label="Location"  required="true" />
          <field attribute="vendor" label="Vendor"  />
          <field attribute="description" label="Description"  />
          <field attribute="failurecode" label="Failure Code"  />
          <field attribute="priority" label="Priority"  />
          <field attribute="siteid"  required="true" readonly="true" hidden="true"/>
        </detail>
        <schema id="assetLookupList" stereotype="list">
          <field attribute="assetnum" label="Asset"/>
          <field attribute="description" label="Description">
            <renderer type="default" params="minwidth=300px" />
          </field>
          <field attribute="location" label="Location"/>
          <field attribute="siteid"  label="Site"/>
        </schema>
      </schemas>

    </application>

    <application name="location" title="Location" entity="location" id="00000000-0000-0000-0000-000000000002">
      <properties>
        <property key="mobile.fetchlimit" value="16000"/>
        <property key="mobile.userInteractionEnabled" value="false"/>
      </properties>
      <schemas>
        <list >
          <field attribute="location" label="Location" qualifier="title"/>
          <field attribute="description" label="Description" qualifier="excerpt"/>
        </list>
        <detail>
          <field attribute="locationsid" label="ID"  required="true" />
          <field attribute="location" label="Location"  required="true" />
          <field attribute="description" label="Description"  required="true" />
          <field attribute="siteid"  required="true" readonly="true" hidden="true"/>
          <field attribute="type"  required="true" readonly="true" hidden="true"/>
        </detail>
      </schemas>
    </application>

    <!--    Record Key Class Created By Created Date Log Type Summary-->
    <application name="worklog" title="Work Log" entity="worklog" id="00000000-0000-0000-0000-000000000008" >
      <schemas>
        <schema id="list" stereotype="compositionlist">
          <field  attribute="worklogid" hidden="true"/>
          <field  attribute="recordkey" label="Record Key" hidden="true" />
          <field  attribute="class" label="Class" hidden="true" />
          <field  attribute="createby" label="Created By" hidden="true" />
          <field attribute="createdbyperson_.displayname" label="Created By"/>
          <field  attribute="createdate" label="Created Date">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
          </field>

          <field  attribute="logtype" label="Log Type" hidden="true" />
          <field  attribute="description" label="Summary" />
          <field  attribute="longdescription_.ldtext" label="Details" hidden="true" />
        </schema>
        <detail stereotype="compositiondetail">
          <field  attribute="description" label="Summary" />
          <field  attribute="longdescription_.ldtext" label="Details" >
            <renderer type="textarea"/>
          </field>
        </detail>
      </schemas>
    </application>

    <application name="attachment" title="Attachment" entity="DOCLINKS">
      <schemas>
        <schema id="list" stereotype="compositionlist">
          <properties>
            <property key="detail.cancel.lbl" value="Close"/>
            <property key="expansible" value="false"/>
          </properties>
          <field label="Id" hidden="true" attribute="docinfoid"/>
          <field hidden="true" attribute="doclinksid"/>
          <field label="Document" hidden="true" attribute="document"/>
          <section attribute="document"
														   resourcepath="/Content/Templates/downloadattachment.html" parameters="controller=Attachment;action=Download;idcolumn=docinfoid;mode=http">
            <header label="Document"/>
          </section>

          <field label="Created Date" attribute="createdate"/>
        </schema>

        <detail>
          <field label="Attachment:" attribute="newattachment" required="true">
            <renderer type="upload"/>
          </field>
          <!--wip-->
          <!--          <field label="ScreenShot:" attribute="reportedby">-->
          <!--            <renderer type="screenshot"/>-->
          <!--          </field>-->
        </detail>

      </schemas>
    </application>

    <application name="longdescription" title="Long Description" entity="longdescription" id="00000000-0000-0000-0000-000000000007">
      <properties>
        <property key="mobile.userInteractionEnabled" value="false"/>
        <property key="mobile.fetchlimit" value="30"/>
      </properties>
      <schemas>
        <detail>
          <field attribute="ldkey"  />
          <field attribute="ldownertable"  />
          <field attribute="ldownercol"  />
          <field attribute="ldtext"  />
          <field attribute="longdescriptionid"  />
        </detail>
      </schemas>
    </application>
    
    <!-- Adding the Workorder application from the otb -->
    <application name="workorder" title="Work Order" entity="workorder">
      <properties>
        <property key="mobile.fetchlimit" value="300"/>
      </properties>
      <schemas>
        <list title="Work Order Grid" platform="web">
          <field attribute="wonum" label="WO No">
            <renderer type="default" params="minwidth=110px" />
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" params="excelwidth=50" />
          </field>
          <field attribute="location" label="Location">
            <renderer type="default" params="minwidth=150px" />
          </field>
          <field attribute="asset_.description" label="Asset">
            <renderer type="default" params="minwidth=150px" />
          </field>
          <field attribute="status" label="Status">
            <renderer type="default" params="minwidth=150px" />
          </field>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
          </properties>
        </list>

        <schema id="adetail" title="Work Order Detail" abstract="true" stereotype="detail" platform="web">
          <field attribute="estdur"            hidden="true"/>
          <field attribute="estlabhrs"         hidden="true"/>
          <field attribute="estmatcost"        hidden="true"/>
          <field attribute="estintlabhrs"      hidden="true"/>
          <field attribute="estintlabcost"     hidden="true"/>
          <field attribute="estatapprlabhrs"   hidden="true"/>
          <field attribute="estatapprmatcost"  hidden="true"/>
          <field attribute="estatapprlabcost"  hidden="true"/>
          <field attribute="estatapprtoolcost" hidden="true"/>
          <field attribute="estatapprservcost" hidden="true"/>
          <field attribute="estapprlabhrs"     hidden="true"/>
          <field attribute="estapprmatcost"    hidden="true"/>
          <field attribute="estapprlabcost"    hidden="true"/>
          <field attribute="estlabcost"        hidden="true"/>
          <field attribute="esttoolcost"       hidden="true"/>
          <field attribute="estservcost"       hidden="true"/>
          <field attribute="actlabhrs"         hidden="true"/>
          <field attribute="actlabcost"        hidden="true"/>
          <field attribute="actservcost"       hidden="true"/>
          <field attribute="actmatcost"        hidden="true"/>
          <field attribute="acttoolcost"       hidden="true"/>
          <field attribute="outlabcost"        hidden="true"/>
          <field attribute="outmatcost"        hidden="true"/>
          <field attribute="outtoolcost"       hidden="true"/>
          <field attribute="outservcost"       hidden="true"/>
          <field attribute="workorderid"  readonly="true" hidden="true"/>
          <field attribute="wonum" label="WO No" readonly="true" />
          <field attribute="orgid"  required="true" readonly="true" hidden="true"/>
          
          <field attribute="siteid" hidden="true" />
          <field attribute="woclass" hidden="true"/>
          <field attribute="synstatus_.maxvalue"  readonly="true" hidden="true"/>
          <section id="ownerstatussection"/>
          <field attribute="wopriority" label="Priority" required="true" default="1">
            <renderer type="numericinput" params="min=1;max=5;decimals=0"/>
          </field>
          
          <association label="Location" target="location" labelfield="location_.description" >
            <event type="beforechange" service="srService" method="beforeChangeLocation"/>
            <!--renderer type="lookup"/-->
          </association>
          <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location">
            <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
            <dataprovider prefilterfunction="FilterAssets"/>
            <event type="afterchange" service="srService" method="afterChangeAsset"/>
          </association>
          <section id="reportbysection"/>
          <association label="Failure Code" target="failurecode" labelfield="failurelist_.failurecode" >
            <!--renderer type="lookup"/-->
          </association>
          <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" >
            <renderer type="lookup"/>
          </association>
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts_.accountname" >
            <renderer type="lookup"/>
          </association>
          <!-- Adding target start finish date-->
          <field attribute="targetstart" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="targetfinish" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="actualstart" hidden="true" attributeToServer="#notusedattribute"/>
          <field attribute="actualfinish" hidden="true" attributeToServer="#notusedattribute"/>

          <section id="targetStart" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=targetstart;">
            <header label="Target Start Date:" displacement="sameline"/>
          </section>

          <section id="targetFinish" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=targetfinish;">
            <header label="Target Finish Date:" displacement="sameline"/>
          </section>

          <section id="actualStart" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=actualstart;">
            <header label="Actual Start Date:" displacement="sameline"/>
          </section>

          <section id="actualFinish" resourcepath="/Content/Templates/samelinepickers.html"
                         parameters="joinattribute=actualfinish;">
            <header label="Actual Finish Date:" displacement="sameline"/>
          </section>



          <field attribute="description" label="Description" required="true" />
          <field label="Details" attribute="longdescription_.ldtext" required="true">
            <renderer type="textarea"/>
          </field>
          <section id="compositions"/>
        </schema>

        <schema parentschema="adetail" title="New Work Order" id="newdetail" platform="web">
          <section id="ownerstatussection">
            <field attribute="owner" label="Owner"/>
            <field label="Status" attribute="status" readonly="true" default="WAPPR" hidden="true"/>
            <association label="Site" target="siteid" labelfield="site_.description" required="true">
              <!-- removed default='@usersite' from the above association label-->
              <renderer type="lookup"/>
            </association>
            
          </section>
          <section id="reportbysection">
            <field attribute="reportedby" label="Reported By" default="@username" readonly="true" />
          </section>
        </schema>

        <schema parentschema="adetail" id="editdetail" title="Work Order Detail" platform="web">
          <section id="ownerstatussection">
            <field attribute="owner" label="Owner" readonly="true"/>
            <association label="Status" target="status" labelfield="synstatus.description">
              <renderer type="combo"/>
            </association>
            <field label="Site" attribute="siteid" readonly="true"/>
          </section>
          <section id="reportbysection">
            <!--field attribute="reportedby" label="Reported By" default="@username" readonly="true" hidden="true"/-->
            <field attribute="reportedbyperson_.displayname" label="Reported By" default="@username" readonly="true" />
          </section>
          <section id="compositions">
            <composition relationship="worklog" label="Work Log">
              <collectionproperties allowupdate="false" allowcreation="true" />
            </composition>
            <composition relationship="attachment" label="Attachments" >
              <collectionproperties allowupdate="false" allowcreation="true" />
            </composition>
          </section>
        </schema> 
      </schemas>
    </application>
  </applications>
</metadata>