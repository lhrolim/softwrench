
<form>
    <div id="affixpagination" class="affix-pagination hiddenonprint">
        <div class="context clearfix header-menu">
            <gridtoolbar position="gridtop"
                         datamap="datamap"
                         schema="schema"
                         pagination-data="paginationData"
                         search-data="searchData"
                         search-sort="searchSort"
                         search-operator="searchOperator" />
            <pagination pagination-data="paginationData" renderfn="selectPage(pageNumber,pageSize,printMode)"
                        schema="schema" application-name="{{schema.applicationName}}"
                        search-data="searchData"
                        search-operator="searchOperator" />
        </div>
        <!--TODO: make this encapsulated inside gridfilter.html... is that possible?-->
        <div class="context clearfix header-menu" ng-if="advancedfiltermode">
            <div class="form-horizontal" role="form">
                <div class="form-group">
                    <label for="advancedSearch" class="col-sm-1 control-label">Search</label>
                    <div class="col-sm-11">
                        <div class="input-group">
                            <input class="form-control" id="advancedSearch" ng-model="advancedsearchdata" ng-enter="doAdvancedSearch(advancedsearchdata)">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" ng-enabled="advancedsearchdata && advancedsearchdata != ''"
                                        ng-click="doAdvancedSearch(advancedsearchdata)">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="divAuxTable">
        <table class="table table-hover hidden-phone fixedtable listgrid-table" data-application="{{schema.applicationName}}" data-schema="{{schema.schemaId}}" id="listgrid">
            <thead id="listgridthread" class="listgrid-thead">
                <!-- Header row -->
                <tr class="header-row">
                    <th ng-show="schema.properties['list.selectionstyle'] == 'multiple'">
                        <!--Multiselect-->
                    </th>
                    <th ng-show="schema.properties['list.selectionstyle'] == 'single'">
                        <!--Singleselect-->
                    </th>
                    <th ng-repeat="column in schema.displayables" ng-show="!isFieldHidden(schema,column)"
                        ng-style="{'min-width': column.rendererParameters['minwidth'],
                                           'max-width': column.rendererParameters['maxwidth'],
                                           'width': column.rendererParameters['width'],
                                           'word-wrap': column.rendererParameters['wordwrap']}"
                        ng-click="sort(column)">
                        <div ng-if="shouldShowHeaderLabel(column)">
                            <span class="add-on" rel="tooltip" data-container="body" data-original-title="{{i18N('_grid.filter.clicksort','Click here to sort')}}">
                                {{i18NLabel(column)}}
                            </span>
                            <span class="glyphicon glyphicon-sort-by-attributes"
                                  ng-show="column.attribute != null && searchSort.field == column.attribute && searchSort.order == 'asc'"
                                  rel="tooltip" data-original-title="Sorted ascendant"></span>
                            <span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="column.attribute != null
                                  && searchSort.field == column.attribute && searchSort.order == 'desc'"
                                  rel="tooltip" data-original-title="Sorted descendant"></span>
                        </div>
                    </th>
                </tr>

                <tr class="filter-row hidden-too-much-columns hiddenonprint" ng-if="schema.properties['list.disablefilter'] != 'true'">
                    <th ng-show="schema.properties['list.selectionstyle'] == 'multiple'">
                        <input type="checkbox"
                               ng-change="toggleSelectAll(selectAllChecked)" ng-model="selectAllChecked">
                    </th>
                    <th ng-show="schema.properties['list.selectionstyle'] == 'single'">
                        <!--Singleselect-->
                    </th>

                    <th ng-repeat="column in schema.displayables"
                        ng-style="{'min-width': column.rendererParameters['minwidth'],
                                'max-width': column.rendererParameters['maxwidth'],
                                'width': column.rendererParameters['width']}"
                        ng-show="!isFieldHidden(schema,column)"
                        filterrowrendered>
                        <div ng-if="shouldShowHeaderFilter(column)">
                            <ng-switch on="column.type">
                                <div ng-switch-when="ApplicationFieldDefinition">
                                    <ng-switch on="column.rendererType">
                                        <div ng-switch-when="datetime" data-datepicker="true" class="input-group input-group-sm">
                                            <input type="text" ng-model="searchData[column.attribute]" class="form-control"
                                                   data-date-time
                                                   data-show-time="false"
                                                   data-show-date="{{column.rendererParameters['showdate']}}"
                                                   data-date-format="{{column.rendererParameters['format']}}"
                                                   data-allow-past="{{fieldMetadata.rendererParameters['allowpast']}}"
                                                   data-allow-future="{{fieldMetadata.rendererParameters['allowfuture']}}"
                                                   placeholder="{{i18N('_grid.filter.placeholder','{0} Search',[column.label])}}" ng-enter="filterSearch(column.attribute,$event)" />
                                            <span class="input-group-addon " data-calendericon="true" rel="tooltip" data-original-title="{{i18N('calendar.date_tooltip','Open the calendar popup')}}">
                                                <i class="glyphicon glyphicon-calendar"></i>
                                            </span>

                                            <!-- Couldn't use directive "advanced-filter-toogle" here, due to fix/unfix header functionality.
                                                The following div cant 'include' later, or else the grid header will break in firefox and ie. -->
                                            <div class="input-group-addon dropdown">
                                                <span class="dropdown-toggle grid-filter-button" ng-class="{'glyphicon glyphicon-filter' : getSearchIcon(column.attribute) == ''}"
                                                      data-toggle="dropdown" rel="tooltip"
                                                      data-original-title="{{getOperator(column.attribute).tooltip}}">{{getSearchIcon(column.attribute)}}</span>

                                                <ul class="dropdown-menu">
                                                    <li ng-repeat="operation in searchOperations()" ng-click="selectOperator(column.attribute,operation)"
                                                        ng-show="operation.renderType.indexOf(column.rendererType) > -1 || column.rendererType == null"
                                                        ng-class="{'active' : searchOperator[column.attribute].id == operation.id}">
                                                        <a href="#">{{operation.title}}</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div ng-switch-default class="input-group input-group-sm">
                                            <input type="search" placeholder="{{i18N('_grid.filter.placeholder','{0} Search',[column.label])}}" class="form-control"
                                                   ng-model="searchData[column.attribute]" ng-enter="filterSearch(column.attribute)" />
                                            <!-- Couldn't use directive "advanced-filter-toogle" here, due to fix/unfix header functionality.
                                                The following div cant 'include' later, or else the grid header will break in firefox and ie. -->
                                            <div class="input-group-addon dropdown">
                                                <span class="dropdown-toggle grid-filter-button" ng-class="{'glyphicon glyphicon-filter' : getSearchIcon(column.attribute) == ''}"
                                                      data-toggle="dropdown" rel="tooltip"
                                                      data-original-title="{{getOperator(column.attribute).tooltip}}">{{getSearchIcon(column.attribute)}}</span>

                                                <ul class="dropdown-menu">
                                                    <li ng-repeat="operation in searchOperations()" ng-click="selectOperator(column.attribute,operation)"
                                                        ng-show="operation.renderType.indexOf(column.rendererType) > -1 || column.rendererType == null"
                                                        ng-clasicos="{'active' : searchOperator[column.attribute].id == operation.id}">
                                                        <a href="#">{{operation.title}}</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </ng-switch>
                                </div>
                                <div ng-switch-when="OptionField">
                                    <div ng-switch on="column.rendererType">
                                        <div class="input-group" ng-switch-when="combo" class="sw-combobox-container">
                                            <select class="hidden-phone form-control combobox"
                                                    ng-init="handleDefaultValue(dm.fields,column)"
                                                    ng-model="searchData[column.target]"
                                                    ng-options="option.value as i18NOptionField(option,column,schema)
                                                for option in GetAssociationOptions(column)" />

                                            <div class="input-group-addon dropdown">
                                                <span class="dropdown-toggle grid-filter-button" ng-class="{'glyphicon glyphicon-filter' : getSearchIcon(column.attribute) == ''}"
                                                      rel="tooltip"
                                                      ng-click="refreshGrid()"
                                                      data-original-title="{{getOperator(column.attribute).tooltip}}">{{getSearchIcon(column.attribute)}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </ng-switch>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>

                <tr ng-repeat="dm in datamap" style="cursor: pointer" listtablerendered rel="hideRow" bindonce
                    ng-style="{'cursor':cursortype()}">
                    <td ng-show="schema.properties['list.selectionstyle'] == 'multiple'" style="text-align: center;">
                        <!--Multiselect-->
                        <!-- TODO: Move style to css -->
                        <input type="checkbox"
                               ng-model="dm.fields['_#selected']">
                    </td>
                    <td ng-show="compositionlistschema.properties['list.selectionstyle'] == 'single'">
                        <!--Singleselect-->
                    </td>

                    <td ng-repeat="column in schema.displayables" bo-show="!isFieldHidden(schema,column)" class="xoupscolumns" ng-click="showDetail(dm,column)"
                        ng-style="{'min-width': column.rendererParameters['minwidth'],
                                'max-width': column.rendererParameters['maxwidth'],
                                'width': column.rendererParameters['width']}">
                        <ng-switch on="column.rendererType">
                            <div ng-switch-when="checkbox">
                                <input type="checkbox"
                                       class="check"
                                       name="column.attribute"
                                       value="{{option.value}}"
                                       ng-click="toogleCheckboxSelection(option,column.associationKey,dm)"
                                       ng-model="dm.fields['checked']"
                                       ng-init="dm.fields['checked']=false" />
                            </div>
                        </ng-switch>
                        <ng-switch on="column.type">
                            <div ng-switch-when="ApplicationFieldDefinition">

                                <ng-switch on="column.rendererType">
                                    <div ng-switch-when="color" class="statuscolumncolor"
                                         bo-style="{'background-color':statusColor(dm.fields[column.rendererParameters['column']] || 'null',null)}">
                                    </div>
                                    <div ng-switch-when="icon">
                                        <i class="fa" ng-class="loadIcon(dm.fields[column.attribute],column)"
                                           rel="tooltip" data-original-title="{{column.toolTip}}"></i>
                                    </div>
                                    <div ng-switch-when="datetime">
                                        <div ng-if="isColumnEditable(column)" class="input-group" data-datepicker="true">
                                            <input type="text" ng-model="dm.fields[column.attribute]"
                                                   data-date-time
                                                   data-show-time="{{column.rendererParameters['showtime']}}"
                                                   data-show-date="{{column.rendererParameters['showdate']}}"
                                                   data-date-format="{{column.rendererParameters['format']}}"
                                                   data-show-meridian="{{column.rendererParameters['showmeridian']}}"
                                                   data-allow-past="{{column.rendererParameters['allowpast']}}"
                                                   data-allow-future="{{column.rendererParameters['allowfuture']}}"
                                                   class="form-control">
                                            <span class="input-group-addon" data-calendericon="true" rel="tooltip"
                                                  data-original-title="{{i18N('calendar.date_tooltip','Open the calendar popup')}}" style="cursor: pointer;">
                                                <i class="datetime-class"></i>
                                            </span>
                                        </div>
                                        <div ng-if="!isColumnEditable(column)">
                                            {{getFormattedValue(dm.fields[column.attribute],column)}}
                                        </div>
                                    </div>

                                    <!--<div ng-switch-default style="color: black; word-break:break-word; padding-left:8px; word-wrap: break-word;">-->
                                    <div ng-switch-default style="color: black; padding-left: 8px;">
                                        <div ng-if="isColumnEditable(column)" class="input-group" data-datepicker="true">
                                            <input type="text"
                                                   ng-model="dm[column.attribute]" class="hidden-phone form-control"
                                                   data-ng-maxlength="{{column.rendererParameters['maxlength']}}"
                                                   maxlength="{{column.rendererParameters['maxlength']}}" />
                                        </div>
                                        <div ng-if="!isColumnEditable(column)">
                                            {{getFormattedValue(dm.fields[column.attribute],column)}}
                                        </div>
                                    </div>
                                </ng-switch>


                            </div>

                            <div ng-switch-when="OptionField">
                                <div ng-if="column.rendererParameters['filteronly']=='true'">
                                    {{getFormattedValue(dm.fields[column.attribute],column)}}
                                </div>

                                <div ng-switch on="column.rendererType" ng-if="column.rendererParameters['filteronly']!='true'">
                                    <div ng-switch-when="combo" class="sw-combobox-container">
                                        <select class="hidden-phone form-control combobox"
                                                ng-init="handleDefaultValue(dm.fields,column)"
                                                ng-model="dm.fields[column.target]"
                                                ng-options="option.value as i18NOptionField(option,column,schema)
                                                for option in GetAssociationOptions(column)" />
                                    </div>
                                </div>
                            </div>

                            <div ng-switch-when="ApplicationSection">
                                <div ng-include="contextPath(column.resourcepath)" href="#" style="width: 100%"></div>
                            </div>

                        </ng-switch>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <p class="text-center" ng-show="datamap.length == 0">
        {{i18N("_grid.filter.noresult","No results match your search criteria")}}
    </p>
    <!--this is exclusive for IBM Demo to indicate the bottom of the page.-->
    <div ng-if="isNotHapagTest()">
        <br />
        <br />
        <div id="affixpagination1" class="hiddenonprint  context clearfix hiddenonprint">
            <gridtoolbar position="gridbottom"
                         schema="schema"
                         pagination-data="paginationData"
                         search-sort="searchSort"
                         search-data="searchData"
                         search-operator="searchOperator"></gridtoolbar>
            <pagination pagination-data="paginationData" renderfn="selectPage(pageNumber,pageSize,printMode)"
                        schema="schema" application-name="{{schema.applicationName}}"
                        search-data="searchData"
                        search-operator="searchOperator" />
        </div>
    </div>

    <div ng-if="isCommand(schema)">
        <commandbar schema="schema" mode="schema.mode" datamap="datamap" />
    </div>
</form>




