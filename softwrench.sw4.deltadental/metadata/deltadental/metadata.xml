<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata" xmlns:f="http://www.controltechnologysolutions.com/filters">
  <templates>
    <!--ServiceRequest-->
    <template path="@servicerequest.xml"/>
    
    <!--WorkOrder-->
    <template path="@workorder.xml"/>
    
    <template path="@person.xml"/>
    <template path="@inventory.xml"/>
    <template path="@invissue.xml"/>
    <template path="@invtransfer.xml"/>

    <template path="@tooltrans.xml"/>
    <template path="@materials.xml"/>
    <template path="@labtrans.xml"/>
    <template path="@woactivity.xml"/>
    <template path="@solution.xml"/>
  </templates>

  <entities>
    <entity name="person" idAttribute="personid">
      <attributes>
        <attribute name="personid" type="varchar" required="true" />
        <attribute name="status" type="varchar" required="true" />
        <attribute name="displayname" type="varchar" required="false" />
        <attribute name="firstname" type="varchar" required="false" />
        <attribute name="lastname" type="varchar" required="false" />
        <attribute name="department" type="varchar" required="false" />
        <attribute name="title" type="varchar" required="false" />
        <attribute name="employeetype" type="varchar" required="false" />
        <attribute name="jobcode" type="varchar" required="false" />
        <attribute name="supervisor" type="varchar" required="false" />
        <attribute name="birthdate" type="datetime" required="false" />
        <attribute name="lastevaldate" type="datetime" required="false" />
        <attribute name="nextevaldate" type="datetime" required="false" />
        <attribute name="hiredate" type="datetime" required="false" />
        <attribute name="terminationdate" type="datetime" required="false" />
        <attribute name="location" type="varchar" required="false" />
        <attribute name="locationsite" type="varchar" required="false" />
        <attribute name="locationorg" type="varchar" required="false" />
        <attribute name="shiptoaddress" type="varchar" required="false" />
        <attribute name="billtoaddress" type="varchar" required="false" />
        <attribute name="droppoint" type="varchar" required="false" />
        <attribute name="wfmailelection" type="varchar" required="false" />
        <attribute name="transemailelection" type="varchar" required="true" />
        <attribute name="delegate" type="varchar" required="false" />
        <attribute name="delegatefromdate" type="datetime" required="false" />
        <attribute name="delegatetodate" type="datetime" required="false" />
        <attribute name="pcardnum" type="varchar" required="false" />
        <attribute name="pcardtype" type="varchar" required="false" />
        <attribute name="pcardexpdate" type="varchar" required="false" />
        <attribute name="pcardverification" type="varchar" required="false" />
        <attribute name="addressline1" type="varchar" required="false" />
        <attribute name="addressline2" type="varchar" required="false" />
        <attribute name="addressline3" type="varchar" required="false" />
        <attribute name="city" type="varchar" required="false" />
        <attribute name="regiondistrict" type="varchar" required="false" />
        <attribute name="county" type="varchar" required="false" />
        <attribute name="stateprovince" type="varchar" required="false" />
        <attribute name="country" type="varchar" required="false" />
        <attribute name="postalcode" type="varchar" required="false" />
        <attribute name="vip" type="int" required="false" />
        <attribute name="statusdate" type="datetime" required="true" />
        <attribute name="acceptingwfmail" type="smallint" required="true" />
        <attribute name="wopriority" type="int" required="false" />
        <attribute name="loctoservreq" type="smallint" required="true" />
        <attribute name="personuid" type="bigint" required="true" />
        <attribute name="langcode" type="varchar" required="true" />
        <attribute name="sendersysid" type="varchar" required="false" />
        <attribute name="sourcesysid" type="varchar" required="false" />
        <attribute name="ownersysid" type="varchar" required="false" />
        <attribute name="externalrefid" type="varchar" required="false" />
        <attribute name="language" type="varchar" required="false" />
        <attribute name="locale" type="varchar" required="false" />
        <attribute name="timezone" type="varchar" required="false" />
        <attribute name="hasld" type="smallint" required="true" />
        <attribute name="primarysms" type="varchar" required="false" />
        <attribute name="ownergroup" type="varchar" required="false" />
        <attribute name="im_id" type="varchar" required="false" />
        <attribute name="caltype" type="varchar" required="false" />
        <attribute name="rowstamp" type="timestamp" required="true" />
        <attribute name="dfltapp" type="varchar" required="false" />
        <attribute name="deviceclass" type="smallint" required="false" />
        <!-- Custom DD fields-->
        <attribute name="altdisplayname" type="varchar"/>
        <attribute name="altemail" type="varchar"/>
        <attribute name="altfirstname" type="varchar"/>
        <attribute name="altlastname" type="varchar"/>
        <attribute name="altphone" type="varchar"/>
        <attribute name="costcenter" type="varchar"/>
        <attribute name="floor" type="varchar"/>
        <!--<attribute name="LOCATION" type="varchar"/>-->
        <attribute name="room" type="varchar"/>
        <attribute name="cubical" type="varchar"/>
      </attributes>
      <relationships>
        <relationship to="maxuser">
          <relationshipAttribute from="personid" to="personid" primary="true"/>
        </relationship>
        <relationship to="email" collection="true">
          <relationshipAttribute from="personid" to="personid" primary="true"/>
        </relationship>
        <relationship to="phone" collection="true">
          <relationshipAttribute from="personid" to="personid" primary="true"/>
        </relationship>
        <relationship to="person" qualifier="altperson">
          <relationshipAttribute from="altdisplayname" to="displayname" primary="true"/>
          <relationshipAttribute from="altfirstname" to="firstname"/>
          <relationshipAttribute from="altlastname" to="lastname"/>
        </relationship>
        <relationship to="floordomain" qualifier="fd">
          <relationshipAttribute from="floor" to="value" primary="true"/>
        </relationship>
        <relationship to="costcenterdomain" qualifier="cc">
          <relationshipAttribute from="costcenter" to="value" primary="true" />
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="dbtable" value="person" />
        <connectorParameter key="integration_interface" value="SWPERSON" />
      </connectorParameters>
    </entity>
    
    <entity name="floordomain" parententity="ALNDOMAIN" idAttribute="alndomainid" whereclause="domainid = 'FLOOR'">
      <attributes>
        <attribute name="domainid" type="varchar" required="true" />
        <attribute name="value" type="varchar" required="true" />
        <attribute name="description" type="varchar" required="false" />
        <attribute name="siteid" type="varchar" required="false" />
        <attribute name="orgid" type="varchar" required="false" />
        <attribute name="alndomainid" type="bigint" required="true" />
        <attribute name="valueid" type="varchar" required="true" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>
      <connectorParameters>
        <connectorParameter key="dbtable" value="ALNDOMAIN" />
      </connectorParameters>
    </entity>
    
    <entity name="costcenterdomain" parententity="ALNDOMAIN" idAttribute="alndomainid" whereclause="domainid = 'COSTCENTER'">
      <attributes>
        <attribute name="domainid" type="varchar" required="true" />
        <attribute name="value" type="varchar" required="true" />
        <attribute name="description" type="varchar" required="false" />
        <attribute name="siteid" type="varchar" required="false" />
        <attribute name="orgid" type="varchar" required="false" />
        <attribute name="alndomainid" type="bigint" required="true" />
        <attribute name="valueid" type="varchar" required="true" />
        <attribute name="rowstamp" type="timestamp" required="true" />
      </attributes>
      <connectorParameters>
        <connectorParameter key="dbtable" value="ALNDOMAIN" />
      </connectorParameters>
    </entity>

    <entity name="workorder" idAttribute="workorderid" useridAttribute="wonum">
      <relationships>
        <relationship to="ALNDOMAIN" qualifier="division">
          <relationshipAttribute from="division" to="value" primary="true"/>
          <relationshipAttribute to="domainid" literal="DIVISION" quoteLiteral="true" />
        </relationship>
        <relationship to="worklog" collection="true">
          <relationshipAttribute from="wonum" to="recordkey" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="class" literal="WORKORDER" quoteLiteral="true" />
        </relationship>
        <relationship to="matusetrans" collection="true">
          <relationshipAttribute from="wonum" to="refwo" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="labtrans" collection="true">
          <relationshipAttribute from="wonum" to="refwo" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="location" >
          <relationshipAttribute from="location" to="location" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="asset" >
          <relationshipAttribute from="assetnum" to="assetnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="failurecode" >
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="worktype" >
          <relationshipAttribute from="worktype" to="worktype" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="glcomponents">
          <relationshipAttribute from="glaccount" to="compvalue" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
          <relationshipAttribute to="glorder" literal="0" quoteLiteral="true"/>
        </relationship>
        <!--COMSW 51 Reverse Lookup of Service Address (Lazy Fetch)-->
        <relationship to="woaddress" reverselookupattribute="addresscode" >
          <relationshipAttribute from="wonum" to="woserviceaddress_.wonum" primary="true"/>
        </relationship>
        <relationship to="woserviceaddress">
          <relationshipAttribute from="wonum" to="wonum" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
          <relationshipAttribute from="siteid" to="siteid"/>
        </relationship>
        <relationship to="longdescription" qualifier="ld">
          <relationshipAttribute from="workorderid" to="ldkey" primary="true"/>
          <relationshipAttribute to="ldownertable" literal="WORKORDER" quoteLiteral="true" />
          <relationshipAttribute to="ldownercol" literal="DESCRIPTION" quoteLiteral="true" />
        </relationship>
        <relationship to="DOCLINKS" qualifier="attachment" collection="true">
          <relationshipAttribute from="workorderid" to="ownerid" primary="true"/>
          <relationshipAttribute to="ownertable" literal="WORKORDER" quoteLiteral="true"/>
        </relationship>
        <relationship to="tooltrans" collection="true">
          <relationshipAttribute from="wonum" to="refwo" primary="true" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
      </relationships>
      <connectorParameters>
        <connectorParameter key="integration_interface" value="SWWO" />
        <connectorParameter key="customconnector" value="softWrench.sW4.Data.Persistence.WS.Applications.Workorder.BaseWorkOrderCrudConnector" />
      </connectorParameters>
    </entity>

    <entity name="labtrans" idAttribute="labtransid">
      <relationships>
        <relationship to="labor">
          <relationshipAttribute from="laborcode" to="laborcode" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
        </relationship>
        <relationship to="laborcraftrate">
          <relationshipAttribute from="craft" to="craft" primary="true"/>
          <relationshipAttribute from="laborcode" to="laborcode"/>
          <relationshipAttribute from="orgid" to="orgid"/>
        </relationship>
        <relationship to="glcomponents">
          <relationshipAttribute from="gldebitacct" to="compvalue" primary="true"/>
          <relationshipAttribute to="glorder" literal="0" quoteLiteral="true"/>
        </relationship>
      </relationships>
    </entity>

    <entity name="matusetrans" idAttribute="matusetransid" >
      <relationships>
        <relationship to="inventory">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="siteid" to="siteid" />
          <relationshipAttribute to="status" literal="ACTIVE"/>
        </relationship>
        <relationship to="item">
          <relationshipAttribute from="itemnum" to="itemnum" primary="true"/>
          <relationshipAttribute from="itemsetid" to="itemsetid"/>
          <relationshipAttribute to="itemtype" literal="ITEM" quoteLiteral="true"/>
          <relationshipAttribute to="status" literal="ACTIVE" quoteLiteral="true"/>
        </relationship>
        <relationship to="location" qualifier="storeroom">
          <relationshipAttribute from="siteid" to="siteid" primary="true" />
          <relationshipAttribute to="type" literal="STOREROOM" quoteLiteral="true" />
        </relationship>
        <relationship to="invbalances" qualifier="invbal" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="location" to="location" />
          <relationshipAttribute from="siteid" to="siteid" />
        </relationship>
        <relationship to="glcomponents">
          <relationshipAttribute from="gldebitacct" to="compvalue" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
          <relationshipAttribute to="glorder" literal="0" quoteLiteral="true"/>
        </relationship>
      </relationships>
    </entity>

    <entity name="tooltrans" idAttribute="tooltransid">
      <relationships>
        <relationship to="toolitem" qualifier="tool" >
          <relationshipAttribute from="itemnum" to="itemnum" primary="true" />
          <relationshipAttribute from="itemsetid" to="itemsetid" />
        </relationship>
        <relationship to="glcomponents">
          <relationshipAttribute from="gldebitacct" to="compvalue" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid" />
          <relationshipAttribute to="glorder" literal="0" quoteLiteral="true"/>
        </relationship>
      </relationships>
    </entity>
  </entities>

  <applications>
    <application entity="SR" name="quickservicerequest" title="Quick Requests" role="ssr">

      <!-- added back as per customer request
      <filters>
        <filter attribute="ownerperson_.displayname" remove="true"/>
        <filter attribute="reportedbyp_.displayname" remove="true"/>
      </filters>
      -->
      <filters>
        <optionfilter attribute="ownerperson_.displayname" provider="ownerperson_.displayname" allowblank="true" whereclause="!@owner in (!@#value)">
          <f:option label="Current User" value="@username"/>
        </optionfilter>
        <optionfilter attribute="reportedbyp_.displayname" provider="reportedbyp_.displayname" allowblank="true" whereclause="!@reportedby in (!@#value)">
          <f:option label="Current User" value="@username"/>
        </optionfilter>
      </filters>
      
      <schemas>
        <schema id="quicksrgrid" title="Quick Request Grid" stereotype="list" redeclaring="false">
          <customization position="reportedby">
            <field attribute="reportedby" hidden="true" label="Reported By"/>
            <field attribute="reportedbyp_.displayname" label="Reported By">
              <renderer type="default" params="width=15%" />
            </field>
          </customization>
          <customization position="owner">
            <field attribute="owner" hidden="true" label="Owner"/>
            <field attribute="ownerperson_.displayname" label="Owner">
              <renderer type="default" params="width=15%" />
            </field>
          </customization>
        </schema>
        <schema id="quickeditdetail" platform="web" redeclaring="false">
          <properties>
            <property key="detail.showtitle" value="true"/>
          </properties>
        </schema>
        
      </schemas>
    </application>
    <!--Request complete custom layout for service request.  Please review before making customization-->
    <application entity="SR" name="servicerequest" title="Service Request">
      <properties>
        <property key="crud.disableautofocus" value="true"/>
      </properties>
      <!-- added back as per customer request
      <filters>
        <filter attribute="ownerperson_.displayname" remove="true"/>
        <filter attribute="reportedbyp_.displayname" remove="true"/>
      </filters>
      -->
      <filters>
        <optionfilter attribute="ownerperson_.displayname" provider="ownerperson_.displayname" allowblank="true" whereclause="!@owner in (!@#value)">
          <f:option label="Current User" value="@username"/>
        </optionfilter>
        <optionfilter attribute="reportedbyp_.displayname" provider="reportedbyp_.displayname" allowblank="true" whereclause="!@reportedby in (!@#value)">
          <f:option label="Current User" value="@username"/>
        </optionfilter>
      </filters>
      
      
      <schemas>
        <list title="Service Request Grid" redeclaring="false">
          <customization position="reportedby">
            <field attribute="reportedby" hidden="true" label="Reported By"/>
            <field attribute="reportedbyp_.displayname" label="Reported By">
              <renderer type="default" params="width=15%" />
            </field>
          </customization>
          <customization position="owner">
            <field attribute="owner" hidden="true" label="Owner Hidden"/>
            <field attribute="ownerperson_.displayname" label="Owner">
              <renderer type="default" params="width=15%" />
            </field>
          </customization>
        </list>
        
        <schema id="adetail" title="Request Details" abstract="true" stereotype="detail">
          <properties>
            <property key="detail.showtitle" value="true"/>
          </properties>
          <section orientation="vertical">
            <header displacement="ontop" label="Service Request Details" params="fieldset=true" />
            <section orientation="horizontal">
              <field attribute="description" label="Summary:" requiredexpression="true">
                <!--<renderer type="default" params="maxlength=100;inputsize=medium" />-->
              </field>
              <section id="siteidsection"/>
              <section id="statussection">
                <association label="Status:" target="status" labelfield="synstatus.description" requiredexpression="true">
                  <renderer type="lookup" />
                  <event type="afterchange" service="srService" method="onStatusChanged"/>
                </association>
              </section>
            </section>

            <field label="Details:" attribute="ld_.ldtext">
              <renderer type="richtext"/>
            </field>

          </section>

          <section orientation="horizontal">
            <renderer type="default" params="childinputsize=medium" />
            
            <!--<section id ="siteidsection"/>-->

            <field attribute="ticketuid" label="SR#$" hidden="true"/>
            <field attribute="class" label="" hidden="true"/>
            <field attribute="actlabcost" hidden="true" />
            <field attribute="actlabhrs" hidden="true"/>
            <field attribute="siteid" hidden="true" />
            <field attribute="orgid" hidden="true"/>
            <field attribute="createby" hidden="true"/>

            <association label="Location:" target="location" labelfield="location_.description">
              <event type="beforechange" service="srService" method="beforeChangeLocation"/>
              <renderer type="lookup"/>
            </association>
            <association label="Asset:" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location" showexpression="1!=1">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="srService" method="afterChangeAsset"/>
            </association>
            
            <optionfield attribute="classstructureid" label="Request Code:" dependantfields="siteid" providerattribute="_SRClassStructureType">
              <renderer type="autocompleteclient" />
            </optionfield>
          
          </section>
          
          <field attribute="changeby" default="@username" hidden="true"/>

          <section orientation="vertical" secondarycontent="true">


            <section orientation="horizontal">
              <header displacement="ontop" label="Responsibility" params="fieldset=true" />
              <!--<renderer type="default" params="childinputsize=medium" />-->


              <!-- owner -->
              <section orientation="vertical">
                <association label="Owner:"  target="owner" labelfield="ownerperson_.displayname" enableexpression="@ownergroup==null" orderbyfield="person.personid asc">
                  <renderer type="lookup"/>
                  <event type="afterchange" service="srService" method="afterchangeowner"/>
                </association>
                <association label="Owner Group:" target="ownergroup" labelfield="persongroup_.description" enableexpression="@owner==null" orderbyfield="persongroup asc">
                  <renderer type="lookup"/>
                  <event type="afterchange" service="srService" method="afterchangeownergroup"/>
                </association>
                <field label="Reported Date &amp; Time:" attribute="reportdate" readonly="true" default="@currentdatetime">
                  <renderer type="datetime" params="format=MM/dd/yyyy HH:mm"/>
                </field>
              </section>

              <!-- reportedby -->
              <section orientation="vertical">
                <association label="Reported By:" target="reportedby" labelfield="reportedbyp_.displayname" default="@username" orderbyfield="person.personid asc" extraprojectionvalues="email_.emailaddress,phone_.phonenum,altdisplayname,altphone,altemail,displayname" enableexpression="true" showexpression="true">
                  <renderer type="lookup" params="columnlabel=Name;"/>
                </association>
                <field attribute="reportedbyp_.email_.emailaddress" label="Reported By Email:" readonly="true" attributeToServer="reportedemail" />
                <field attribute="reportedbyp_.phone_.phonenum" label="Reported By Phone:" readonly="true" attributeToServer="reportedphone"/>
              </section>

              <!-- reportedby.alt -->
              <section orientation="vertical">
                <field attribute="reportedbyp_.altdisplayname" label="Alt Contact Name:" readonly="true"/>
                <field attribute="reportedbyp_.altemail" label="Alt Contact Email:" readonly="true"/>
                <field attribute="reportedbyp_.altphone" label="Alt Contact Phone:" readonly="true"/>
              </section>

              <!-- affected -->
              <section orientation="vertical">
                <association label="Affected Person:" target="affectedperson" labelfield="person_.displayname" default="@username" orderbyfield="person.personid asc" extraprojectionvalues="phone_.phonenum,email_.emailaddress">
                  <renderer type="lookup" params="columnlabel=Name"/>
                </association>
                <field attribute="person_.email_.emailaddress" label="Affected Person Email:" readonly="true" attributeToServer="affectedemail"/>
                <field attribute="person_.phone_.phonenum" label="Affected Person Phone:" readonly="true" attributeToServer="affectedphone"/>
              </section>

            </section>

            <section orientation="horizontal">
              <header displacement="ontop" label="Scheduling" params="fieldset=true" />

              <section orientation="vertical">
                <field attribute="targetstart" label="Target Start Date:" >
                  <renderer type="datetime" params="format=MM/dd/yyyy"/>
                </field>
                <field attribute="targetfinish" label="Target Finish Date:">
                  <renderer type="datetime" params="format=MM/dd/yyyy"/>
                </field>
              </section>

              <section orientation="vertical">
                <field attribute="actualstart" label="Actual Start Date:">
                  <renderer type="datetime" params="format=MM/dd/yyyy"/>
                </field>
                <field attribute="actualfinish" label="Actual Finish Date:">
                  <renderer type="datetime" params="format=MM/dd/yyyy"/>
                </field>
              </section>

            </section>

            <section orientation="horizontal">
              <header displacement="ontop" label="Miscellaneous" params="fieldset=true" />
              <!--<renderer type="default" params="childinputsize=medium" />-->
              <section id="attachmentsection" />
              <!--</section>-->

              <!--COMSW 24 required field for population purposes-->
              <field attribute="sraddress_.description" attributeToServer="#tkdesc" hidden="true" />
              <field attribute="sraddress_.staddrnumber" attributeToServer="#tkstaddrnumber" hidden="true" />
              <field attribute="sraddress_.staddrstreet" attributeToServer="#tkstaddrstreet" hidden="true" />
              <field attribute="sraddress_.staddrsttype" attributeToServer="#tkstaddrsttype" hidden="true" />
              <field attribute="sraddress_.formattedaddress" attributeToServer="#tkformattedaddress" hidden="true" />
              <!--COMSW 24 association field used for lazy lookup-->
              <association label="Service Address" target="saddresscode" labelfield="sraddress_.description" extraprojectionvalues="description, staddrnumber, staddrstreet, staddrsttype, formattedaddress" showexpression="false">
                <renderer type="lookup" />
              </association>
            </section>

            <section id="compositions"/>

          </section>
        
        </schema>
      
        <schema id="newdetail" parentschema="adetail" title="New Service Request" stereotype="detailnew" >
          <section id="siteidsection">
            <field attribute="ticketid" label="Request #:" hidden="true"/>
            <association target="siteid" label="Site:" labelfield="site_.description" default="SF" requiredexpression="true">
              <renderer type="lookup"/>
            </association>
          </section>
          <section id="statussection">
            <field label="Status:" attribute="status" readonly="true" default="NEW" hidden="true"/>
          </section>
          <!--SSWEB 173-->
          <section id="attachmentsection">
            <field label="Attachment:" attribute="newattachment" >
              <renderer type="upload" params="class=col-md-6" />
            </field>
          </section>
        </schema>

        <schema id="editdetail" parentschema="adetail"  title="Service Request Details">
          <section id="siteidsection">
            <field attribute="ticketid" label="Request #:" hidden="true"/>
            <association target="siteid" label="Site:" labelfield="site_.description" requiredexpression="true">
              <renderer type="lookup"/>
            </association>
          </section>
          <section id="statussection">
          <association label="Status:" target="status" labelfield="synstatus.description" requiredexpression="true">
              <renderer type="lookup" />
              <event type="afterchange" service="srService" method="onStatusChanged"/>
            </association>
          </section>

          <section id="compositions">
            <composition relationship="worklog" label="Work Logs">
              <collectionproperties allowcreation="@status!='CLOSED'" allowupdate="true" orderbyfield="modifydate desc"/>
            </composition>

            <composition relationship="commlog" label="Communications">
              <collectionproperties allowcreation="@status!='CLOSED'" allowupdate="false" orderbyfield="createdate desc"/>
              <event type="onviewdetail" service="commlogService" method="updatereadflag"/>
            </composition>

            <composition relationship="attachment" label="Attachments" printenabled="false">
              <collectionproperties allowcreation="@status!='CLOSED'" allowupdate="false" prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
              
            </composition>
            <composition relationship="relatedrecord" label="Related Records">
              <collectionproperties allowcreation="false" />
            </composition>
          </section>
          <event type="beforesubmit.prevalidation" service="genericTicketService" method="validateCloseStatus"/>
          <commandbars>
            <commandgroup position="actions">
              <container label="Actions" id="actioncontainer" icon="fa-bolt">
                <command id ="dispatchwo" icon="fa-tachometer" label="Dispatch Work Order"
                          parameters="schema,datamap" service="dispatchService" method="dispatchWO"/>
              </container>
            </commandgroup>
<!--            <commandgroup position="detailform">-->
<!--              <command id="crud_delete" label="Delete" service="crudextraService" method="deletefn" parameters="schema,datamap"-->
<!--                       showexpression="@status=='NEW' &amp;&amp; @reportedby==@username" successmessage="SR deleted" position="left"/>-->
<!--            </commandgroup>-->
          </commandbars>
        </schema>
      </schemas>
    </application>
    
    <application name="workorder" title="Work Order" entity="workorder">
      <properties>
        <property key="crud.disableautofocus" value="true"/>
      </properties>
      <filters>
        <optionfilter attribute="ownerperson_.displayname" provider="ownerperson_.displayname" allowblank="true" whereclause="!@owner in (!@#value)">
          <f:option label="Current User" value="@username"/>
        </optionfilter>
      </filters>
      <schemas>
        <list title="Work Order Grid" platform="web" redeclaring="false">

          <customization position="asset_.description">
            <field attribute="ownerperson_.displayname" label="Owner">
              <renderer type="default" params="width=25%" />
            </field>
          </customization>
          <properties>
            <property key="list.click.schema" value="editdetail"/>
            <property key="list.defaultorderby" value="workorder.statusdate desc"/>
            <!--<property key="list.click.mode" value="@status == 'CLOSE' ? 'output' : 'input'"/>-->
          </properties>
        </list>
        
        <schema id="editdetail" platform="web" redeclaring="false">
          <properties>
            <property key="detail.showtitle" value="true"/>
          </properties>
          <customization position="matusetrans"/>
          <customization position="labtrans"/>
          <customization position="tooltrans"/>
          <customization position="classstructureid">
            <optionfield attribute="classstructureid" label="Request Code:" dependantfields="siteid" providerattribute="_WOClassStructureType" requiredexpression="true">
              <renderer type="autocompleteclient" />
            </optionfield>
          </customization>
          <customization position="glaccount">
            <association label="GL Account:" target="glaccount" labelfield="glcomponents_.comptext">
              <renderer type="lookup"/>
            </association>
          </customization>
          <customization position="failurecode">
            <association label="Failure Code:" target="failurecode" labelfield="failurelist_.description" extraprojectionvalues="failurelist" orderbyfield="failurecode asc">
              <renderer type="lookup" />
            </association>
          </customization>
          <customization position="assetnum"/>
          <customization position="problemcode"/>
          <customization position="siteid">
            <association label="Site:" target="siteid" labelfield="site_.description" requiredexpression="true" hideDescription="true">
              <renderer type="lookup" />
            </association>
            <field label="Site:" attribute="siteid" readonly="true" hidden="true">
              <renderer type="default" />
            </field>
          </customization>
          <customization position="status">
            <association label="Status:" target="status" hideDescription="true" labelfield="synstatus.description">
              <dataprovider prefilterfunction="FilterStatusCodes"/>
              <renderer type="lookup" params="avoidautofocus=true"/>
              <event type="afterchange" method="onStatusChanged" service="workorderService"/>
            </association>
          </customization>
        </schema>
        
        <schema id="newdetail" platform="web" redeclaring="false" stereotype="detailnew">
          <customization position="classstructureid">
            <optionfield attribute="classstructureid" label="Request Code:" dependantfields="siteid" providerattribute="_WOClassStructureType" requiredexpression="true">
              <renderer type="autocompleteclient" />
            </optionfield>
          </customization>
          <customization position="glaccount">
            <association label="GL Account:" target="glaccount" labelfield="glcomponents_.comptext">
              <renderer type="lookup"/>
            </association>
          </customization>
          <customization position="failurecode">
            <association label="Failure Code:" target="failurecode" labelfield="failurelist_.description" extraprojectionvalues="failurelist" orderbyfield="failurecode asc">
              <renderer type="lookup" />
            </association>
          </customization>
          <customization position="problemcode"/>
        </schema>
      </schemas>
    </application>

    <application name="labtrans" entity="labtrans" title="Labor">
      <schemas>
        <list>
          <field attribute="labtransid" hidden="true"/>
          <field attribute="laborcode" label="Labor" qualifier="title"/>
          <field attribute="regularhrs" label="Regular Hours" qualifier="subtitle"/>
          <field attribute="gldebitacct" label="GL Debit Account" qualifier="subtitle"/>
        </list>

        <detail platform="web">
          <field attribute="labtransid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
          <field attribute="siteid" hidden="true"/>
          <field attribute="laborcode" hidden="true" />
          <field attribute="transtype" hidden="true" />
          <field attribute="refwo" hidden="true" />
          <field attribute="enterby" hidden="true" />
          <field attribute="laborcraftrate_.rate" hidden="true" attributeToServer="payrate"/>
          <field attribute="transtype" default="WORK" hidden="true"/>
          <field attribute="labor_.worksite" hidden="true" />
          <field attribute="labor_.orgid" hidden="true" />
          <association label="Labor:" requiredexpression="true" target="laborcode" labelfield="labor_.laborcode" defaultexpression="ctx:getUserData().login.toUpperCase()" extraprojectionvalues="worksite, orgid">
            <renderer type="lookup"/>
            <event type="afterchange" service="labtranService" method="afterlaborchange"/>
          </association>
          <association label="Craft:" requiredexpression="true" target="craft" labelfield="laborcraftrate_.craft" dependantfields="laborcode" extraprojectionvalues="defaultcraft, rate">
            <event type="afterchange" service="labtranService" method="aftercraftchange"/>
          </association>
          <field label="Start Date:" requiredexpression="true" attribute="startdate" default="@currentdatetime">
            <renderer type="datetime" params="format=MM/dd/yyyy;showtime=false;allowfuture=false" />
          </field>
          <field attribute="regularhrs" label="Regular Hours:" requiredexpression="true" default="8"/>
          <association label="GL Debit Account:" requiredexpression="true" target="gldebitacct" labelfield="glcomponents_.comptext">
            <renderer type="lookup"/>
          </association>
        </detail>
      </schemas>
    </application>

    <application name="tooltrans" entity="tooltrans" title="Tools">
      <schemas>
        <detail platform="web" redeclaring="false">
          <customization position="gldebitacct">
            <association label="GL Debit Account:"  target="gldebitacct" labelfield="glcomponents_.comptext">
              <renderer type="lookup"/>
            </association>
          </customization>
        </detail>
      </schemas>
    </application>

    <application name="worklog" title="Work Logs"  entity="worklog" id="00000000-0000-0000-0000-000000000008">
      <schemas>
        <detail platform="web" redeclaring="false">
          <customization position="logtype">
            <optionfield attribute="logtype" label="Log Type:" default="CLIENTNOTE" requiredexpression="true">
              <option label="Appointment Note" value="APPTNOTE"/>
              <option label="Client Note" value="CLIENTNOTE"/>
              <option label="Update" value="UPDATE"/>
              <option label="Work" value="WORK"/>
            </optionfield>
          </customization>
          <customization position="clientviewable">
            <optionfield attribute="clientviewable" label="Client Viewable:" default="0" requiredexpression="true">
              <option label="Yes" value="1"/>
              <option label="No" value="0"/>
            </optionfield>
          </customization>
        </detail>
      </schemas>
    </application>

    <application name="person" title="Person" entity="person">
      <schemas>
        <schema id="personlookup" stereotype="list" title="Person Lookup">
          <field attribute="displayname" label="Display Name"/>
          <field attribute="firstname" label="First Name"/>
          <field attribute="lastname" label="Last Name"/>
        </schema>
        <schema id="detail" stereotype="detail" title="Person Detail" redeclaring="false">
          <customization position="department">
            <field attribute="costcenter" hidden="true"/>
            <association target="costcenter" labelfield="cc_.description" label="Cost Center">
              <renderer type="lookup"/>
            </association>
          </customization>
          <customization position="+location">
            <field attribute="floor" hidden="true"/>
            <association target="floor" labelfield="fd_.description" label="Floor">
              <renderer type="lookup"/>
            </association>
            <field attribute="room" label="Room"/>
            <field attribute="cubicle" label="Cubicle"/>
          </customization>
          <customization position="+langcode">
            <field attribute="altdisplayname" hidden="true"/>
            <association target="altdisplayname" labelfield="altperson_.displayname" hideDescription="true" label="Alt Contact Dispaly Name" extraprojectionvalues="displayname,firstname,lastname,phone_.phonenum,email_.emailaddress">
              <renderer type="lookup" params="application=person;schemaId=personlookup;"/>
              <event service="deltadental_.personService" method="afterChangeAltDisplayname" type="afterchange"/>
            </association>
            <field attribute="altfirstname" label="Alt Contact First Name" readonly="true"/>
            <field attribute="altlastname" label="Alt Contact Last Name" readonly="true"/>
            <field attribute="altphone" label="Alt Contact Phone" readonly="true"/>
            <field attribute="altemail" label="Alt Contact Email" readonly="true"/>
          </customization>
        </schema>

        <schema id="newPersonDetail" stereotype="detail" title="New User" mode="input" redeclaring="false">
          <customization position="department">
            <field attribute="costcenter" hidden="true"/>
            <association target="costcenter" labelfield="cc_.description" label="Cost Center">
              <renderer type="lookup"/>
            </association>
          </customization>
          <customization position="+location">
            <field attribute="floor" hidden="true"/>
            <association target="floor" labelfield="fd_.description" label="Floor">
              <renderer type="lookup"/>
            </association>
            <field attribute="room" label="Room"/>
            <field attribute="cubicle" label="Cubicle"/>
          </customization>
          <customization position="+langcode">
            <field attribute="altdisplayname" hidden="true"/>
            <association target="altdisplayname" labelfield="altperson_.displayname" hideDescription="true" label="Alt Contact Dispaly Name" extraprojectionvalues="displayname,firstname,lastname,phone_.phonenum,email_.emailaddress">
              <renderer type="lookup" params="application=person;schemaId=personlookup;"/>
              <event service="deltadental_.personService" method="afterChangeAltDisplayname" type="afterchange"/>
            </association>
            <field attribute="altfirstname" label="Alt Contact First Name" readonly="true"/>
            <field attribute="altlastname" label="Alt Contact Last Name" readonly="true"/>
            <field attribute="altphone" label="Alt Contact Phone" readonly="true"/>
            <field attribute="altemail" label="Alt Contact Email" readonly="true"/>
          </customization>
        </schema>
      </schemas>
    </application>

  </applications>
</metadata>
