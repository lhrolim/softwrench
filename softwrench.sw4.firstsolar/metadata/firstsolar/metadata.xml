<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@person.xml"/>
    <template path="@workorder.xml"/>
    <template path="@location.xml"/>
  </templates>



  <applications>
    <application name="workorder" title="Work Order" entity="workorder" role="workorders">
      <schemas>
        <list redeclaring="false">
          <filters>
            <optionfilter attribute="location" provider="location_.location" displaycode="false" advancedfilterschema="location.locationfilter" allowblank="true"/>
          </filters>
        </list>
        <schema id="batchshared" title="Workoder Common Fields" stereotype="detail.modal">
          <field attribute="summary" label="Summary:" requiredexpression="true"/>
          <field attribute="details" label="Details:" requiredexpression="true">
            <renderer type="textarea"/>
          </field>
          <association label="Site" target="siteid" labelfield="site_.description"
                       requiredexpression="true" hideDescription="true" defaultexpression="@user.site">
            <renderer type="lookup" />
          </association>
        </schema>

        <schema id="batchLocationSpreadSheet" title="Workorder Creation" stereotype="list.selection.spreadsheet">
          <field attribute="location" hidden="true"/>
          <field attribute="workorderid" hidden="true"/>
          <field attribute="#warning" tooltip="This location already contains a workorder">
            <renderer type="icon" params="expression={'true':'fa-warning','false':''};width=10%"/>
          </field>
          <field attribute="location_label" label="Location"/>
          <field attribute="summary" label="Summary:" requiredexpression="true">
            <renderer type="default" params="updatable=true"  />
          </field>
          <field attribute="details" label="Details:" requiredexpression="true">
            <renderer type="textarea" params="updatable=true"/>
          </field>
          <association label="Site" target="siteid" labelfield="site_.description"
                       requiredexpression="true" hideDescription="true" defaultexpression="@user.site">
            <renderer type="lookup" />
          </association>

          <commandbars>
            <commandgroup id="#spreadsheet">
              <!--TODO: review framework to eventually avoid the need for these commands later-->
              <command id="cancel" service="redirectService" method="goToApplication" parameters="location,list"/>
            </commandgroup>
          </commandbars>

        </schema>


      </schemas>
    </application>

    <application name="location" title="Location" entity="location" >
      <schemas>
        <schema id="locationfilter" stereotype="list.selection.modal.filter">
          <field attribute="location" label="Location"/>
          <field attribute="description" label="Description"/>
          <field attribute="classstructure_.description" label="Class Structure"/>
          <field attribute="parentlocation_.parent" label="Parent Location"/>
          <field attribute="siteid" label="Site"/>
        </schema>
        <schema id="list"  redeclaring="false" stereotype="list.selection">
          <properties>
            <property key="list.selectionmodebydefault" value="true" />
          </properties>
          <commandbars>
            <commandgroup position="actions">
              <container label="Actions" id="actioncontainer" icon="fa-bolt">
                <command id="Create" icon="fa-tachometer" label="Create Workorders"
                         service="locationService" method="initBatchWorkorder"
                         parameters="schema,datamap" />
              </container>
            </commandgroup>
          </commandbars>
        </schema>
      </schemas>
    </application>
  </applications>

</metadata>