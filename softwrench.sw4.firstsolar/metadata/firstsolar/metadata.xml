<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="@person.xml"/>
    <template path="@workorder.xml"/>
    <template path="@location.xml"/>
    <template path="@workflow.xml"/>
    <template path="@relatedrecords.xml"/>
  </templates>

  <entities>
    <entity name="asset" idAttribute="assetid">
      <attributes>
        <attribute name="openwo" query="(select count(1) from workorder where UPPER(workorder.status) not in ('CAN', 'COMP', 'CLOSE') and workorder.assetnum = !@assetnum and workorder.siteid = !@siteid and workorder.orgid = !@orgid)" type="int"/>
      </attributes>
    </entity>

    <entity name="workorder" idAttribute="workorderid">
      <attributes>
        <attribute name="schedstartnotime" query="DATEADD(dd, DATEDIFF(dd, 0, workorder.schedstart), 0)" type="date"/>
        <attribute name="schedfinishnotime" query="DATEADD(dd, DATEDIFF(dd, 0, workorder.schedfinish), 0)" type="date"/>
      </attributes>
      <relationships>
        
        <relationship to="numericdomain" qualifier="realpriority" collection="true">
          <relationshipAttribute from="wopriority" to="value" primary="true"/>
          <relationshipAttribute to ="domainid" literal="WOPRIORITY" quoteLiteral="true"/>
        </relationship>


        <relationship to="problemlist" qualifier="offlineproblemlist">
          <relationshipAttribute from="problemcode" to="failurecode" primary="true"/>
          <relationshipAttribute from="failurelistonly_.failurelist" to="parent"/>
        </relationship>

        <relationship to="causelist" qualifier="offlinecauselist">
          <relationshipAttribute from="fr1code" to="failurecode" primary="true"/>
          <relationshipAttribute from="problemlist_.failurelist" to="parent" />
        </relationship>
        
        <relationship to="remedylist" qualifier="offlineremedylist">
          <relationshipAttribute from="fr2code" to="failurecode" primary="true"/>
          <relationshipAttribute from="offlinecauselist_.failurelist" to="parent" />
        </relationship>

        <relationship to="failurelistonly" qualifier="failurelistonly">
          <relationshipAttribute from="failurecode" to="failurecode" primary="true"/>
        </relationship>
        
      </relationships>
    </entity>
  </entities>

  <applications>
    <application name="workorder" title="Work Order" entity="workorder" role="workorders">

      <components>
        <componentdisplayable id="offlineworktypes">
          <optionfield attribute="worktype" requiredexpression="false" label="Work Type">
            <option value="AD" label="Administrative" extraprojections="type=PM"/>
            <option value="CC" label="Construction and Commissioning" extraprojections="type=CM"/>
            <option value="INSP" label="Inspection" extraprojections="type=PM"/>
            <option value="PM" label="Preventative Maintenance" extraprojections="type=PM"/>
            <option value="SR" label="Safety / Environmental Work " extraprojections="type=PM"/>
            <option value="TRAIN" label="Training" extraprojections="type=PM"/>
            <option value="TRAVL" label="Travel" extraprojections="type=PM"/>
            <option value="TRBLS" label="Troubleshoot" extraprojections="type=CM"/>
            <option value="WO" label="General Work Order" extraprojections="type=CM"/>
          </optionfield>
        </componentdisplayable>
      </components>


      <schemas>


        <list redeclaring="false" platform="web">
          <filters>
            <optionfilter attribute="status" provider="synstatus_.description" displaycode="true" style="width:300px">
              <option xmlns="http://www.controltechnologysolutions.com/filters" label="Active" value="INPRG,APPR,WOEN,ENRV,HOLD,WAPPR" preselected="true" displaycode="false" tooltip="The status of active work orders. Matchs any work order of &quot;INPRG&quot;, &quot;APPR&quot;, &quot;WOEN&quot;, &quot;ENRV&quot;, &quot;HOLD&quot; or &quot;WAPPR&quot; status."/>
            </optionfilter>
            <optionfilter attribute="location" provider="@firstSolarPCSLocationHandler.HandlePCSLocationProvider" displaycode="false"
                          advancedfilterschema="location.locationfilter" allowblank="true" whereclause="@firstSolarPCSLocationHandler.HandlePCSLocation"/>
            <optionfilter attribute="classstructure_.description" provider="classstructure_.description" allowblank="true" whereclause="classstructure_.classstructureid in (!@#value)"/>
            <!--<optionfilter attribute="classstructure_.classificationid" provider="@GetWOClassStructureType" allowblank="true"/>-->
          </filters>


          <customization position="+description">
            <field attribute="classstructure_.description" label="Origination"></field>
          </customization>

          <properties>
            <property key="search.schemaid" value="search"/>
            <property key="list.noresultspreaction" value="advancedSearchService.woNoResultsPreAction"/>
          </properties>
        </list>

        <schema id="adetail" redeclaring="false" stereotype="detail">

          <properties>
            <property key="attachments.skiprelatedattachments" value="true"/>
          </properties>

          <customization position="assetnum">
            <association label="Asset" target="assetnum" labelfield="asset_.description" extraprojectionvalues="location" requiredexpression="true">
              <renderer type="lookup" params="application=asset;schemaId=assetLookupList;"/>
              <dataprovider prefilterfunction="FilterAssets"/>
              <event type="afterchange" service="genericTicketService" method="afterChangeAsset"/>
            </association>
          </customization>


          <customization position="location">
            <section orientation="horizontal">
              <association label="Location" target="location" labelfield="location_.description"  dependantfields="siteid" enableexpression="!@siteid != null" requiredexpression="true">
                <event type="beforechange" service="genericTicketService" method="beforeChangeLocation"/>
                <renderer type="lookup" />
              </association>
            </section>
          </customization>
          <customization position="classstructureid">
            <optionfield attribute="classstructureid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true">
              <renderer type="autocompleteclient" params="inputsize=large" />
            </optionfield>
          </customization>



          <customization position="worktype">
            <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc" requiredexpression="true" >
              <renderer type="lookup" params="inputsize=small"/>
            </association>
          </customization>
        </schema>

        <schema id="newdetail" redeclaring="false" stereotype="detailnew" platform="web" parentschema="adetail">
          <customization position="classstructureid">
            <optionfield attribute="classstructureid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true">
              <renderer type="autocompleteclient" params="inputsize=large" />
            </optionfield>
          </customization>
          <properties>
            <property key="detail.enabledfields" value="description,ld_.ldtext,location,classstructureid,worktype,newattachment,assetnum,siteid"/>
            <property key="search.schemaid" value="search"/>
          </properties>
        </schema>

        <schema id="editdetail" redeclaring="false" stereotype="detail" platform="web" parentschema="adetail">
          <customization position="matusetrans"/>
          <customization position="labtrans"/>
          <customization position="tooltrans"/>
          <properties>
            <property key="detail.enabledfields" value="description,ld_.ldtext,location,classstructureid,worktype,worklog,woactivity,commlog,attachment,assetmeter,locationmeter,relatedrecord,assetnum"/>
            <property key="search.schemaid" value="search"/>
          </properties>
        </schema>

        <schema id="readonlyfixedlist" stereotype="list.modal.readonly" platform="web">
          <field attribute="wonum" label="WO#" >
            <renderer type="default"/>
          </field>
          <field attribute="description" label="Summary">
            <renderer type="default" />
          </field>
          <field attribute="location" label="Location">
            <renderer type="default" />
          </field>
          <field attribute="status" label="Status">
            <renderer type="statuscolor" params="grid=workorder;column=status" />
          </field>
        </schema>

        <schema id="relatedwoconfirmationlist" parentschema="readonlyfixedlist" stereotype="list.modal.confirm" platform="web">
          <properties>
            <property key="commandbar.bottom" value="bottom.confirmation"/>
          </properties>
        </schema>


        <schema id="workordercreationmodal" title="Fill In Workorder Details" stereotype="detail.modal" redeclaring="false" platform="web">
          <customization position="classstructureid">
            <optionfield attribute="classstructureid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true">
              <renderer type="autocompleteclient" />
            </optionfield>
            <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc" requiredexpression="true">
              <renderer type="lookup"/>
            </association>
          </customization>
        </schema>

        <schema id="batchshared" title="Workorder Common Fields" stereotype="detail.modal" platform="web">
          <field attribute="summary" label="Summary:" requiredexpression="true"/>
          <field attribute="details" label="Details:">
            <renderer type="textarea"/>
          </field>
          <optionfield attribute="classificationid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true">
            <renderer type="autocompleteclient" />
          </optionfield>
          <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc" requiredexpression="true">
            <renderer type="lookup"/>
          </association>

          <properties>
            <property key="addassociationlabels" value="true"/>
          </properties>
        </schema>

        <schema id="batchLocationSpreadSheet" title="Workorder Creation" stereotype="list.selection.spreadsheet" platform="web">
          <field attribute="location" hidden="true"/>
          <field attribute="workorderid" hidden="true"/>
          <field attribute="classificationid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
          <field attribute="#warning" tooltip="There are already one or more workorders associated with this location, click here to view them">
            <renderer type="icon" params="expression={'true':'fa-warning','false':''};width=10%;updatable=true;hideValueOnTooltip=true" />
          </field>
          <field attribute="specificLabel" label="Location"/>
          <field attribute="summary" label="Summary:" requiredexpression="true">
            <renderer type="default" params="updatable=true"  />
          </field>
          <field attribute="details" label="Details:" requiredexpression="true">
            <renderer type="textarea" params="updatable=true;limit=20"/>
          </field>
          <field attribute="classification" label="Origination">
            <renderer type="default" params="updatable=true"/>
          </field>
          <field attribute="worktype" label="Work Type">
            <renderer type="default" params="updatable=true"/>
          </field>
          <field attribute="siteid" label="SiteId">
            <renderer type="default" params="updatable=true"/>
          </field>
          <properties>
            <property key="list.click.service" value="batchWorkorderService.spreadSheetLineClick"/>
            <property key="list.click.schema" value="batchLocationInlineEdit"/>
            <property key="list.click.popupmode" value="modal"/>
            <property key="search.schemaid" value="search"/>
          </properties>

          <commandbars>
            <commandgroup id="#spreadsheet">
              <!--TODO: review framework to eventually avoid the need for these commands later-->
              <command id="cancel" service="redirectService" method="goToApplication" parameters="location,list" cssclasses="large-button"/>
              <command id="save" service="batchWorkorderService" method="submitBatch" parameters="location" primary="true" cssclasses="large-button"/>
            </commandgroup>
          </commandbars>
        </schema>


        <schema id="batchAssetSpreadSheet" title="Workorder Creation" stereotype="list.selection.spreadsheet" platform="web">
          <field attribute="workorderid" hidden="true"/>
          <field attribute="classificationid" hidden="true"/>
          <field attribute="orgid" hidden="true"/>
          <field attribute="#warning" tooltip="There are already one or more workorders associated with this asset, click here to view them">
            <renderer type="icon" params="expression={'true':'fa-warning','flase':''};width=10%;updatable=true;hideValueOnTooltip=true"/>
          </field>
          <field attribute="assetnum" label="Asset" readonly="true"/>
          <field attribute="specificLabel" label="Asset"/>
          <!--Location field come from the selected asset-->
          <field attribute="location" label="Location"/>
          <field attribute="summary" label="Summary:" requiredexpression="true">
            <renderer type="default" params="updatable=true"  />
          </field>
          <field attribute="details" label="Details:" requiredexpression="true">
            <renderer type="textarea" params="updatable=true;limit=20"/>
          </field>
          <field attribute="classification" label="Origination">
            <renderer type="default" params="updatable=true"/>
          </field>
          <field attribute="worktype" label="Work Type">
            <renderer type="default" params="updatable=true"/>
          </field>
          <field attribute="siteid" label="SiteId">
            <renderer type="default" params="updatable=true"/>
          </field>

          <properties>
            <property key="list.click.service" value="batchWorkorderService.spreadSheetLineClick"/>
            <property key="list.click.schema" value="batchAssetInlineEdit"/>
            <property key="list.click.popupmode" value="modal"/>
            <property key="search.schemaid" value="search"/>
          </properties>

          <commandbars>
            <commandgroup id="#spreadsheet">
              <!--TODO: review framework to eventually avoid the need for these commands later-->
              <command id="cancel" service="redirectService" method="goToApplication" parameters="asset,list" cssclasses="large-button"/>
              <command id="save" service="batchWorkorderService" method="submitBatch" parameters="asset" primary="true" cssclasses="large-button"/>
            </commandgroup>
          </commandbars>
        </schema>


        <schema id="batchLocationInlineEdit" title="Edit Workorder" stereotype="detail.modal" platform="web">
          <field attribute="workorderid" hidden="true"/>
          <field attribute="userIdFieldName" hidden="true"/>
          <field attribute="specificLabel" label="Location" readonly="true"/>
          <field attribute="siteid" label ="Site" readonly="true"/>
          <field attribute="summary" label="Summary:" requiredexpression="true">
            <renderer type="default" params="updatable=true"  />
          </field>
          <field attribute="details" label="Details:">
            <renderer type="textarea" params="updatable=true"/>
          </field>

          <optionfield attribute="classificationid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true">
            <renderer type="autocompleteclient" />
          </optionfield>
          <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc" requiredexpression="true">
            <renderer type="lookup"/>
          </association>

          <properties>
            <property key="addassociationlabels" value="true"/>
          </properties>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <command id="save" icon="fa-check" service="batchWorkorderService" method="woInlineEditSave" parameters="datamap,schema" label="Save" primary="true"/>
            </commandgroup>
          </commandbars>
        </schema>


        <schema id="batchAssetInlineEdit" title="Edit Workorder" stereotype="detail.modal" platform="web">
          <field attribute="workorderid" hidden="true"/>
          <field attribute="userIdFieldName" hidden="true"/>
          <field attribute="specificLabel" label="Asset" readonly="true"/>
          <field attribute="location" label="Location" readonly="true"/>
          <field attribute="siteid" label ="Site" readonly="true"/>
          <field attribute="summary" label="Summary:" requiredexpression="true">
            <renderer type="default" params="updatable=true"  />
          </field>
          <field attribute="details" label="Details:">
            <renderer type="textarea" params="updatable=true"/>
          </field>
          <optionfield attribute="classificationid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true">
            <renderer type="autocompleteclient" />
          </optionfield>
          <association label="Work Type" target="worktype" labelfield="worktype_.wtypedesc" orderbyfield="worktype asc" requiredexpression="true">
            <renderer type="lookup"/>
          </association>

          <properties>
            <property key="addassociationlabels" value="true"/>
          </properties>

          <commandbars>
            <commandgroup position="modal.detail.primary">
              <command id="save" icon="fa-check" service="batchWorkorderService" method="woInlineEditSave" parameters="datamap,schema" label="Save" primary="true"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="search" title="Location Search" stereotype="search" platform="web">
          <field attribute="status" hidden="true" default="INPRG,APPR,WOEN,ENRV,HOLD,WAPPR" searchoperation="eq"/>
          <field attribute="fslocationsearch" hidden="true" default="false" searchoperation="eq"/>
          <field attribute="fsincludesubloc" label="Include Sublocations?" defaultexpression="false" searchoperation="eq">
            <renderer type="checkbox" params="layout=left"/>
          </field>
          <optionfield attribute="fsfacility" label="Facility" requiredexpression="true" searchoperation="eq" default="">
            <option label="ACS1"  value="ACS01"/>
            <option label="AES1"  value="AES11"/>
            <option label="AMH1"  value="AMH11"/>
            <option label="AMH2"  value="AMR03,AMR04"/>
            <option label="ALM1"  value="ALM01"/>
            <option label="ALP1"  value="ALP11"/>
            <option label="AVS1"  value="AVS11"/>
            <option label="AVV1"  value="AVV11"/>
            <option label="BEL1"  value="BEL11"/>
            <option label="BRS1"  value="BRS11"/>
            <option label="BWS1"  value="BWS11"/>
            <option label="CBLA"  value="CBLA1"/>
            <option label="CCS1"  value="CCS11"/>
            <option label="CGL1"  value="CGL11"/>
            <option label="CID1"  value="CID11"/>
            <option label="CIM1"  value="CIM01"/>
            <option label="CVS1"  value="CVS11"/>
            <option label="DSS1"  value="DSS11,DSS21"/>
            <option label="GAL1"  value="GAL01"/>
            <option label="HON1"  value="HON01"/>
            <option label="IVS1"  value="IVS11"/>
            <option label="IVW1"  value="IVW11"/>
            <option label="KBSA"  value="KBSA1"/>
            <option label="KBSB"  value="KBSB1"/>
            <option label="KNS1"  value="KNS11"/>
            <option label="KSS1"  value="KSS11"/>
            <option label="LHS1"  value="LHS11"/>
            <option label="LMS1"  value="LMS01"/>
            <option label="MAN1"  value="MAN11"/>
            <option label="MLK1"  value="MLK11"/>
            <option label="MSS1"  value="MSS11"/>
            <option label="NSS1"  value="NSS11"/>
            <option label="ORS1"  value="ORS11"/>
            <option label="OTE1"  value="OTE11"/>
            <option label="REE1"  value="REE01"/>
            <option label="SAR1"  value="SAR01,SAR02,SAR03,SAR04,SAR05,SAR06,SAR07,SAR08"/>
            <option label="SDVL"  value="SDVL1"/>
            <option label="SES1"  value="SES10"/>
            <option label="SES2"  value="SES20"/>
            <option label="SGAH"  value="SGAH1"/>
            <option label="SGAK"  value="SGAK1"/>
            <option label="SGSO"  value="SGSO1"/>
            <option label="SLS1"  value="SLS11"/>
            <option label="SSN1"  value="SSN01"/>
            <option label="STT1"  value="STT01"/>
            <option label="TIL1"  value="TIL02"/>
            <option label="TPZ1"  value="TPZ11"/>
            <event type="afterchange" service="advancedSearchService" method="facilitySelected"/>
          </optionfield>
          <optionfield attribute="fslocint" label="Locations of Interest" providerattribute="_FsLocationsOfInterest" searchoperation="eq">
            <renderer type="combo" params="multiple=true"/>
          </optionfield>
          <optionfield attribute="fsswitchgear" label="Switchgear Locations" providerattribute="_FsSwitchgearLocations" searchoperation="eq">
            <renderer type="combo" params="multiple=true"/>
          </optionfield>
          <optionfield attribute="fspcslocations" providerattribute="_FsPcsLocations" searchoperation="eq">
            <renderer type="combodropdown" params="multiple=true;showvaluesbelow=true;buttontext=Select PCS(s);maxheight=300;labelmaxlength=30;customdropdownfunction=advancedSearchService.customizeComboDropdown"/>
          </optionfield>

          <commandbars>
            <commandgroup position="detailform" platform="web">
              <removecommand id="save"/>
              <removecommand id="print"/>
              <removecommand id="cancel"/>
              <command id="search" primary="true" icon="fa-search" service="dispatcherService" method="dispatchevent" label="Search" parameters="sw.crud.search,schema,datamap"/>
              <command id="clear" icon="fa-eraser" service="dispatcherService" method="dispatchevent" label="Clear" parameters="sw.crud.search.clear,schema,datamap"/>
              <command id="new" cssclasses="searchbutton" icon="fa-plus" service="advancedSearchService" method="newWorkOrder" label="New WO" parameters="schema,datamap"/>
            </commandgroup>
          </commandbars>

          <properties>
            <property key="search.panelwidth" value="180"/>
            <property key="crud.disableautofocus" value="true"/>
            <property key="search.startexpanded" value="true"/>
          </properties>
        </schema>

        <!-- #region: Mobile -->

        <list platform="mobile" title="WO - Assigned" redeclaring="true">
          <filters>
            <optionfilter attribute="wopriority" provider="realpriority_.description" />
          </filters>

          <field attribute="wonum" label="Workorder Number" qualifier="title"/>
          <field attribute="wopriority" label="Priority" qualifier="icon"/>
          <field attribute="schedstart" label="Scheduled Start Date" hidden="true"/>
          <field attribute="schedstartnotime" label="Scheduled Start Date" qualifier="featured"/>
          <field attribute="schedfinish" label="Scheduled Finish Date" hidden="true"/>
          <field attribute="schedfinishnotime" label="Scheduled Finish Date"/>
          <field attribute="description" label="Description" qualifier="excerpt"/>

          <properties>
            <property key="list.defaultorderby" value="schedstartnotime is null asc, schedstartnotime asc, wopriority desc"/>
          </properties>
        </list>

        <detail platform="mobile" title="Work Order" redeclaring="true">
          <reference id="detailhiddensoffline"/>

          <association label="Location" target="location" labelfield="location.description" requiredexpression="true"/>
          <association label="Asset" target="assetnum" labelfield="asset.description" requiredexpression="true"/>

          <association label="Status" target="status" labelfield="synstatus.description" >
            <dataprovider prefilterfunction="FilterStatusCodes"/>
          </association>

          <field attribute="description" label="Description" requiredexpression="true"/>
          <field label="Details" attribute="ld_.ldtext" requiredexpression="true">
            <renderer type="richtext"/>
          </field>

<!--          <optionfield attribute="classstructureid" label="Origination" providerattribute="_WOClassStructureType" requiredexpression="true"/>-->

          <association label="Origination" target="classstructureid" labelfield="classstructure_.description" requiredexpression="true"/>

          <reference id="offlineworktypes"/>


          <field label="Warranty Claim Number" attribute="WOLO10"/>
          <field label="EPCR Number" attribute="EPCR_NUM"/>
          
          <field label="JP Number" attribute="jobplan_.description" enableexpression="false" readonly="true"/>

          <association label="Failure Class" target="failurecode" labelfield="failurelistonly_.description" requiredexpression="@worktype_.type == 'CM'" extraprojectionvalues="failurelist">
              <event type="afterchange" service="fsWorkorderOfflineService" method="afterFailureChanged"/>
          </association>

          <!-- Region Problems, cuase Remedy -->
          <association label="Problem Code" enableexpression="@failurecode!=null" target="problemcode" labelfield="offlineproblemlist_.description" requiredexpression="@worktype_.type == 'CM'" extraprojectionvalues="failurelist" >
            <event type="afterchange" service="fsWorkorderOfflineService" method="afterProblemChanged"/>
          </association>

          <association label="Cause" enableexpression="@problemcode!=null" target="fr1code" labelfield="offlinecauselist_.description" requiredexpression="@worktype_.type == 'CM'"
                       extraprojectionvalues="failurelist">
            <event type="afterchange" service="fsWorkorderOfflineService" method="afterCauseChanged"/>
          </association>

          <association label="Remedy" enableexpression="@fr1code!=null" target="fr2code" labelfield="offlineremedylist_.description" requiredexpression="@worktype_.type == 'CM'"
                       extraprojectionvalues="failurelist">
            <event type="afterchange" service="fsWorkorderOfflineService" method="afterRemedyChanged"/>
          </association>

          <!-- EndRegion-->

          <!-- Region Compositions: materials, labors, attachmets -->
          <composition relationship="matusetrans" label="Materials" />
          <composition relationship="labtrans" label="Labor">
            <collectionproperties allowupdate="false" allowcreation="@status!='CLOSED'" />
          </composition>
          <composition relationship="attachment" label="Attachments">
            <collectionproperties prefilterfunction="BuildRelatedAttachmentsWhereClause"/>
          </composition>
          <!-- EndRegion -->



          <commandbars>
            <commandgroup platform="mobile" position="mobile.fab">
              <command id="startlabtrans" service="laborService" method="startLaborTransaction"
                       icon="ion-play" showexpression="service:laborService.shouldAllowLaborStart" label="Start Labor Report" />
              <command id="finishlabtrans" service="laborService" method="finishLaborTransaction"
                       icon="ion-stop" showexpression="service:laborService.shouldAllowLaborFinish" label="Finish Labor Report" />
            </commandgroup>
          </commandbars>

        </detail>


        <schema id="newdetail" stereotype="detailnew" platform="mobile" redeclaring="true">
          <field attribute="orgid" hidden="true" requiredexpression="true" />
          <field attribute="siteid" hidden="true" requiredexpression="true" />

          <field attribute="description" label="Description" requiredexpression="true"/>

          <association target="location" labelfield="location.description"
                       requiredexpression="true" label="Location">
            <renderer type="lookup"/>
            <event type="afterchange" service="workorderService" method="clearAsset" />
          </association>
          <association target="assetnum" labelfield="asset.description" extraprojectionvalues="location"
                       requiredexpression="true" label="Asset">
            <renderer type="lookup"/>
            <event type="afterchange" service="workorderService" method="updateLocation" />
          </association>

          <!--<association target="classstructureid" labelfield="offlineclassification_.description"
                       requiredexpression="true" label="Origination" >
            <renderer type="lookup"/>
          </association>-->

          <reference id="offlineworktypes"/>
          

          <composition relationship="attachment" label="Attachments" >
            <collectionproperties allowupdate="false" />
          </composition>

        </schema>
        <!-- #endregion -->

      </schemas>

      <properties>
        <property key="list.offline.text.indexlist" value="wonum,wopriority,description"/>
        <property key="list.offline.date.indexlist" value="schedstartnotime"/>
      </properties>
    </application>

    <application name="numericdomain" title="Numeric Domain" entity="numericdomain">
      <schemas>
        <list platform="mobile" title="Numeric Domain">
          <field attribute="description" label="Description"/>
          <field attribute="value" label="Value"/>
          <field attribute="domainid" label="Domain"/>
        </list>
      </schemas>
    </application>

    <application name="otherworkorder" title="Other Work Orders" entity="workorder" role="workorders">
      <properties>
        <property key="list.offline.text.indexlist" value="wonum,wopriority,description"/>
        <property key="list.offline.date.indexlist" value="schedstartnotime"/>
      </properties>

      <schemas>
        <list platform="mobile" title="WO - Other">
          <filters>
            <optionfilter attribute="wopriority" provider="realpriority_.description" />
          </filters>

          <field attribute="wonum" label="Workorder Number" qualifier="title"/>
          <field attribute="wopriority" label="Priority" qualifier="icon"/>
          <field attribute="schedstart" label="Scheduled Start Date" hidden="true"/>
          <field attribute="schedstartnotime" label="Scheduled Start Date" qualifier="featured"/>
          <field attribute="schedfinish" label="Scheduled Finish Date" hidden="true"/>
          <field attribute="schedfinishnotime" label="Scheduled Finish Date"/>
          <field attribute="description" label="Description" qualifier="excerpt"/>

          <properties>
            <property key="list.defaultorderby" value="schedstartnotime is null asc, schedstartnotime asc, wopriority desc"/>
          </properties>
        </list>

        <schema id="newdetail" platform="mobile" stereotype="detailnew">
          <field attribute="reportdate" label="Reported On" default="@now" hidden="true"/>
          <association label="Priority" target="wopriority" labelfield="realpriority_.description"/>
          <association label="Location" target="location" labelfield="location.description" />
          <association label="Asset" target="assetnum" labelfield="asset.description" />
          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description"  />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>

          <composition relationship="worklog" label="Work Logs" />
          <composition relationship="matusetrans" label="Materials" />
          <composition relationship="labtrans" label="Labor">
            <collectionproperties allowupdate="false" allowcreation="@status!='CLOSED'" />
          </composition>
        </schema>

        <detail platform="mobile" title="Work Order">
          <field attribute="workorderid" hidden="true"/>
          <field attribute="orgid" hidden="true" />
          <field attribute="siteid" hidden="true"/>
          <field attribute="woclass" hidden="true"/>
          <field attribute="hasfollowupwork" hidden="true"/>
          <field attribute="origrecordid" hidden="true"/>
          <field attribute="origrecordclass" hidden="true"/>
          <field attribute="wonum" label="Number" hidden="true" />
          <field attribute="reportdate" label="Reported On" default="@now" hidden="true"/>
          <field attribute="changeby" label="Changed By" hidden="true"/>
          <field attribute="owner" label="Owner"  readonly="true"/>
          <association label="Status" target="status" labelfield="synstatus.description">
            <dataprovider prefilterfunction="FilterStatusCodes"/>
            <renderer type="lookup" params="avoidautofocus=true"/>
          </association>
          <association label="Priority" target="wopriority" labelfield="realpriority_.description"/>
          <association label="Location" target="location" labelfield="location.description" />
          <association label="Asset" target="assetnum" labelfield="asset.description" />
          <association label="Failure Class" target="failurecode" labelfield="failurecode.description" />
          <association label="Work Type" target="worktype" labelfield="worktype.wtypedesc" />
          <association label="GL Account" target="glaccount" labelfield="chartofaccounts.accountname" />
          <field attribute="description" label="Description" />
          <field label="Details" attribute="ld_.ldtext">
            <renderer type="richtext"/>
          </field>

          <composition relationship="worklog" label="Work Logs" />
          <composition relationship="matusetrans" label="Materials" />
          <composition relationship="labtrans" label="Labor">
            <collectionproperties allowupdate="false" allowcreation="@status!='CLOSED'" />
          </composition>
        </detail>
      </schemas>
    </application>

    <application name="location" title="Location" entity="location" >

      <filters>
        <optionfilter attribute="location" provider="@firstSolarPCSLocationHandler.HandlePCSLocationProvider" displaycode="false"
              allowblank="true" whereclause="@firstSolarPCSLocationHandler.HandlePCSLocation"/>
      </filters>

      <schemas>
        <schema id="locationfilter" stereotype="list.selection.modal.filter">
          <field attribute="location" label="Location"/>
          <field attribute="description" label="Description"/>
          <field attribute="classstructure_.description" label="Class Structure"/>
          <!--field attribute="parentlocation_.parent" label="Parent Location"/-->
          <field attribute="siteid" label="Site"/>
        </schema>
        <schema id="list"  redeclaring="false" stereotype="list.selection">
          <commandbars>
            <commandgroup position="actions">
              <!--              <container label="Actions" id="actioncontainer" icon="fa-bolt">-->
              <command id="Create" icon="fa-wrench" label="Create W.O."
                       service="locationService" method="initBatchWorkorder"
                       parameters="schema,datamap" cssclasses="large-button"/>
              <!--              </container>-->
            </commandgroup>
          </commandbars>

          <properties>
            <property key="search.schemaid" value="search"/>
          </properties>
        </schema>

        <schema id="locationdetail"  redeclaring="false" stereotype="detail">
          <properties>
            <property key="search.schemaid" value="search"/>
          </properties>
        </schema>

        <schema id="search" title="Location Search" stereotype="search">
          <field attribute="fslocationsearch" hidden="true" default="true" searchoperation="eq"/>
          <field attribute="fsincludesubloc" label="Include Sublocations?" defaultexpression="false" searchoperation="eq">
            <renderer type="checkbox" params="layout=left"/>
          </field>
          <optionfield attribute="fsfacility" label="Facility" requiredexpression="true" searchoperation="eq" default="">
            <option label="ACS1"  value="ACS01"/>
            <option label="AES1"  value="AES11"/>
            <option label="AMH1"  value="AMH11"/>
            <option label="AMH2"  value="AMR03,AMR04"/>
            <option label="ALM1"  value="ALM01"/>
            <option label="ALP1"  value="ALP11"/>
            <option label="AVS1"  value="AVS11"/>
            <option label="AVV1"  value="AVV11"/>
            <option label="BEL1"  value="BEL11"/>
            <option label="BRS1"  value="BRS11"/>
            <option label="BWS1"  value="BWS11"/>
            <option label="CBLA"  value="CBLA1"/>
            <option label="CCS1"  value="CCS11"/>
            <option label="CGL1"  value="CGL11"/>
            <option label="CID1"  value="CID11"/>
            <option label="CIM1"  value="CIM01"/>
            <option label="CVS1"  value="CVS11"/>
            <option label="DSS1"  value="DSS11,DSS21"/>
            <option label="GAL1"  value="GAL01"/>
            <option label="HON1"  value="HON01"/>
            <option label="IVS1"  value="IVS11"/>
            <option label="IVW1"  value="IVW11"/>
            <option label="KBSA"  value="KBSA1"/>
            <option label="KBSB"  value="KBSB1"/>
            <option label="KNS1"  value="KNS11"/>
            <option label="KSS1"  value="KSS11"/>
            <option label="LHS1"  value="LHS11"/>
            <option label="LMS1"  value="LMS01"/>
            <option label="MAN1"  value="MAN11"/>
            <option label="MLK1"  value="MLK11"/>
            <option label="MSS1"  value="MSS11"/>
            <option label="NSS1"  value="NSS11"/>
            <option label="ORS1"  value="ORS11"/>
            <option label="OTE1"  value="OTE11"/>
            <option label="REE1"  value="REE01"/>
            <option label="SAR1"  value="SAR01,SAR02,SAR03,SAR04,SAR05,SAR06,SAR07,SAR08"/>
            <option label="SDVL"  value="SDVL1"/>
            <option label="SES1"  value="SES10"/>
            <option label="SES2"  value="SES20"/>
            <option label="SGAH"  value="SGAH1"/>
            <option label="SGAK"  value="SGAK1"/>
            <option label="SGSO"  value="SGSO1"/>
            <option label="SLS1"  value="SLS11"/>
            <option label="SSN1"  value="SSN01"/>
            <option label="STT1"  value="STT01"/>
            <option label="TIL1"  value="TIL02"/>
            <option label="TPZ1"  value="TPZ11"/>
            <event type="afterchange" service="advancedSearchService" method="facilitySelected"/>
          </optionfield>
          <optionfield attribute="fslocint" label="Locations of Interest" providerattribute="_FsLocationsOfInterest" searchoperation="eq">
            <renderer type="combo" params="multiple=true"/>
          </optionfield>
          <optionfield attribute="fsswitchgear" label="Switchgear Locations" providerattribute="_FsSwitchgearLocations" searchoperation="eq">
            <renderer type="combo" params="multiple=true"/>
          </optionfield>
          <optionfield attribute="fspcslocations" providerattribute="_FsPcsLocations" searchoperation="eq">
            <renderer type="combodropdown" params="multiple=true;showvaluesbelow=true;buttontext=Select PCS(s);maxheight=300;labelmaxlength=30;customdropdownfunction=advancedSearchService.customizeComboDropdown"/>
          </optionfield>

          <commandbars>
            <commandgroup position="detailform" platform="web">
              <removecommand id="save"/>
              <removecommand id="print"/>
              <removecommand id="cancel"/>
              <command id="search" primary="true" icon="fa-search" service="dispatcherService" method="dispatchevent" label="Search" parameters="sw.crud.search,schema,datamap"/>
              <command id="clear" icon="fa-eraser" service="dispatcherService" method="dispatchevent" label="Clear" parameters="sw.crud.search.clear,schema,datamap"/>
              <command id="new" cssclasses="searchbutton" icon="fa-plus" service="advancedSearchService" method="newWorkOrder" label="New WO" parameters="schema,datamap"/>
            </commandgroup>
          </commandbars>

          <properties>
            <property key="search.panelwidth" value="180"/>
            <property key="crud.disableautofocus" value="true"/>
          </properties>
        </schema>
      </schemas>
    </application>


    <application name="asset" title="Asset" entity="asset" >
      <filters>
        <optionfilter attribute="location" provider="@firstSolarPCSLocationHandler.HandlePCSLocationProvider" displaycode="false"
              allowblank="true" whereclause="@firstSolarPCSLocationHandler.HandlePCSLocation"/>
      </filters>

      <schemas>


        <schema id="list"  redeclaring="false" stereotype="list.selection" platform="web">
          <commandbars>
            <commandgroup position="actions">
              <!--              <container label="Actions" id="actioncontainer" icon="fa-bolt">-->
              <command id="Create" icon="fa-wrench" label="Create W.O."
                       service="assetService" method="initBatchWorkorder"
                       parameters="schema,datamap" cssclasses="large-button"/>
              <!--              </container>-->
            </commandgroup>
          </commandbars>

          <properties>
            <property key="search.schemaid" value="search"/>
            <property key="list.selectionstyle" value="multiple"/>
          </properties>
        </schema>

        <schema id="detail"  redeclaring="false" stereotype="detail">
          <properties>
            <property key="search.schemaid" value="search"/>
          </properties>
        </schema>



        <schema id="search" title="Location Search" stereotype="search">
          <field attribute="fslocationsearch" hidden="true" default="true" searchoperation="eq"/>
          <field attribute="fsincludesubloc" label="Include Sublocations?" defaultexpression="false" searchoperation="eq">
            <renderer type="checkbox" params="layout=left"/>
          </field>
          <optionfield attribute="fsfacility" label="Facility" requiredexpression="true" searchoperation="eq" default="">
            <option label="ACS1"  value="ACS01"/>
            <option label="AES1"  value="AES11"/>
            <option label="AMH1"  value="AMH11"/>
            <option label="AMH2"  value="AMR03,AMR04"/>
            <option label="ALM1"  value="ALM01"/>
            <option label="ALP1"  value="ALP11"/>
            <option label="AVS1"  value="AVS11"/>
            <option label="AVV1"  value="AVV11"/>
            <option label="BEL1"  value="BEL11"/>
            <option label="BRS1"  value="BRS11"/>
            <option label="BWS1"  value="BWS11"/>
            <option label="CBLA"  value="CBLA1"/>
            <option label="CCS1"  value="CCS11"/>
            <option label="CGL1"  value="CGL11"/>
            <option label="CID1"  value="CID11"/>
            <option label="CIM1"  value="CIM01"/>
            <option label="CVS1"  value="CVS11"/>
            <option label="DSS1"  value="DSS11,DSS21"/>
            <option label="GAL1"  value="GAL01"/>
            <option label="HON1"  value="HON01"/>
            <option label="IVS1"  value="IVS11"/>
            <option label="IVW1"  value="IVW11"/>
            <option label="KBSA"  value="KBSA1"/>
            <option label="KBSB"  value="KBSB1"/>
            <option label="KNS1"  value="KNS11"/>
            <option label="KSS1"  value="KSS11"/>
            <option label="LHS1"  value="LHS11"/>
            <option label="LMS1"  value="LMS01"/>
            <option label="MAN1"  value="MAN11"/>
            <option label="MLK1"  value="MLK11"/>
            <option label="MSS1"  value="MSS11"/>
            <option label="NSS1"  value="NSS11"/>
            <option label="ORS1"  value="ORS11"/>
            <option label="OTE1"  value="OTE11"/>
            <option label="REE1"  value="REE01"/>
            <option label="SAR1"  value="SAR01,SAR02,SAR03,SAR04,SAR05,SAR06,SAR07,SAR08"/>
            <option label="SDVL"  value="SDVL1"/>
            <option label="SES1"  value="SES10"/>
            <option label="SES2"  value="SES20"/>
            <option label="SGAH"  value="SGAH1"/>
            <option label="SGAK"  value="SGAK1"/>
            <option label="SGSO"  value="SGSO1"/>
            <option label="SLS1"  value="SLS11"/>
            <option label="SSN1"  value="SSN01"/>
            <option label="STT1"  value="STT01"/>
            <option label="TIL1"  value="TIL02"/>
            <option label="TPZ1"  value="TPZ11"/>
            <event type="afterchange" service="advancedSearchService" method="facilitySelected"/>
          </optionfield>
          <optionfield attribute="fslocint" label="Locations of Interest" providerattribute="_FsLocationsOfInterest" searchoperation="eq">
            <renderer type="combo" params="multiple=true"/>
          </optionfield>
          <optionfield attribute="fsswitchgear" label="Switchgear Locations" providerattribute="_FsSwitchgearLocations" searchoperation="eq">
            <renderer type="combo" params="multiple=true"/>
          </optionfield>
          <optionfield attribute="fspcslocations" providerattribute="_FsPcsLocations" searchoperation="eq">
            <renderer type="combodropdown" params="multiple=true;showvaluesbelow=true;buttontext=Select PCS(s);maxheight=300;labelmaxlength=30;customdropdownfunction=advancedSearchService.customizeComboDropdown"/>
          </optionfield>

          <commandbars>
            <commandgroup position="detailform" platform="web">
              <removecommand id="save"/>
              <removecommand id="print"/>
              <removecommand id="cancel"/>
              <command id="search" primary="true" icon="fa-search" service="dispatcherService" method="dispatchevent" label="Search" parameters="sw.crud.search,schema,datamap"/>
              <command id="clear" icon="fa-eraser" service="dispatcherService" method="dispatchevent" label="Clear" parameters="sw.crud.search.clear,schema,datamap"/>
              <command id="new" cssclasses="searchbutton" icon="fa-plus" service="advancedSearchService" method="newWorkOrder" label="New WO" parameters="schema,datamap"/>
            </commandgroup>
          </commandbars>

          <properties>
            <property key="search.panelwidth" value="180"/>
            <property key="crud.disableautofocus" value="true"/>
          </properties>
        </schema>
      </schemas>
    </application>

    <application name="classstructure" title="ClassStructure" entity="classstructure">
      <schemas>
        <list>
          <field attribute="classstructureid" hidden="true"/>
          <field attribute="description" label="Description"/>
        </list>
      </schemas>
    </application>

    <application name="failurelistonly" title="Failure List" entity="failurelistonly">
      <schemas>
        <list>
          <field attribute="failurecode" hidden="true"/>
          <field attribute="failurelist" hidden="true"/>
          <field attribute="parent" hidden="true"/>
          <field attribute="description" label="Description"/>
        </list>
      </schemas>
    </application>

    <application name="problemlist" title="ClassStructure" entity="problemlist">
      <schemas>
        <list>
          <field attribute="failurecode" hidden="true"/>
          <field attribute="failurelist" hidden="true"/>
          <field attribute="parent" hidden="true"/>
          <field attribute="description" label="Description"/>
        </list>
      </schemas>
    </application>

    <application name="causelist" title="ClassStructure" entity="causelist">
      <schemas>
        <list>
          <field attribute="failurecode" hidden="true"/>
          <field attribute="failurelist" hidden="true"/>
          <field attribute="parent" hidden="true"/>
          <field attribute="description" label="Description"/>
          
        </list>
      </schemas>
    </application>

    <application name="remedylist" title="ClassStructure" entity="remedylist">
      <schemas>
        <list>
          <field attribute="failurecode" hidden="true"/>
          <field attribute="failurelist" hidden="true"/>
          <field attribute="parent" hidden="true"/>
          <field attribute="description" label="Description"/>
        </list>
      </schemas>
    </application>

    
    
  </applications>
</metadata>
