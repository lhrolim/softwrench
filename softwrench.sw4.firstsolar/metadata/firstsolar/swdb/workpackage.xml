<?xml version="1.0" encoding="utf-8" ?>
<metadata xmlns="http://www.controltechnologysolutions.com/metadata">

  <templates>
    <template path="swdb/callout.xml"/>
    <template path="swdb/maintenanceengineer.xml"/>
    <template path="swdb/dailyoutagemeeting.xml"/>
    <template path="swdb/outageaction.xml"/>
  </templates>

  <entities>
    <entity name="WorkPackage" idAttribute="id" whereclause="deleted is null or deleted != 1">
      <relationships>

        <relationship to="workorder">
          <relationshipAttribute from="wonum" to="wonum" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute query="worktype in ('CM','PM','WO') and historyflag=0"/>
        </relationship>

        <relationship to="workorder" qualifier="relatedworkorder">
          <relationshipAttribute from="wonum" to="wonum" primary="true"/>
          <relationshipAttribute from="orgid" to="orgid"/>
          <relationshipAttribute from="siteid" to="siteid"/>
          <relationshipAttribute query="historyflag=0"/>
        </relationship>
        
        <relationship to="_CallOut_" qualifier="callOuts" collection="true">
          <relationshipAttribute from="id" to="workpackageid" primary="true"/>
        </relationship>
        <relationship to="_MaintenanceEngineering_" qualifier="maintenanceEngineerings" collection="true">
          <relationshipAttribute from="id" to="workpackageid" primary="true"/>
        </relationship>
        <relationship to="_DailyOutageMeeting_" qualifier="dailyOutageMeetings" collection="true">
          <relationshipAttribute from="id" to="workpackageid" primary="true"/>
        </relationship>
        <relationship to="_OutageAction_" qualifier="outageActions" collection="true">
          <relationshipAttribute from="id" to="workpackageid" primary="true"/>
        </relationship>

        <relationship to="_WorkPackageEmailStatus_" qualifier="emailtracking" collection="true">
          <relationshipAttribute from="id" to="workpackageid" primary="true"/>
        </relationship>

      </relationships>
    </entity>

    <entity name="WorkPackageEmailStatus" idAttribute="id">
      <attributes>
        <attribute name="status" query="CASE WHEN !@ackdate is not null THEN 'Acknowledged' ELSE 'Sent' end " type="varchar"/>
      </attributes>
    </entity>

  </entities>

  <applications>

    <application entity="WorkPackage" name="WorkPackage" title="Work Package">
      <properties>
        <property key="application.maindetailschema" value="adetail"/>
        <property key="application.mainlistschema" value="workorder.wplist"/>
      </properties>

      <components>
        <componentdisplayable id="dailyoutage">
          <section orientation="horizontal">
            <field label="Start Date of Outage" attribute="createddate">
              <renderer type="datetime"/>
            </field>
            <field label="Estimated Completion Date" attribute="estimatedcompdate">
              <renderer type="datetime"/>
            </field>
            <field label="Actual Completion Date" attribute="actualcompdate">
              <renderer type="datetime"/>
            </field>
          </section>

          <section orientation="horizontal">
            <header label="Lost Energy"  params="fieldset=true"/>
            <field label="MWh Lost Total" attribute="mwhlosttotal" readonly="true"/>
            <field label="Daily Estimated Loss (MWh)" attribute="mwhlostperday"/>
            <field label="Total Estimated Loss (MWh)" attribute="expectedmwhlost"/>
          </section>

          <section orientation="horizontal">
            <header label="Outage Summary"  params="fieldset=true"/>
            <field label="Problem Statement" attribute="problemstatement">
              <renderer type="textarea"/>
            </field>
          </section>

          <section orientation="horizontal">
            <header label="Daily Lost Energy"  params="fieldset=true"/>
            <composition fetchtype="lazy" detailschema="lostenergydetail"  relationship="#lostenergyentries" printschema="" inline="true">
              <collectionproperties allowcreation="false" listschema="lostenergylist" allowupdate="false"/>
            </composition>
          </section>
          
          
          <section orientation="horizontal">
            <header label="Daily Update Meetings"  params="fieldset=true"/>
            <composition inline="true" relationship="dailyOutageMeetings" label="" detailschema="detail" outputschema="detailview" printschema="" fetchtype="lazy" >
              <collectionproperties listschema="dailyoutagelineline" autocommit="true" allowremoval="false" allowcreation="true" allowupdate="true" orderbyfield="meetingtime"/>
              <renderer type="TABLE" params="mode=batch;composition.inline.addfunction=fsdailyoutagemeetingService.openModalNew;
                            composition.inline.expandreadonly=true;composition.inline.editfunction=fsdailyoutagemeetingService.openModalEdit;
                            composition.inline.deletefunction=fsdailyoutagemeetingService.deleteRow;composition.inline.forcehideremove=true;composition.inline.addTitle=Meeting"/>
            </composition>
          </section>


          <section orientation="horizontal">
            <header label="Outage Actions"  params="fieldset=true"/>
            <composition inline="true" relationship="outageActions" label="" outputschema="" detailschema="" printschema="" fetchtype="eager" >
              <collectionproperties listschema="list" autocommit="true" allowcreation="true" allowupdate="true" orderbyfield="duedate asc"/>
              <renderer type="TABLE" params="mode=batch;composition.inline.addTitle=Action"/>
            </composition>
          </section>
          
          
        </componentdisplayable>
      </components>

      <schemas>


        <schema id="listdeprecatedfortest" title="Work Packages" stereotype="list">
          <properties>
            <property key="list.search.quicksearchfieldstoexclude" value="wpnum,#outreq,createdate"/>
          </properties>

          <filters>
            <optionfilter attribute="#status" provider="#workorder_.synstatus_.description" displaycode="true" style="width:300px" whereclause="status in (!@#value)" />
            <optionfilter attribute="#worktype" provider="#workorder_.worktype_.wtypedesc" displaycode="true" style="width:300px" whereclause="worktype in (!@#value)" />
            <filter attribute="#description" style="width:300px" whereclause="description like !@#value" />
            <booleanfilter attribute="#outreq" whereclause="outreq = !@#value" />
          </filters>


          <field attribute="id" hidden="true"/>
          <field attribute="wpnum" label="WP #" >
            <renderer type="default" params="width=15%"/>
          </field>
          <field attribute="workorderid" hidden="true" />
          <field attribute="wonum" hidden="true" />
          <field attribute="#description" label="Description">
            <renderer type="default" params="width=30%"/>
          </field>
          <field attribute="#outreq" label="Outage Requested" >
            <renderer params="formatter=numberToBoolean" type="default"/>
          </field>
          <field attribute="#worktype" label="Work Type" />
          <field attribute="#status" label="Status" />
          <field attribute="createddate" label="Created Date" >
            <renderer type="datetime"/>
          </field>
          <field attribute="#schedstart" label="Scheduled Start">
            <renderer type="datetime"/>
          </field>
        </schema>
        
        
        <schema id="dashlist" stereotype="list" platform="online">
          <field attribute="id"/>
          <field attribute="wpnum"/>
          <field attribute="workorderid"/>
          <field attribute="buildcomplete"/>
          <field attribute="tier"/>
        </schema>

        <schema id="adetailnotabs" stereotype="detail" abstract="true">

          <!--          <event service="fsworkpackageService" method="componentsLoad" type="onschemafullyloaded"/>-->

          <field attribute="id" hidden="true" label="Work Package "/>
          <field attribute="wpnum" hidden="true" label="Work Package "/>
          <field attribute="workorderid" hidden="true"/>
          <field attribute="wonum" hidden="true"/>
          <field attribute="#workorder_.orgid" hidden="true"/>




          <association label="Work Order" labelfield="workorder_.description" target="wonum" extraprojectionvalues="workorderid" enableexpression="@id== null">
            <event type="afterchange" service="fsworkpackageService" method="onWorkorderSelected"/>
            <dataprovider metadataid="wpcreationlookup"/>
            <renderer type="lookup" params="application=workorder;schemaId=wonumlookupwithwtype;"/>
          </association>

          <section showexpression="@wpnum != null" id="mainworkorder">
            <header displacement="ontop" label="Work Order Details" params="fieldset=true" />
            <section orientation="horizontal">
              <section>
                <field label="Number" attribute="#workorder_.wonum" readonly="true"/>
                <association label="Work Type" target="#workorder_.worktype" labelfield="#workorder_.worktype_.wtypedesc" orderbyfield="worktype asc">
                  <renderer type="lookup" />
                </association>
                <field label="Report Date" attribute="#workorder_.reportdate" readonly="true">
                  <renderer type="datetime" />
                </field>
                <field label="Created By" attribute="#workorder_.reportedby" readonly="true"/>
              </section>
              <section>
                <association label="Status" target="#workorder_.status" labelfield="#workorder_.synstatus.description">
                  <!--                  <dataprovider prefilterfunction="FilterStatusCodes"/>-->
                  <renderer type="lookup" params="avoidautofocus=true"/>
                </association>

                <field label="Site Name" attribute="#workorder_.site_.description" readonly="true"/>

                <association label="Asset" target="#workorder_.assetnum" labelfield="#workorder_.asset_.description" extraprojectionvalues="location" >
                  <renderer type="lookup" params="application=asset;schemaId=assetLookupList;hidecode=true"/>
                  <!--                  <dataprovider prefilterfunction="FilterAssets"/>-->
                  <event type="afterchange" service="genericTicketService" method="afterChangeAsset"/>
                </association>

                <field label="Planner/Scheduler" attribute="#planner" readonly="true"/>

              </section>
              <section>
                <association label="Job Plan #" target="#workorder_.jpnum" labelfield="#workorder_.jobplan_.description" >
                  <renderer type="lookup" />
                </association>


                <field label="PM #" attribute="#workorder_.pm_.description" readonly="true"/>

                <!--                <association label="PM #" target="#workorder_.pmnum" labelfield="#workorder_.pm_.description"  enableexpression="@#workorder_.worktype &amp;&amp; @#workorder_.worktype.equalsIc('PM')">-->
                <!--                  <renderer type="lookup" />-->
                <!--                </association>-->

                <field attribute="#workorder_.schedstart" label="Scheduled Start">
                  <renderer type="datetime"/>
                </field>

                <field label="Build Complete?" attribute="buildcomplete" defaultexpression="false" default="false">
                  <renderer type="checkbox"/>
                </field>
              </section>
            </section>
            <field label="Summary" attribute="#workorder_.description"/>
            <field label="Description" attribute="#workorder_.ld_.ldtext">
              <renderer type="textarea"/>
            </field>
          </section>


          <section orientation="horizontal" showexpression="@wpnum != null" id="outagesection">
            <section orientation="horizontal" >
              <header displacement="ontop" label="Tier Level" params="fieldset=true;"/>


              <field label="Outage Required" attribute="wooutreq" defaultexpression="false" default="false">
                <renderer type="checkbox"  params="layout=left"/>
                <!--                <option label="Yes" value="true"/>-->
                <!--                <option label="No" value="false"/>-->
              </field>

              <optionfield attribute="tier" enableexpression="@wooutreq == true">
                <renderer type="radio" params="vertical=true"/>
                <option label="Tier 1" value="tier1" help="Outages that affect production on a block level for a large site or the whole site for a smaller site with no clear path for resolution. &lt;br&gt;&lt;br&gt; This Tier of outage requires the full High Impact Team (HIT) implementation.&lt;br&gt;&lt;br&gt; The intent of a Tier 1 outage response is to escalate an event to ensure the proper level of response for a set of circumstances. "/>
                <option label="Tier 2" value="tier2" help="Outages affect production or telemetry on a lower level than a Tier 1 priority outage;&lt;br&gt;&lt;br&gt;this outage can be a long-term outage of a single inverter or a loss of site telemetry with an entity like the Balancing Authority or other regulating entity such as California Independent System Operator (CAISO) and has no clear path to resolution.&lt;br&gt;&lt;br&gt; A Tier 2 outage may require assistance of Subject Matter Experts (SMEs), which could include, but not be limited to, Management Information Systems (MIS) and Engineering Information Systems (EIS). &lt;br&gt;&lt;br&gt;Tier 2 outages do NOT require use of formal meetings and the daily update sheet. "/>
                <option label="Tier 3" value="tier3" help="Outages that affect a short-term loss of a small amount of generation.&lt;br&gt;&lt;br&gt; This type of outage resolution is the lowest level of priority and typically only requires Site Technician involvement.&lt;br&gt;&lt;br&gt; Resolution of a Tier 3 outage is typically short-term (less than a production day).&lt;br&gt;&lt;br&gt; Recovery from this outage is governed within the Operations and Maintenance (O&amp;M) procedures and alarm response. "/>
              </optionfield>
            </section>


            <section enableexpression="@wooutreq == true">
              <header displacement="ontop" label="Outage Type" params="fieldset=true"/>
              <optionfield attribute="outages" enableexpression="@wooutreq == true">
                <renderer type="checkbox" params="maxrows=4"/>
                <option label="1. Intercompany Outage" value="1"
                        help="Will this outage remove MW’s from Production during the day?&lt;br/&gt;Will this outage require an inter-company clearance?&lt;br/&gt;Will this outage require more than 14 days notification to the SC? " enableexpression="@tier != null &amp;&amp; @tier.equalsAny('tier1','tier2')"/>
                <option label="2. Curtailment/Grid Control Outage" value="2" help="Will this outage remove MW’s from Production during the day?&lt;br/&gt;Will this outage require more than 14 days notification to the SC? " enableexpression="@tier != null &amp;&amp; @tier.equalsAny('tier1','tier2')"/>
                <option label="3. Change Control Outage" value="3" help="Is this outage to make changes covered under a Change control request (ePCR)?" enableexpression="@tier != null &amp;&amp; @tier.equalsAny('tier1','tier2')"/>
                <option label="4. Production/Relay Outage" value="4" help="Is this outage to make changes to any relay protection system? " enableexpression="@tier != null &amp;&amp; @tier.equalsAny('tier1','tier2')"/>
                <option label="5. Telemetry Outage" value="5" help="Is this a telemetry outage?" enableexpression="@tier != null &amp;&amp; @tier.equalsAny('tier1','tier2')"/>
                <option label="6. Met-Station Outage" value="6" help="Is this outage to a Met station that is sending data to an outside entity?" enableexpression="@tier != null &amp;&amp; @tier.equalsAny('tier2')"/>
                <option label="7. Non-Coordinated Outage" value="7" help="All others" enableexpression="@tier != null &amp;&amp;@tier.equalsAny('tier3')"/>
              </optionfield>
            </section>
          </section>


          <section orientation="vertical" showexpression="@wpnum != null" id="otherdocs">
            <section orientation="horizontal">
              <section>
                <header displacement="ontop" label="Interconnect Documents" params="fieldset=true"/>
                <optionfield attribute="interconnectdocs" default="na" defaultexpression="na">
                  <renderer type="radio" params="vertical=true"/>
                  <option label="N/A" value="na"/>
                  <option label="Switching Order (ONLY)" value="switching"/>
                  <option label="Source of Power Clearance" value="source"/>
                </optionfield>
              </section>

              <section orientation="horizontal">
                <header displacement="ontop" label="Operation Procedures" params="fieldset=true"/>
                <section>
                  <optionfield attribute="outagetype" >
                    <renderer type="radio" params="maxrows=1"/>
                    <option label="NOP" value="NOP"/>
                    <option label="MOP" value="MOP"/>
                  </optionfield>
                </section>
                <section>
                  <field label="Site Technician" attribute="#technician" readonly="true"/>
                  <field label="Site Supervisor" attribute="#supervisor" readonly="true"/>
                  <field label="Regional Plant Manager" attribute="#regmanager" readonly="true"/>
                </section>
              </section>
            </section>

            <section orientation="horizontal">
              <composition inline="true" relationship="#interconnectfileexplorer_" label="Interconnect Documents" detailschema="">
                <renderer type="fileexplorer" params="acceptedFileExtensions=sw_all_types;fileexplorer.addfunction=fsworkpackagefilesService.saveFile;deletefunction=fsworkpackagefilesService.deleteFile"/>
              </composition>
              <composition inline="true" relationship="#operationprocfileexplorer_" label="Operation Procedures Files" detailschema="">
                <renderer type="fileexplorer" params="acceptedFileExtensions=sw_all_types;fileexplorer.addfunction=fsworkpackagefilesService.saveFile;deletefunction=fsworkpackagefilesService.deleteFile"/>
              </composition>
            </section>
          </section>

          <section id="compositions" ></section>

        </schema>


        <schema id="adetail" stereotype="detail" parentschema="adetailnotabs">
          <event type="onschemafullyloaded" service="fsworkpackageService" method="onSchemaLoad"/>

          <section id="compositions">


            <tab label="Planning/Scheduling" icon="fa-calendar" id="planningsched" enableexpression="@wpnum!=null" countrelationship="">
              <section orientation="horizontal" attribute="subcontractorenabled">
                <header label="Subcontractor" params="fieldset=true;enablecontrol=true"/>
                <composition inline="true" relationship="callOuts" label="" detailschema="detailview" printschema="" fetchtype="eager">
                  <collectionproperties listschema="calloutline" autocommit="false" allowremoval="true"/>
                  <renderer type="TABLE" params="mode=batch;composition.inline.addfunction=fscalloutService.openModalNew;composition.inline.expandreadonly=true;composition.inline.editfunction=fscalloutService.openModalEdit;composition.inline.deletefunction=fscalloutService.deleteRow;composition.inline.forceshowremove=true;composition.inline.addTitle=Request"/>
                </composition>
              </section>

              <section orientation="horizontal" attribute="maintenanceenabled">
                <header label="Maintenance Engineering" params="fieldset=true;enablecontrol=true"/>
                <composition inline="true" relationship="maintenanceEngineerings" label="" detailschema="detailview" printschema="" fetchtype="eager">
                  <collectionproperties listschema="maintenanceengline" autocommit="false" allowremoval="true"/>
                  <renderer type="TABLE" params="mode=batch;composition.inline.addfunction=fsmaintananceengService.openModalNew;composition.inline.expandreadonly=true;composition.inline.editfunction=fsmaintananceengService.openModalEdit;composition.inline.deletefunction=fsmaintananceengService.deleteRow;composition.inline.forceshowremove=true;composition.inline.addTitle=Request"/>
                </composition>
              </section>

              <section attribute="testresultreviewenabled" >
                <header label="Test Results Review" params="fieldset=true;enablecontrol=true"/>
                <section orientation="horizontal">
                  <field label="Results for Review" attribute="resultsforreview"></field>
                  <field label="Days Upon Closure" attribute="daysuponclosure">
                    <renderer type="numericinput"/>
                  </field>
                </section>
                <field label="Request Explanation" attribute="requestexplanation">
                  <renderer type="textarea"/>
                </field>
              </section>
            </tab>

            <tab label="Daily Outage Update" icon="fa-clock-o" id="dailyoutage" showexpression="@#workorder_.worktype == null || @#workorder_.worktype !== 'PM'" enableexpression="@id!=null" countrelationship="">
              <reference id="dailyoutage"/>
            </tab>

            <tab label="Maintenance Engineering Testing Page" icon="fa-wrench" id="engineering" enableexpression="@id!=null" countrelationship="">


              <composition inline="true" relationship="#relayeventfileexplorer_" label="Relay Event Files" detailschema="">
                <renderer type="fileexplorer" params="acceptedFileExtensions=sw_all_types;fileexplorer.addfunction=fsworkpackagefilesService.saveFile;deletefunction=fsworkpackagefilesService.deleteFile"/>
              </composition>

              <composition inline="true" relationship="#walkdownfileexplorer_" label="Walk Down Photos" detailschema="">
                <renderer type="fileexplorer" params="acceptedFileExtensions=sw_all_types;fileexplorer.addfunction=fsworkpackagefilesService.saveFile;deletefunction=fsworkpackagefilesService.deleteFile"/>
              </composition>

              <composition inline="true" relationship="#relayeventevaluations_" label="Engineering Evaluation - Event File" detailschema="worklog.workpackageview" printschema="">
                <collectionproperties listschema="worklog.workpackagelist" autocommit="true" allowremoval="false" allowupdate="true" allowcreation="true"/>
                <renderer type="TABLE" params="mode=batch;composition.inline.expandreadonly=true;composition.inline.addfunction=fsengineeringevaluationService.openModalNew;composition.inline.editfunction=fsengineeringevaluationService.openModalEdit;composition.inline.forcehideremove=true;composition.inline.addTitle=Evaluation"/>
              </composition>

              <section id="componentdeclarationsection">
                <header label="Component Tests - Click Save to Create New Outage Action" params="fieldset=true"/>

                <section resourcepath="/Content/Customers/firstsolar/htmls/templates/othertestsmodal.html"/>
                
                <section orientation="horizontal">
                  <optionfield label="Components" attribute="engcomponents">
                    <renderer type="checkbox" params="layout=left"/>
                    <option label="GSU" value="GSU"/>
                    <option label="SF6 Breaker" value="SF6"/>
                    <option label="Vacuum Breaker" value="VACUUM"/>
                    <option label="Air Switches" value="AIRS"/>
                    <option label="Cap Bank" value="CAPB"/>
                    <option label="Battery Bank/Charger" value="BATTERY"/>
                    <option label="Feeder" value="FEEDER"/>
                    <option label="Relay" value="RELAY"/>
                    <!--                    <option label="Telemetry" value="TELEMETRY"/>-->
                    <event service="fsworkpackageService" method="reevaluateSections" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <section showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('GSU')!= -1 ">
                    <optionfield attribute="gsuimmediatetests" label="GSU Testing - Immediate Response" qualifier="gsu">
                      <renderer type="checkbox" params="layout=left"/>

                      <option  label="Capture Oil Sampling" value="gsucaptureoil"/>
                      <option  label="Capture Bushing Monitoring Data" value="gsucapturemon"/>
                      <option  label="Oil Sample &amp; Dissolved Gas Analysis" value="gsuoilsampleanddissolved"/>
                      <option  label="Tap Changer Oil Sampling" value="gsutapcharg"/>
                      <option  label="Main Tank Oil Sampling" value="gsumaintank"/>
                      <option  label="Calisto - Capture Bushing Monitoring Data" value="gsucalcapbush"/>
                      <option  label="Calisto - Oil Sample &amp; Dissolved Gas Analysis" value="gsucaloil"/>
                      <option  label="Visual Inspection" value="gsuimvisual"/>
                      <option  label="Other Test" value="gsu2othertest"/>
                     

                      <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                      <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                    </optionfield>

                    <optionfield attribute="gsutests" label="GSU Testing" qualifier="gsu">
                      <renderer type="checkbox" params="layout=left"/>

                      <option  label="Visual Inspection" value="gsuvisual"/>
                      <option  label="Transformer Turns Ratio (TTR) Test" value="gsutransformer"/>
                      <option  label="Megger Test" value="gsumegger"/>
                      <option  label="Overall Power Factor Test" value="gsuoverall"/>
                      <option  label="(C1/C2) Bushing Power Factor Test" value="gsuc1c2"/>
                      <option  label="Leakage Reactance Test" value="gsuleakage"/>
                      <option  label="Protective Device Function Test" value="gsuprotect"/>
                      <option  label="LTC Function Test" value="gsultc"/>
                      <option  label="Test Results to Doble Engineers" value="gsutestresultstodoble"/>
                      <option  label="Other Test" value="gsuothertest"/>
                      <option  label="Recommend Repair" value="gsurepair"/>
                      <option  label="Recommend Replace" value="gsureplace"/>

                      <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                      <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                    </optionfield>

                  </section>

                  <optionfield label="SF6 Breaker Testing" attribute="sf6tests" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('SF6')!= -1 " qualifier="sf6">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="sf6visual"/>
                    <option  label="Megger Test" value="sf6megger"/>
                    <option  label="Ductor Test" value="sf6ductor"/>
                    <option  label="HI-Pot Test" value="sf6hipot"/>
                    <option  label="Test SF6 for Purity &amp; Moisture" value="sf6testsf6"/>
                    <option  label="SF6 Pressure Readings" value="sf6pressure"/>
                    <option  label="Functionality Test (open-close-open)" value="sf6ftoco"/>
                    <option  label="Overall Power Factor Test" value="sf6overallpower"/>
                    <option  label="Bushing Power Factor Test" value="sf6bushingpower"/>
                    <option  label="Other Test" value="sf6othertest"/>
                    <option  label="Recommend Repair" value="sf6repair"/>
                    <option  label="Recommend Replace" value="sf6replace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>


                  <optionfield label="Vaccuum Breaker Testing" attribute="vacuumtests" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('VACUUM')!= -1 " qualifier="vacuum">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="vacvisual"/>
                    <option  label="Megger Test" value="vacmegger"/>
                    <option  label="Ductor Test" value="vacductor"/>
                    <option  label="HI-Pot Test" value="vachipot"/>
                    <option  label="Contact Erosion Test" value="vaccontacterosion"/>
                    <option  label="Bushing Power Factor Test" value="vacbushingpower"/>
                    <option  label="Functionality Test (open-close-open)" value="vacftoco"/>
                    <option  label="Other Test" value="vacothertest"/>
                    <option  label="Recommend Repair" value="vacrepair"/>
                    <option  label="Recommend Replace" value="vacreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>


                  <optionfield label="Air Switch Testing" attribute="airswitchertests" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('AIRS')!= -1 " qualifier="airs">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="airvisual"/>
                    <option  label="Megger Test" value="airmegger"/>
                    <option  label="Ductor Test" value="airductor"/>
                    <option  label="HI-Pot Test" value="airhipot"/>
                    <option  label="Functionality Test (open-close-open)" value="airftoco"/>
                    <option  label="Other Test" value="airothertest"/>
                    <option  label="Recommend Repair" value="airrepair"/>
                    <option  label="Recommend Replace" value="airreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <optionfield attribute="capbanktests" label="Cap Bank Testing" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('CAPB')!= -1 " qualifier="capb">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="capvisual"/>
                    <option  label="Measure Capacitance" value="capmeasurecap"/>
                    <option  label="Other Test" value="capothertest"/>
                    <option  label="Recommend Repair" value="caprepair"/>
                    <option  label="Recommend Replace" value="capreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <optionfield attribute="batterytests" label="Battery Bank/Charger Testing" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('BATTERY')!= -1 " qualifier="battery">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="batvisual"/>
                    <option  label="Other Test" value="batothertest"/>
                    <option  label="Recommend Repair" value="batrepair"/>
                    <option  label="Recommend Replace" value="batreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <optionfield attribute="relaytests" label="Relay Testing" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('RELAY')!= -1 " qualifier="relay">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="relvisual"/>
                    <option  label="Other Test" value="relothertest"/>
                    <option  label="Recommend Repair" value="relrepair"/>
                    <option  label="Recommend Replace" value="relreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <optionfield attribute="feedertests" label="Feeder Testing - Line Testing" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('FEEDER')!= -1 " qualifier="feeder">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Visual Inspection" value="feedvisual"/>
                    <option  label="Megger Test" value="feedmegger"/>
                    <option  label="Ductor Test" value="feedductor"/>
                    <option  label="HI-Pot Test" value="feedhipot"/>
                    <option  label="PD Test" value="feedpd"/>
                    <option  label="VLF Test" value="feedvlf"/>
                    <option  label="Other Test" value="feedothertest" />
                    <option  label="Recommend Repair" value="feedrepair"/>
                    <option  label="Recommend Replace" value="feedreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <optionfield attribute="feedertranstests" label="Feeder Testing - Transformer Testing" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('FEEDER')!= -1 " qualifier="feeder">
                    <renderer type="checkbox" params="layout=left"/>
                    
                    <option  label="Transformer Turns Ratio (TTR) Test" value="feedtransttr"/>
                    <option  label="Megger Test" value="feedtransmegger"/>
                    <option  label="Other Test" value="feedtransothertest" />
                    <option  label="Recommend Repair" value="feedtransrepair"/>
                    <option  label="Recommend Replace" value="feedtransreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                  <optionfield attribute="feederpvcstests" label="Feeder Testing - PVCS Testing" showexpression="@engcomponents !=null &amp;&amp; @engcomponents.indexOf('FEEDER')!= -1 " qualifier="feeder">
                    <renderer type="checkbox" params="layout=left"/>

                    <option  label="Megger Test" value="feedpvcsmegger"/>
                    <option  label="Ductor Test" value="feedpvcsductor"/>
                    <option  label="HI-Pot Test" value="feedpvcshipot"/>
                    <option  label="Other Test" value="feedpvcsothertest" />
                    <option  label="Recommend Repair" value="feedpvcsrepair"/>
                    <option  label="Recommend Replace" value="feedpvcsreplace"/>

                    <event service="fsworkpackageService" method="testChecked" type="afterchange" />
                    <event service="fsworkpackageService" method="checkSectionRefresh" type="beforechange" />
                  </optionfield>

                </section>

              </section>

              <section id="components">
                <!--Placeholder section to display the components on the screen-->
                <field hidden="true" attribute="#fake"></field>
              </section>


            </tab>



            <tab label="Attachments" icon="fa-paperclip" id="attachments" enableexpression="@id!=null" countrelationship="#allattachments_">
              <composition inline="true" relationship="#allattachments_" label="" detailschema="attachmentdetail">
                <collectionproperties allowcreation="false" allowremoval="true" allowupdate="false" listschema="attachmentlist" />
                <renderer type="table" params="deletefunction=fsworkpackagefilesService.deleteFile"/>
              </composition>
            </tab>

            <tab label="Related Work Orders" icon="fa-tags" id="relatedwos" enableexpression="@id!=null" countrelationship="#relatedwos_">
              <composition inline="true" relationship="#relatedwos_" label="" detailschema="relatedwosdetail">
                <collectionproperties allowcreation="true" allowremoval="false" allowupdate="false" listschema="relatedwoslist" />
                <renderer type="table" params="composition.inline.addTitle=Related Work Order"/>
              </composition>
            </tab>

            <composition detailschema="" relationship="emailtracking_" label="Email Tracking" showexpression="@id!=null">
              <collectionproperties allowcreation="false" allowupdate="false" allowremoval="false"/>
            </composition>

          </section>

        </schema>

        <schema id="viewdetail" parentschema="adetailnotabs" mode="output">

        </schema>

        <schema id="newdetail" parentschema="adetail" title="New Work Package"  platform="web" stereotype="detailnew">
          <commandbars>
            <commandgroup position="detail.primary">
              <command id="save" icon="fa-check" service="applicationService" method="save" label="Create Work Package" cssclasses="applicationcommand btn-context btn large-button"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="viewdailyoutage" parentschema="adetailnotabs" title="Work Package"  mode="output">
          <section id="compositions">
            <reference id="dailyoutage"/>
          </section>
        </schema>

        <schema id="attachmentlist" stereotype="compositionlist">
          <field attribute="id" hidden="true"/>
          <field attribute="#attachdocument" label="Document"/>
          <field attribute="#attachsource" label="Source"/>
          <field attribute="#attachcreateddate" label="Created Date">
            <renderer type="datetime"/>
          </field>
          <properties>
            <property key="list.click.event" value="attachmentService.selectAttachment"/>
          </properties>
        </schema>

        <!-- workaround to show expand button-->
        <schema id="attachmentdetail" stereotype="compositiondetail">
        </schema>

        <schema id="relatedwoslist" stereotype="compositionlist">
          <field attribute="#siteid" hidden="true" />
          <field attribute="#relatedreckey" label="Related Record Key" />
          <field attribute="#relatedrecclass" label="Related Record Class" />
          <properties>
            <property key="list.click.event" value="fsWorkPackageRelatedRecordsService.rowClick"/>
          </properties>
        </schema>

        <schema id="relatedwosdetail" stereotype="compositiondetail" title="Related Work Order">
          <association label="Work Order" labelfield="relatedworkorder_.description" target="wonum" extraprojectionvalues="workorderid, siteid, orgid" requiredexpression="true">
            <renderer type="lookup" params="application=workorder;schemaId=wonumlookupwithwtype;"/>
          </association>
          
          <commandbars>
            <commandgroup position="modal.detail.primary" platform="web">
              <command id="customsave" icon="fa-check" service="fsWorkPackageRelatedRecordsService" method="save" parameters="datamap" label="Save" position="-save" primary="true"/>
              <removecommand id="save"/>
            </commandgroup>
          </commandbars>
        </schema>

        <schema id="lostenergylist" stereotype="compositionlist">
          <field attribute="date" label="Date">
            <renderer type="datetime" params="format=MM/dd/yyyy;"/>
          </field>
          <field attribute="value" label="MWh Lost"/>
        </schema>

        <schema id="lostenergydetail" stereotype="compositiondetail">
        </schema>
      </schemas>
    </application>

    <application entity="WorkPackageEmailStatus" name="emailstatus" title="Email Tracking">
      <properties>
        <property key ="icon" value="fa fa-envelope-o"/>
        <property key ="icon.composition.tab" value="fa fa-envelope-o"/>
      </properties>

      <schemas>
        <schema id="list" stereotype="compositionlist">
          <field attribute="id" hidden="true"/>
          <field attribute="email" label="Email"/>
          <field attribute="cc" label="Cc"/>
          <field attribute="status" label="Status"/>
          <field attribute="qualifier" label="qualifier"/>
          <field attribute="senddate" label="Send Date">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;"/>
          </field>
          <field attribute="ackdate" label="Acknowledgement Date">
            <renderer type="datetime" params="format=MM/dd/yyyy HH:mm;"/>
          </field>
        </schema>

      </schemas>

    </application>


  </applications>

</metadata>
